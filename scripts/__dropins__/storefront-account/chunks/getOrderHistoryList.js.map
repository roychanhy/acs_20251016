{"version":3,"file":"getOrderHistoryList.js","sources":["/@dropins/storefront-account/src/lib/formatDateToLocale.ts","/@dropins/storefront-account/src/data/transforms/transform-order-history-list.ts","/@dropins/storefront-account/src/api/getOrderHistoryList/graphql/getOrderHistoryList.graphql.ts","/@dropins/storefront-account/src/api/getOrderHistoryList/getOrderHistoryList.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Formats a date string according to a specified locale and options.\n * Returns \"Invalid Date\" if the input date string is invalid.\n *\n * @param {string} date - The date string to be formatted.\n * @param {string} [locale='en-US'] - The locale to use for formatting. Defaults to 'en-US'.\n * @param {Intl.DateTimeFormatOptions} [options={}] - Optional formatting options to customize the output.\n * @returns {string} The formatted date string, or \"Invalid Date\" if the input is invalid.\n *\n * @example\n * // Default formatting (en-US locale, MM/DD/YYYY)\n * console.log(formatDateToLocale('2023-08-29'));\n * // Output: \"08/29/2023\"\n *\n * @example\n * // Formatting with a specified locale (e.g., en-GB for DD/MM/YYYY)\n * console.log(formatDateToLocale('2023-08-29', 'en-GB'));\n * // Output: \"29/08/2023\"\n *\n * @example\n * // Formatting with a specified locale and custom options (e.g., de-DE with long month format)\n * console.log(formatDateToLocale('2023-08-29', 'de-DE', { month: 'long', year: 'numeric' }));\n * // Output: \"29. August 2023\"\n *\n * @example\n * // Handling an invalid date string\n * console.log(formatDateToLocale('invalid-date'));\n * // Output: \"Invalid Date\"\n */\nexport const formatDateToLocale = (\n  date: string,\n  locale: string = 'en-US',\n  options: Intl.DateTimeFormatOptions = {}\n): string => {\n  const defaultOptions: Intl.DateTimeFormatOptions = {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n  };\n  const formatOptions: Intl.DateTimeFormatOptions = {\n    ...defaultOptions,\n    ...options,\n  };\n\n  const dateObj = new Date(date);\n\n  if (isNaN(dateObj.getTime())) {\n    return 'Invalid Date';\n  }\n\n  const formatter = new Intl.DateTimeFormat(locale, formatOptions);\n  return formatter.format(dateObj);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  OrderHistoryListResponse,\n  OrderProps,\n  ReturnProps,\n} from '@/account/types';\nimport { OrderHistoryModel } from '@/account/data/models';\nimport { transformSingleAddress } from '@/account/data/transforms/transform-customer-address';\nimport { formatDateToLocale } from '@/account/lib/formatDateToLocale';\nimport { config } from '@/account/api';\nimport { merge } from '@adobe-commerce/elsie/lib';\n\nconst initialMoneyProps = {\n  value: 0,\n  currency: 'USD',\n};\n\nconst transformOrderHistoryTotal = (item: any) => {\n  return {\n    subtotal: item?.total?.subtotal ?? initialMoneyProps,\n    grandTotal: item?.total?.grand_total ?? initialMoneyProps,\n    grandTotalExclTax: item?.total?.grand_total_excl_tax ?? initialMoneyProps,\n    totalGiftcard: item?.total?.total_giftcard ?? initialMoneyProps,\n    subtotalExclTax: item?.total?.subtotal_excl_tax ?? initialMoneyProps,\n    subtotalInclTax: item?.total?.subtotal_incl_tax ?? initialMoneyProps,\n    taxes: item?.total?.taxes ?? [],\n    totalTax: item?.total?.total_tax ?? initialMoneyProps,\n    totalShipping: item?.total?.total_shipping ?? initialMoneyProps,\n    discounts: item?.total?.discounts ?? [],\n  };\n};\n\nexport const transformOrderHistoryList = (\n  response: OrderHistoryListResponse\n): OrderHistoryModel | null => {\n  if (!response.data?.customer?.orders) return null;\n\n  const returns = response?.data?.customer?.returns ?? [];\n  const items = response?.data?.customer?.orders?.items ?? [];\n\n  const model = {\n    items: items.map((item: OrderProps) => {\n      const transformedItem = {\n        items: item?.items.map((element) => ({\n          status: element?.status ?? '',\n          productName: element?.product_name ?? '',\n          id: element?.id,\n          quantityOrdered: element?.quantity_ordered ?? 0,\n          quantityShipped: element?.quantity_shipped ?? 0,\n          quantityInvoiced: element?.quantity_invoiced ?? 0,\n          product: {\n            sku: element?.product?.sku ?? '',\n            urlKey: element?.product?.url_key ?? '',\n            smallImage: {\n              url: element?.product?.small_image?.url ?? '',\n            },\n          },\n        })),\n        token: item?.token,\n        email: item?.email,\n        shippingMethod: item?.shipping_method,\n        paymentMethods: item?.payment_methods ?? [],\n        shipments: item?.shipments ?? [],\n        id: item?.id,\n        carrier: item?.carrier,\n        status: item?.status,\n        number: item?.number,\n        returns: returns?.items?.filter(\n          (returnItem: ReturnProps) => returnItem.order.id === item.id\n        ),\n        orderDate: formatDateToLocale(item.order_date),\n        shippingAddress: transformSingleAddress(item.shipping_address),\n        billingAddress: transformSingleAddress(item.billing_address),\n        total: transformOrderHistoryTotal(item),\n      };\n\n      return transformedItem;\n    }),\n    pageInfo: {\n      pageSize: response?.data?.customer?.orders?.page_info?.page_size ?? 10,\n      totalPages: response?.data?.customer?.orders?.page_info?.total_pages ?? 1,\n      currentPage:\n        response?.data?.customer?.orders?.page_info?.current_page ?? 1,\n    },\n    totalCount: response?.data?.customer?.orders?.total_count ?? 0,\n    dateOfFirstOrder:\n      response?.data?.customer?.orders?.date_of_first_order ?? '',\n  };\n\n  return merge(\n    model, // default transformer\n    config?.getConfig()?.models?.OrderHistoryModel?.transformer?.(response.data) // custom transformer\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  ADDRESS_FRAGMENT,\n  ORDER_SUMMARY_FRAGMENT,\n} from '@/account/api/fragments';\n\nexport const GET_CUSTOMER_ORDERS_LIST = /* GraphQL */ `\n  query GET_CUSTOMER_ORDERS_LIST(\n    $currentPage: Int\n    $pageSize: Int\n    $filter: CustomerOrdersFilterInput\n    $sort: CustomerOrderSortInput\n  ) {\n    customer {\n      returns {\n        items {\n          uid\n          number\n          order {\n            id\n          }\n        }\n      }\n      orders(\n        currentPage: $currentPage\n        pageSize: $pageSize\n        filter: $filter\n        sort: $sort\n      ) {\n        page_info {\n          page_size\n          total_pages\n          current_page\n        }\n        date_of_first_order\n        total_count\n        items {\n          token\n          email\n          shipping_method\n          payment_methods {\n            name\n            type\n          }\n          shipping_address {\n            ...ADDRESS_FRAGMENT\n          }\n          billing_address {\n            ...ADDRESS_FRAGMENT\n          }\n          shipments {\n            id\n            number\n            tracking {\n              title\n              number\n              carrier\n            }\n          }\n          number\n          id\n          order_date\n          carrier\n          status\n          items {\n            status\n            product_name\n            id\n            quantity_ordered\n            quantity_shipped\n            quantity_invoiced\n            product {\n              sku\n              url_key\n              small_image {\n                url\n              }\n            }\n          }\n          total {\n            ...ORDER_SUMMARY_FRAGMENT\n          }\n        }\n      }\n    }\n  }\n  ${ADDRESS_FRAGMENT}\n  ${ORDER_SUMMARY_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/account/api';\nimport { handleNetworkError } from '@/account/lib/network-error';\nimport { GET_CUSTOMER_ORDERS_LIST } from './graphql/getOrderHistoryList.graphql';\nimport { OrderHistoryListResponse } from '@/account/types';\nimport { transformOrderHistoryList } from '@/account/data/transforms';\nimport { OrderHistoryModel } from '@/account/data/models';\n\nconst SORT_DIRECTION = { sort_direction: 'DESC', sort_field: 'CREATED_AT' };\n\nexport const getOrderHistoryList = async (\n  pageSize: number,\n  selectOrdersDate: string,\n  currentPage: number\n): Promise<OrderHistoryModel | null> => {\n  const filterOrderDate = !selectOrdersDate.includes('viewAll')\n    ? {\n        order_date: JSON.parse(selectOrdersDate),\n      }\n    : {};\n\n  return await fetchGraphQl(GET_CUSTOMER_ORDERS_LIST, {\n    method: 'GET',\n    cache: 'no-cache',\n    variables: {\n      pageSize,\n      currentPage,\n      filter: filterOrderDate,\n      sort: SORT_DIRECTION,\n    },\n  })\n    .then((response: OrderHistoryListResponse) => {\n      return transformOrderHistoryList(response);\n    })\n    .catch(handleNetworkError);\n};\n"],"names":["formatDateToLocale","date","locale","options","formatOptions","dateObj","initialMoneyProps","transformOrderHistoryTotal","item","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","transformOrderHistoryList","response","returns","model","element","returnItem","transformSingleAddress","_k","_o","_n","_m","_l","_s","_r","_q","_p","_v","_u","_t","_y","_x","_w","merge","_D","_C","_B","_A","_z","config","GET_CUSTOMER_ORDERS_LIST","ADDRESS_FRAGMENT","ORDER_SUMMARY_FRAGMENT","SORT_DIRECTION","getOrderHistoryList","pageSize","selectOrdersDate","currentPage","filterOrderDate","fetchGraphQl","handleNetworkError"],"mappings":"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"}