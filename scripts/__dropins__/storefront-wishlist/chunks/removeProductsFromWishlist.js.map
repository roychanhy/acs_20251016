{"version":3,"file":"removeProductsFromWishlist.js","sources":["/@dropins/storefront-wishlist/src/lib/cookies.ts","/@dropins/storefront-wishlist/src/lib/state.ts","/@dropins/storefront-wishlist/src/lib/wishlist-item-comparator.ts","/@dropins/storefront-wishlist/src/lib/persisted-data.ts","/@dropins/storefront-wishlist/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-wishlist/src/lib/fetch-error.ts","/@dropins/storefront-wishlist/src/api/removeProductsFromWishlist/graphql/removeProductsFromWishlistMutation.ts","/@dropins/storefront-wishlist/src/api/removeProductsFromWishlist/removeProductsFromWishlist.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport function getCookie(cookieName: string) {\n  // Split the cookie string into an array of individual cookies\n  const cookies = document.cookie.split(';');\n\n  // Loop through the cookies to find the one with the specified name\n  for (const cookie of cookies) {\n    // Check if this cookie starts with the name you're looking for\n    if (cookie.trim().startsWith(`${cookieName}=`)) {\n      // Extract and return the cookie's value\n      return cookie.trim().substring(cookieName.length + 1);\n    }\n  }\n\n  // If the cookie is not found, return null\n  return null;\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { StoreConfigModel } from '@/wishlist/data/models/store-config';\nimport { getCookie } from '@/wishlist/lib/cookies';\n\ntype State = {\n  wishlistId: string | null;\n  initializing?: boolean;\n  isLoading?: boolean;\n  locale?: string;\n  config?: StoreConfigModel | null;\n  authenticated: boolean;\n  currentPage?: number;\n  pageSize?: number;\n};\n\nconst _state: State = (() => {\n  return {\n    wishlistId: null,\n    authenticated: false,\n    isLoading: true,\n  };\n})();\n\n// Proxy state to allow reactivity\nexport const state = new Proxy(_state, {\n  set(target, key, value) {\n    // @ts-ignore\n    target[key] = value;\n\n    if (key === 'wishlistId') {\n      // only update cookie if value has changed\n      if (value === state.wishlistId) return true;\n\n      if (value === null) {\n        // remove cookie\n        document.cookie = `DROPIN__WISHLIST__WISHLIST-ID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;\n        return true;\n      }\n\n      // set expiration date\n      const expires = new Date();\n      expires.setDate(expires.getDate() + 30);\n      // set cookie\n      document.cookie = `DROPIN__WISHLIST__WISHLIST-ID=${value}; expires=${expires.toUTCString()}; path=/`;\n    }\n\n    return Reflect.set(target, key, value);\n  },\n  get(target, key) {\n    if (key === 'wishlistId') {\n      // get value from cookie\n      return getCookie('DROPIN__WISHLIST__WISHLIST-ID');\n    }\n\n    return target[key as keyof State];\n  },\n});\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Item } from '@/wishlist/data/models/wishlist';\n\ninterface ProductLike {\n  sku: string;\n  optionUIDs?: string[];\n}\n\n/**\n * Helper function to compare wishlist items by their SKU and selected options\n */\nexport function isMatchingWishlistItem(\n  wishlistItem: Item,\n  product: ProductLike\n): boolean {\n  // Compare SKUs first for early return\n  if (wishlistItem.product.sku !== product.sku) {\n    return false;\n  }\n\n  // Compare selected options\n  const wishlistItemOptions =\n    wishlistItem.selectedOptions\n      ?.map((option: any) => option.uid)\n      .filter((uid: any) => !!uid)\n      .sort() || [];\n  const productOptionUIDs = (product.optionUIDs || [])\n    .filter((uid: any) => !!uid)\n    .sort();\n\n  // If options match (or both are empty), items are considered matching\n  return (\n    JSON.stringify(wishlistItemOptions) === JSON.stringify(productOptionUIDs)\n  );\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Wishlist } from '@/wishlist/data/models';\nimport { state } from '@/wishlist/lib/state';\nimport { isMatchingWishlistItem } from '@/wishlist/lib/wishlist-item-comparator';\n\nconst WISHLIST_KEY = 'DROPIN__WISHLIST__WISHLIST__DATA';\n\nexport function setPersistedWishlistData(data: Wishlist | null) {\n  const $storage = state.authenticated ? sessionStorage : localStorage;\n  if (data) {\n    try {\n      $storage.setItem(WISHLIST_KEY, JSON.stringify(data));\n    } catch (error) {\n      if (isQuotaExceededError(error)) {\n        console.error('Storage quota exceeded:', error);\n      } else {\n        console.error('Error saving wishlist:', error);\n      }\n    }\n  } else {\n    $storage.removeItem(WISHLIST_KEY);\n  }\n}\n\nconst isQuotaExceededError = (error: unknown) => {\n  //https://mmazzarolo.com/blog/2022-06-25-local-storage-status/\n  return error instanceof DOMException && error.name === 'QuotaExceededError';\n};\n\nexport function getPersistedWishlistData(\n  guest: boolean = false\n): Wishlist | {} {\n  const $storage =\n    state.authenticated && !guest ? sessionStorage : localStorage;\n  try {\n    const wishlist = $storage.getItem(WISHLIST_KEY);\n    return wishlist ? JSON.parse(wishlist) : { id: '', items: [] };\n  } catch (error) {\n    console.error('Error retrieving wishlist:', error);\n    return { id: '', items: [] };\n  }\n}\n\nexport function clearPersistedLocalStorage() {\n  localStorage.removeItem(WISHLIST_KEY);\n}\n\nexport function getWishlistItemFromStorage(\n  productSku: string,\n  optionUIDs: string[] = []\n) {\n  const storage = state.authenticated ? sessionStorage : localStorage;\n  const wishlist = storage.getItem(WISHLIST_KEY)\n    ? JSON.parse(String(storage.getItem(WISHLIST_KEY)))\n    : { id: '', items: [] };\n\n  return wishlist?.items?.find((item: any) =>\n    isMatchingWishlistItem(item, {\n      sku: productSku,\n      optionUIDs,\n    })\n  );\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/** Actions */\nexport const handleFetchError = (errors: Array<{ message: string }>) => {\n  const errorMessage = errors.map((e: any) => e.message).join(' ');\n\n  throw Error(errorMessage);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const REMOVE_PRODUCTS_FROM_WISHLIST_MUTATION = `\n  mutation REMOVE_PRODUCTS_FROM_WISHLIST_MUTATION(\n      $wishlistId: ID!, \n      $wishlistItemsIds: [ID!]!,\n    ) {\n    removeProductsFromWishlist(\n      wishlistId: $wishlistId\n      wishlistItemsIds: $wishlistItemsIds\n    ) {\n      user_errors {\n        code\n        message\n      }\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/wishlist/api';\nimport { state } from '@/wishlist/lib/state';\nimport { handleFetchError } from '@/wishlist/lib/fetch-error';\nimport { REMOVE_PRODUCTS_FROM_WISHLIST_MUTATION } from './graphql/removeProductsFromWishlistMutation';\nimport { Item, Wishlist } from '@/wishlist/data/models/wishlist';\nimport { events } from '@adobe-commerce/event-bus';\nimport { getPersistedWishlistData } from '@/wishlist/lib/persisted-data';\nimport { isMatchingWishlistItem } from '@/wishlist/lib/wishlist-item-comparator';\n\nexport const removeProductsFromWishlist = async (\n  items: Array<Item>\n): Promise<Wishlist | null> => {\n  const wishlist = getPersistedWishlistData();\n  const updatedWishlist = {\n    ...wishlist,\n    items: wishlist.items?.filter((wishlistItem: any) => {\n      return !items.some((item) =>\n        isMatchingWishlistItem(wishlistItem, {\n          sku: item.product.sku,\n          optionUIDs: item.selectedOptions?.map((option: any) => option.uid),\n        })\n      );\n    }),\n  };\n\n  if (state.authenticated) {\n    if (!state.wishlistId) {\n      throw Error('Wishlist ID is not set');\n    }\n\n    const itemIds = items.map((item) => item.id);\n    const { errors, data } = await fetchGraphQl(\n      REMOVE_PRODUCTS_FROM_WISHLIST_MUTATION,\n      {\n        variables: { wishlistId: state.wishlistId, wishlistItemsIds: itemIds },\n      }\n    );\n\n    const _errors = [\n      ...(data?.removeProductsFromWishlist?.user_errors ?? []),\n      ...(errors ?? []),\n    ];\n\n    // restore wishlist if removing item failed:\n    if (_errors.length > 0) {\n      events.emit('wishlist/data', wishlist);\n      return handleFetchError(_errors);\n    }\n  }\n\n  updatedWishlist.items_count = updatedWishlist.items?.length;\n  events.emit('wishlist/data', updatedWishlist);\n\n  return null;\n};\n"],"names":["getCookie","cookieName","cookies","cookie","_state","state","target","key","value","expires","isMatchingWishlistItem","wishlistItem","product","wishlistItemOptions","_a","option","uid","productOptionUIDs","WISHLIST_KEY","setPersistedWishlistData","data","$storage","error","isQuotaExceededError","getPersistedWishlistData","guest","wishlist","clearPersistedLocalStorage","getWishlistItemFromStorage","productSku","optionUIDs","storage","item","setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","handleFetchError","errors","errorMessage","e","REMOVE_PRODUCTS_FROM_WISHLIST_MUTATION","removeProductsFromWishlist","items","updatedWishlist","itemIds","_errors","_b","events","_c"],"mappings":"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"}