{"version":3,"file":"WishlistToggle.js","sources":["/@dropins/storefront-wishlist/src/containers/WishlistToggle/WishlistToggle.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  useState,\n  HTMLAttributes,\n  useEffect,\n  useCallback,\n} from 'preact/compat';\nimport { Button, Icon } from '@adobe-commerce/elsie/components';\nimport { events } from '@adobe-commerce/event-bus';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { Heart, HeartFilled } from '@adobe-commerce/elsie/icons';\nimport { state } from '@/wishlist/lib/state';\nimport { useText } from '@adobe-commerce/elsie/i18n';\n\nimport {\n  addProductsToWishlist,\n  removeProductsFromWishlist,\n  config,\n} from '@/wishlist/api';\nimport { Product } from '@/wishlist/data/models';\nimport { getPersistedWishlistData } from '@/wishlist/lib/persisted-data';\nimport { VNode } from 'preact';\nimport { isMatchingWishlistItem } from '@/wishlist/lib/wishlist-item-comparator';\n\nexport interface WishlistToggleProps extends HTMLAttributes<HTMLDivElement> {\n  product: Product;\n  iconWishlisted?: VNode<HTMLAttributes<SVGSVGElement>>;\n  iconToWishlist?: VNode<HTMLAttributes<SVGSVGElement>>;\n  size?: 'medium' | 'large';\n  variant?: 'primary' | 'secondary' | 'tertiary';\n  disabled?: boolean;\n  labelToWishlist?: string;\n  labelWishlisted?: string;\n  onClick?: () => void;\n  removeProdFromCart?: (\n    product: { uid: string; quantity: number }[]\n  ) => Promise<any>;\n}\n\nexport const WishlistToggle: Container<WishlistToggleProps> = ({\n  product,\n  iconWishlisted,\n  iconToWishlist,\n  size,\n  variant,\n  disabled,\n  labelToWishlist,\n  labelWishlisted,\n  onClick,\n  removeProdFromCart,\n}: WishlistToggleProps) => {\n  const [isLoggedIn, setIsLoggedIn] = useState(state.authenticated);\n  const [isWishlisted, setIsWishlisted] = useState(false);\n  const [wishlistItem, setWishlistItem] = useState(null);\n  const { isGuestWishlistEnabled } = config.getConfig();\n\n  const dictionary = useText({\n    addToWishlist: 'Wishlist.Wishlist.ariaLabelAddToWishlist',\n    removeFromWishlist: 'Wishlist.Wishlist.ariaLabelRemoveFromWishlist',\n  });\n\n  const handleWishlistData = useCallback(() => {\n    const updatedWishlist = getPersistedWishlistData();\n    const item = updatedWishlist?.items?.find((item: any) =>\n      isMatchingWishlistItem(item, {\n        sku: product.topLevelSku ?? product.sku,\n        optionUIDs:\n          product.optionUIDs ??\n          (product.selectedOptionsUIDs\n            ? Object.values(product.selectedOptionsUIDs)\n            : undefined),\n      })\n    );\n\n    setWishlistItem(item ?? null);\n    setIsWishlisted(!!item);\n  }, [\n    product.topLevelSku,\n    product.sku,\n    product.optionUIDs,\n    product.selectedOptionsUIDs,\n  ]);\n\n  useEffect(() => {\n    handleWishlistData();\n  }, [handleWishlistData]);\n\n  useEffect(() => {\n    const handleAuthentication = (authenticated: boolean) =>\n      setIsLoggedIn(authenticated);\n\n    const onAuthenticated = events.on('authenticated', handleAuthentication);\n    const onWishlistData = events.on('wishlist/data', handleWishlistData);\n\n    return () => {\n      onAuthenticated?.off();\n      onWishlistData?.off();\n    };\n  }, [handleWishlistData]);\n\n  const handleClick = async () => {\n    if (isWishlisted) {\n      try {\n        await removeProductsFromWishlist([wishlistItem]);\n      } catch (error) {\n        events.emit('wishlist/alert', {\n          action: 'removeError',\n          item: { product },\n        });\n        return null;\n      }\n\n      setIsWishlisted(false);\n      events.emit('wishlist/alert', {\n        action: 'remove',\n        item: { product },\n      });\n    } else {\n      try {\n        await addProductsToWishlist([\n          {\n            sku: product.topLevelSku ?? product.sku,\n            quantity: 1,\n            optionsUIDs:\n              product.optionUIDs ??\n              (product.selectedOptionsUIDs\n                ? Object.values(product.selectedOptionsUIDs)\n                : undefined),\n            enteredOptions: product.options?.items\n              ? product.options.items\n                  .filter((option: any) => option.selected)\n                  .map((option: any) => ({\n                    uid: option.uid,\n                    value: option.value,\n                  }))\n              : undefined,\n          },\n        ]);\n      } catch (error) {\n        events.emit('wishlist/alert', {\n          action: 'addError',\n          item: { product },\n        });\n        return null;\n      }\n\n      setIsWishlisted(true);\n      events.emit('wishlist/alert', {\n        action: 'add',\n        item: { product },\n      });\n      if (removeProdFromCart) {\n        await removeProdFromCart([\n          {\n            uid: product.uid,\n            quantity: 0,\n          },\n        ]);\n      }\n    }\n  };\n\n  if (!isLoggedIn && !isGuestWishlistEnabled) {\n    return null;\n  }\n\n  const ariaLabel: string = isWishlisted\n    ? dictionary['removeFromWishlist'].replace('{PRODUCT_NAME}', product?.name)\n    : dictionary['addToWishlist'].replace('{PRODUCT_NAME}', product?.name);\n\n  return (\n    <Button\n      active={isWishlisted}\n      aria-label={ariaLabel}\n      data-testid=\"wishlist-toggle\"\n      size={size ?? 'medium'}\n      variant={variant ?? 'tertiary'}\n      disabled={disabled}\n      icon={<Icon source={iconToWishlist ?? Heart} />}\n      activeIcon={<Icon source={iconWishlisted ?? HeartFilled} />}\n      onClick={onClick ?? handleClick}\n      children={labelToWishlist}\n      activeChildren={labelWishlisted}\n    />\n  );\n};\n"],"names":["WishlistToggle","product","iconWishlisted","iconToWishlist","size","variant","disabled","labelToWishlist","labelWishlisted","onClick","removeProdFromCart","isLoggedIn","setIsLoggedIn","useState","state","isWishlisted","setIsWishlisted","wishlistItem","setWishlistItem","isGuestWishlistEnabled","config","dictionary","useText","handleWishlistData","useCallback","updatedWishlist","getPersistedWishlistData","item","_a","isMatchingWishlistItem","useEffect","handleAuthentication","authenticated","onAuthenticated","events","onWishlistData","handleClick","removeProductsFromWishlist","addProductsToWishlist","option","ariaLabel","jsx","Button","Icon","Heart","HeartFilled"],"mappings":"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"}