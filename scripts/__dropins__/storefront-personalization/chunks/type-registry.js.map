{"version":3,"file":"type-registry.js","sources":["/@dropins/storefront-personalization/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-personalization/src/data/transforms/transform-store-config.ts","/@dropins/storefront-personalization/src/lib/fetch-error.ts","/@dropins/storefront-personalization/src/api/getStoreConfig/graphql/StoreConfigQuery.ts","/@dropins/storefront-personalization/src/api/getStoreConfig/getStoreConfig.ts","/@dropins/storefront-personalization/src/lib/cookieUtils.ts","/@dropins/storefront-personalization/src/api/getPersonalizationData/getPersonalizationData.ts","/@dropins/storefront-personalization/src/lib/type-registry.ts"],"sourcesContent":["import { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { StoreConfigModel } from '@/personalization/data/models';\n\nexport function transformStoreConfig(storeConfig: any): StoreConfigModel | null {\n  if (!storeConfig) return null;\n\n  return {\n    shareActiveSegments: storeConfig.share_active_segments,\n    shareCustomerGroup: storeConfig.graphql_share_customer_group,\n    shareAppliedCartRule: storeConfig.share_applied_cart_rule,\n    customerAccessTokenLifetime: storeConfig.customer_access_token_lifetime,\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/** Actions */\nexport const handleFetchError = (errors: Array<{ message: string }>) => {\n  const errorMessage = errors.map((e: any) => e.message).join(' ');\n\n  throw Error(errorMessage);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const STORE_CONFIG_QUERY = `\nquery STORE_CONFIG_QUERY {\n  storeConfig {\n    share_active_segments\n    graphql_share_customer_group\n    share_applied_cart_rule\n    customer_access_token_lifetime\n  }\n}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/personalization/api';\nimport { StoreConfigModel } from '@/personalization/data/models';\nimport { transformStoreConfig } from '@/personalization/data/transforms';\nimport { handleFetchError } from '@/personalization/lib/fetch-error';\n\nimport { STORE_CONFIG_QUERY } from './graphql/StoreConfigQuery';\n\nexport const getStoreConfig = async (): Promise<StoreConfigModel | null> => {\n  const storeConfigString = sessionStorage.getItem('personalizationStoreConfig');\n  if (storeConfigString !== null) {\n    return JSON.parse(storeConfigString);\n  }\n  return fetchGraphQl(STORE_CONFIG_QUERY, {\n    method: 'GET',\n    cache: 'force-cache',\n  }).then(({ errors, data }) => {\n    if (errors) return handleFetchError(errors);\n\n    const transformedStoreConfig = transformStoreConfig(data.storeConfig);\n    sessionStorage.setItem('personalizationStoreConfig', JSON.stringify(transformedStoreConfig))\n    return transformedStoreConfig;\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/* eslint-disable no-useless-escape */\nimport { getStoreConfig } from '@/personalization/api';\n\nexport const COOKIE_LIFETIME_HOURS = 1;\nexport const COOKIE_NAME = 'personalization_dropin_data';\n\nexport const setCookie = async (value: string) => {\n  const lifetime = await getCookiesLifetime();\n  document.cookie = `${COOKIE_NAME}=${encodeURIComponent(value)}; path=/; ${lifetime}; `;\n}\n\nexport const getCookie = () => {\n  const cookies = document.cookie.split(';');\n  let foundValue;\n\n  cookies.forEach((cookie) => {\n    const [name, value] = cookie.trim().split('=');\n    if (name === COOKIE_NAME) {\n      foundValue = decodeURIComponent(value);\n    }\n  });\n\n  return foundValue;\n};\n\nexport const deleteCookie = () => {\n  document.cookie = `${COOKIE_NAME}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n};\n\nconst getCookiesLifetime = async () => {\n  try {\n    const storeConfig = await getStoreConfig();\n    const accessTokenLifeTime = (storeConfig?.customerAccessTokenLifetime || COOKIE_LIFETIME_HOURS) * 3600;\n    return `Max-Age=${accessTokenLifeTime}`;\n  } catch (error) {\n    console.error('getCookiesLifetime() Error:', error);\n    return `Max-Age=${COOKIE_LIFETIME_HOURS * 3600}`;\n  }\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { PersonalizationData } from '@/personalization/data/models';\nimport { getCookie } from \"@/personalization/lib/cookieUtils\";\n\nexport const getPersonalizationData = (): PersonalizationData =>  {\n  const data = getCookie();\n  if (data === undefined) {\n    return {\n      segments: [],\n      groups: [],\n      cartRules: [],\n    };\n  }\n  const decodedData = JSON.parse(data);\n  return decodedData ? decodedData : {\n    segments: [],\n    groups: [],\n    cartRules: [],\n  };\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nconst visibleTypes: string[] = [];\n\nexport const registerTypeIsFirst = (type:  string | undefined): boolean => {\n  if (type === undefined) {\n    return true;\n  }\n  if (visibleTypes.includes(type)) {\n    return false;\n  }\n  visibleTypes.push(type);\n  return true;\n}\n\nexport const resetTypes = (): void => { visibleTypes.length = 0; };"],"names":["setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","transformStoreConfig","storeConfig","handleFetchError","errors","errorMessage","e","STORE_CONFIG_QUERY","getStoreConfig","storeConfigString","data","transformedStoreConfig","COOKIE_LIFETIME_HOURS","COOKIE_NAME","setCookie","value","lifetime","getCookiesLifetime","getCookie","cookies","foundValue","cookie","name","error","getPersonalizationData","decodedData","visibleTypes","registerTypeIsFirst","type","resetTypes"],"mappings":"+DAEa,KAAA,CACX,YAAAA,EACA,sBAAAC,EACA,yBAAAC,EACA,uBAAAC,EACA,aAAAC,EACA,UAAAC,CACF,EAAI,IAAIC,EAAa,EAAE,WAAW,ECU3B,SAASC,EAAqBC,EAA2C,CAC1E,OAACA,EAEE,CACL,oBAAqBA,EAAY,sBACjC,mBAAoBA,EAAY,6BAChC,qBAAsBA,EAAY,wBAClC,4BAA6BA,EAAY,8BAC3C,EAPyB,IAQ3B,CCVa,MAAAC,EAAoBC,GAAuC,CAChE,MAAAC,EAAeD,EAAO,IAAKE,GAAWA,EAAE,OAAO,EAAE,KAAK,GAAG,EAE/D,MAAM,MAAMD,CAAY,CAC1B,ECLaE,EAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECOrBC,EAAiB,SAA8C,CACpE,MAAAC,EAAoB,eAAe,QAAQ,4BAA4B,EAC7E,OAAIA,IAAsB,KACjB,KAAK,MAAMA,CAAiB,EAE9BX,EAAaS,EAAoB,CACtC,OAAQ,MACR,MAAO,aACR,CAAA,EAAE,KAAK,CAAC,CAAE,OAAAH,EAAQ,KAAAM,KAAW,CACxB,GAAAN,EAAe,OAAAD,EAAiBC,CAAM,EAEpC,MAAAO,EAAyBV,EAAqBS,EAAK,WAAW,EACpE,sBAAe,QAAQ,6BAA8B,KAAK,UAAUC,CAAsB,CAAC,EACpFA,CAAA,CACR,CACH,ECnBaC,EAAwB,EACxBC,EAAc,8BAEdC,EAAY,MAAOC,GAAkB,CAC1C,MAAAC,EAAW,MAAMC,EAAmB,EACjC,SAAA,OAAS,GAAGJ,CAAW,IAAI,mBAAmBE,CAAK,CAAC,aAAaC,CAAQ,IACpF,EAEaE,EAAY,IAAM,CAC7B,MAAMC,EAAU,SAAS,OAAO,MAAM,GAAG,EACrC,IAAAC,EAEI,OAAAD,EAAA,QAASE,GAAW,CACpB,KAAA,CAACC,EAAMP,CAAK,EAAIM,EAAO,KAAK,EAAE,MAAM,GAAG,EACzCC,IAAST,IACXO,EAAa,mBAAmBL,CAAK,EACvC,CACD,EAEMK,CACT,EAMMH,EAAqB,SAAY,CACjC,GAAA,CACI,MAAAf,EAAc,MAAMM,EAAe,EAEzC,MAAO,aADsBN,GAAA,YAAAA,EAAa,8BAA+BU,GAAyB,IAC7D,SAC9BW,EAAO,CACN,eAAA,MAAM,8BAA+BA,CAAK,EAC3C,WAAWX,EAAwB,IAAI,EAAA,CAElD,ECnCaY,EAAyB,IAA4B,CAChE,MAAMd,EAAOQ,EAAU,EACvB,GAAIR,IAAS,OACJ,MAAA,CACL,SAAU,CAAC,EACX,OAAQ,CAAC,EACT,UAAW,CAAA,CACb,EAEI,MAAAe,EAAc,KAAK,MAAMf,CAAI,EACnC,OAAOe,GAA4B,CACjC,SAAU,CAAC,EACX,OAAQ,CAAC,EACT,UAAW,CAAA,CACb,CACF,EClBMC,EAAyB,CAAC,EAEnBC,EAAuBC,GAC9BA,IAAS,OACJ,GAELF,EAAa,SAASE,CAAI,EACrB,IAETF,EAAa,KAAKE,CAAI,EACf,IAGIC,EAAa,IAAY,CAAEH,EAAa,OAAS,CAAG"}