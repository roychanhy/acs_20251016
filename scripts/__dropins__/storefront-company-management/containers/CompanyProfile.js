/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as f,jsx as a,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{classes as Z,Slot as ye}from"@dropins/tools/lib.js";import{Card as J,Skeleton as ve,SkeletonRow as Q,Button as X,Field as M,Input as D,Picker as ue,Header as ge,InLineAlert as Ae,ProgressSpinner as Ce}from"@dropins/tools/components.js";import{useState as L,useEffect as W,useMemo as U,useRef as G,useCallback as O}from"@dropins/tools/preact-hooks.js";import{events as pe}from"@dropins/tools/event-bus.js";import{g as Ne,u as be}from"../chunks/updateCompany.js";import{useText as j}from"@dropins/tools/i18n.js";import{g as he,v as Ee}from"../chunks/validateCompanyEmail.js";import{u as _e}from"../chunks/useInLineAlert.js";import"../chunks/fetch-error.js";import"../chunks/fetchUserPermissions.js";import"../chunks/company-permissions.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact-compat.js";const Ie=({testId:t,withCard:e=!0})=>{const o=f(ve,{"data-testid":t||"companySkeletonLoader",children:[a(Q,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(Q,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return e?o:a(J,{variant:"secondary",className:Z(["company-company-loaders","company-company-loaders--card-loader"]),children:o})},xe=({company:t,slots:e,showEditForm:o,handleShowEditForm:y})=>{const n=j({editButton:"Company.shared.buttons.edit",noDataMessage:"Company.CompanyProfile.companyProfileCard.noDataMessage",companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId",legalAddress:"Company.shared.fields.legalAddress",contacts:"Company.CompanyProfile.companyProfileCard.contacts",companyAdministrator:"Company.CompanyProfile.companyProfileCard.companyAdministrator",salesRepresentative:"Company.CompanyProfile.companyProfileCard.salesRepresentative",paymentInformation:"Company.CompanyProfile.companyProfileCard.paymentInformation",shippingInformation:"Company.CompanyProfile.companyProfileCard.shippingInformation",availablePaymentMethods:"Company.CompanyProfile.companyProfileCard.availablePaymentMethods",availableShippingMethods:"Company.CompanyProfile.companyProfileCard.availableShippingMethods",noPaymentMethods:"Company.CompanyProfile.companyProfileCard.noPaymentMethods",noShippingMethods:"Company.CompanyProfile.companyProfileCard.noShippingMethods"});if(!t)return a(J,{variant:"secondary",className:"account-company-profile-card",children:a("div",{className:"account-company-profile-card__wrapper",children:a("div",{className:"account-company-profile-card__content",children:a("div",{className:"account-company-profile-card__no-data",children:a("p",{children:n.noDataMessage})})})})});const d=t.permissionsFlags||{canViewAccount:!0,canViewAddress:!0,canViewContacts:!0,canViewPaymentInformation:!0,canViewShippingInformation:!0},r=[d.canViewAccount?{name:"name",label:n.companyName,value:t.name||"",legalName:t.legalName||""}:null,d.canViewAccount?{name:"email",label:n.email,value:t.email||""}:null,d.canViewAccount?{name:"vatTaxId",label:n.vatTaxId,value:t.vatTaxId||""}:null,d.canViewAccount?{name:"resellerId",label:n.resellerId,value:t.resellerId||""}:null].filter(Boolean);return a(J,{variant:"secondary",className:Z(["account-company-profile-card",["account-company-profile-card-short",o]]),children:f("div",{className:"account-company-profile-card__wrapper",children:[a("div",{className:"account-company-profile-card__actions",children:(t.canEditAccount||t.canEditAddress)&&a(X,{type:"button",variant:"tertiary",onClick:y,children:n.editButton})}),a("div",{className:"account-company-profile-card__content",children:(()=>{var C,p;const v=f(K,{children:[r.map((s,c)=>{if(!s.value)return null;let A;return s.name==="name"&&s.legalName?A=`${s.label}: ${s.value} (${s.legalName})`:A=s.label?`${s.label}: ${s.value}`:s.value,a("p",{"data-testid":`${s.name}_${c}`,children:A},`${s.name}_${c}`)}),d.canViewAddress&&t.legalAddress&&f("div",{className:"company-legal-address",children:[a("p",{children:f("strong",{children:[n.legalAddress,":"]})}),(C=t.legalAddress.street)==null?void 0:C.map((s,c)=>a("p",{children:s},c)),f("p",{children:[t.legalAddress.city,", ",(p=t.legalAddress.region)==null?void 0:p.region," ",t.legalAddress.postcode]}),a("p",{children:t.legalAddress.countryCode}),t.legalAddress.telephone&&f("p",{children:["Phone: ",t.legalAddress.telephone]})]}),d.canViewContacts&&(t.companyAdmin||t.salesRepresentative)&&f("div",{className:"company-contacts",children:[a("p",{children:f("strong",{children:[n.contacts,":"]})}),t.companyAdmin&&f("div",{className:"company-contact",children:[a("p",{children:f("strong",{children:[n.companyAdministrator,":"]})}),f("p",{children:[t.companyAdmin.firstname," ",t.companyAdmin.lastname]}),t.companyAdmin.jobTitle&&a("p",{children:t.companyAdmin.jobTitle}),a("p",{children:t.companyAdmin.email})]}),t.salesRepresentative&&f("div",{className:"company-contact",children:[a("p",{children:f("strong",{children:[n.salesRepresentative,":"]})}),f("p",{children:[t.salesRepresentative.firstname," ",t.salesRepresentative.lastname]}),a("p",{children:t.salesRepresentative.email})]})]}),d.canViewPaymentInformation&&f("div",{className:"company-payment-methods",children:[a("p",{children:f("strong",{children:[n.paymentInformation,":"]})}),t.availablePaymentMethods&&t.availablePaymentMethods.length>0?f(K,{children:[a("p",{children:f("strong",{children:[n.availablePaymentMethods,":"]})}),a("ul",{className:"payment-methods-list",children:t.availablePaymentMethods.map((s,c)=>a("li",{children:s.title},`payment_${c}`))})]}):a("div",{className:"message message-notice notice",children:a("div",{children:n.noPaymentMethods})})]}),d.canViewShippingInformation&&f("div",{className:"company-shipping-methods",children:[a("p",{children:f("strong",{children:[n.shippingInformation,":"]})}),t.availableShippingMethods&&t.availableShippingMethods.length>0?f(K,{children:[a("p",{children:f("strong",{children:[n.availableShippingMethods,":"]})}),a("ul",{className:"shipping-methods-list",children:t.availableShippingMethods.map((s,c)=>a("li",{children:s.title},`shipping_${c}`))})]}):a("div",{className:"message message-notice notice",children:a("div",{children:n.noShippingMethods})})]})]});return e!=null&&e.CompanyData?a(ye,{name:"CompanyData",slot:e.CompanyData,context:{companyData:r,Default:v}}):v})()})]})})},Te=t=>{const[e,o]=L(null),[y,n]=L(!0);W(()=>{let p=!0;return he().then(({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:A})=>{p&&(o({availableCountries:s,countriesWithRequiredRegion:c,optionalZipCountries:A}),n(!1))}).catch(()=>{p&&n(!1)}),()=>{p=!1}},[]);const d=U(()=>(e==null?void 0:e.availableCountries)||[],[e]),r=U(()=>{if(!t||!e)return[];const p=e.availableCountries.find(s=>s.value===t);return!(p!=null&&p.availableRegions)||p.availableRegions.length===0?[]:p.availableRegions.map(s=>({text:s.name,value:`${s.code},${s.id}`}))},[t,e]),v=U(()=>!t||!e?!1:e.countriesWithRequiredRegion.includes(t),[t,e]),C=U(()=>r.length>0,[r]);return{countryOptions:d,regionOptions:r,isRegionRequired:v,hasRegionOptions:C,loadingCountries:y}},$e=({loading:t,value:e,errors:o,touched:y,onBlur:n,namePrefix:d="",fieldPathPrefix:r=""})=>{const v=j({companyName:"Company.shared.fields.companyName",email:"Company.shared.fields.email",legalName:"Company.shared.fields.legalName",vatTaxId:"Company.shared.fields.vatTaxId",resellerId:"Company.shared.fields.resellerId"}),C=d?`${d}_`:"",p=s=>r?`${r}.${s}`:s;return f("div",{className:"account-edit-company-profile-form__group",children:[a(M,{label:v.companyName,required:!0,className:"account-edit-company-profile-form__field",error:y.name&&o.name?o.name:void 0,children:a(D,{name:`${C}name`,type:"text",value:e.name,onBlur:s=>{const c=s.target;n(p("name"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})}),a(M,{label:v.legalName,className:"account-edit-company-profile-form__field",children:a(D,{name:`${C}legalName`,type:"text",value:e.legalName,onBlur:s=>{const c=s.target;n(p("legalName"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:80})}),a(M,{label:v.email,required:!0,className:"account-edit-company-profile-form__field",error:y.email&&o.email?o.email:void 0,children:a(D,{name:`${C}email`,type:"email",value:e.email,onBlur:s=>{const c=s.target;n(p("email"),c.value)},disabled:!!t,variant:"primary",size:"medium"})}),a(M,{label:v.vatTaxId,className:"account-edit-company-profile-form__field",children:a(D,{name:`${C}vatTaxId`,type:"text",value:e.vatTaxId,onBlur:s=>{const c=s.target;n(p("vatTaxId"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})}),a(M,{label:v.resellerId,className:"account-edit-company-profile-form__field",children:a(D,{name:`${C}resellerId`,type:"text",value:e.resellerId,onBlur:s=>{const c=s.target;n(p("resellerId"),c.value)},disabled:!!t,variant:"primary",size:"medium",maxLength:40})})]})},we=({loading:t,loadingCountries:e,value:o,errors:y,touched:n,onChange:d,onBlur:r,countryOptions:v,regionOptions:C,isRegionRequired:p,hasRegionOptions:s,namePrefix:c="legalAddress",fieldPathPrefix:A="legalAddress",requiredConfig:N})=>{var S;const _=j({legalAddress:"Company.shared.fields.legalAddress",streetAddress:"Company.shared.fields.streetAddress",city:"Company.shared.fields.city",country:"Company.shared.fields.country",stateProvince:"Company.shared.fields.stateProvince",zipPostalCode:"Company.shared.fields.zipPostalCode",phoneNumber:"Company.shared.fields.phoneNumber"}),R={street:`${c}_street`,street2:`${c}_street2`,city:`${c}_city`,countryCode:`${c}_countryCode`,region:`${c}_region`,postcode:`${c}_postcode`,telephone:`${c}_telephone`},g={street:`${A}.street`,street2:`${A}.street2`,city:`${A}.city`,countryCode:`${A}.countryCode`,region:`${A}.region`,regionCode:`${A}.regionCode`,postcode:`${A}.postcode`,telephone:`${A}.telephone`},V={street:(N==null?void 0:N.street)??!0,city:(N==null?void 0:N.city)??!0,postcode:(N==null?void 0:N.postcode)??!0,telephone:(N==null?void 0:N.telephone)??!0};return f("div",{className:"account-edit-company-profile-form__section",children:[a("h3",{className:"account-edit-company-profile-form__section-title",children:_.legalAddress}),a(M,{label:_.streetAddress,required:V.street,className:"account-edit-company-profile-form__field",error:n[g.street]&&y[g.street]?y[g.street]:void 0,children:a(D,{name:R.street,type:"text",value:o.street,onBlur:m=>{const b=m.target;r(g.street,b.value)},disabled:!!t,variant:"primary",size:"medium"})}),a(M,{label:`${_.streetAddress} 2`,className:"account-edit-company-profile-form__field",children:a(D,{name:R.street2,type:"text",value:o.street2,onBlur:m=>{const b=m.target;r(g.street2,b.value)},disabled:!!t,variant:"primary",size:"medium"})}),a(M,{label:_.city,required:V.city,className:"account-edit-company-profile-form__field",error:n[g.city]&&y[g.city]?y[g.city]:void 0,children:a(D,{name:R.city,type:"text",value:o.city,onBlur:m=>{const b=m.target;r(g.city,b.value)},disabled:!!t,variant:"primary",size:"medium"})}),a(M,{label:_.country,required:!0,className:"account-edit-company-profile-form__field",error:n[g.countryCode]&&y[g.countryCode]?y[g.countryCode]:void 0,children:a(ue,{name:R.countryCode,floatingLabel:`${_.country} *`,placeholder:_.country,options:v,value:o.countryCode,handleSelect:m=>{const b=m.target;d(g.countryCode)(b.value)},onBlur:()=>r(g.countryCode),disabled:!!t||e})}),a(M,{label:_.stateProvince,required:p,className:"account-edit-company-profile-form__field",error:n["legalAddress.region"]&&y["legalAddress.region"]?y["legalAddress.region"]:void 0,children:s?a(ue,{name:"legalAddress_region",floatingLabel:`${_.stateProvince} ${p?"*":""}`,placeholder:_.stateProvince,options:C,value:o.regionCode&&((S=C.find(m=>m.value.split(",")[0]===o.regionCode))==null?void 0:S.value)||"",handleSelect:m=>{var P;const b=m.target,[k]=b.value.split(","),B=((P=C.find(z=>z.value===b.value))==null?void 0:P.text)||"";d(g.region)(B),d(g.regionCode)(k)},onBlur:()=>r(g.region),disabled:!!t||e},`region_picker_${o.countryCode}`):a(D,{name:R.region,type:"text",value:o.region,onBlur:m=>{const b=m.target;r(g.region,b.value)},disabled:!!t||e,variant:"primary",size:"medium"},`region_input_${o.countryCode}`)}),a(M,{label:_.zipPostalCode,required:V.postcode,className:"account-edit-company-profile-form__field",error:n[g.postcode]&&y[g.postcode]?y[g.postcode]:void 0,children:a(D,{name:R.postcode,type:"text",value:o.postcode,onBlur:m=>{const b=m.target;r(g.postcode,b.value)},disabled:!!t,variant:"primary",size:"medium"})}),a(M,{label:_.phoneNumber,required:V.telephone,className:"account-edit-company-profile-form__field",error:n[g.telephone]&&y[g.telephone]?y[g.telephone]:void 0,children:a(D,{name:R.telephone,type:"tel",value:o.telephone,onBlur:m=>{const b=m.target;r(g.telephone,b.value)},disabled:!!t,variant:"primary",size:"medium"})})]})},Pe=({inLineAlertProps:t,company:e,loading:o=!1,onSubmit:y,onCancel:n})=>{var H,Y,q,h,$,ee,te,ae,re,se,le,ne,ie,oe;const d=j({title:"Company.EditCompanyProfile.title",cancel:"Company.shared.buttons.cancel",save:"Company.shared.buttons.save",saving:"Company.shared.buttons.saving",required:"Company.shared.validation.required",invalidEmail:"Company.shared.validation.invalidEmail",companyNameRequired:"Company.shared.validation.companyNameRequired",emailRequired:"Company.shared.validation.emailRequired",emailNotAvailable:"Company.shared.validation.emailNotAvailable",companyNameLengthError:"Company.shared.validation.companyNameLengthError",legalNameLengthError:"Company.shared.validation.legalNameLengthError",vatTaxIdLengthError:"Company.shared.validation.vatTaxIdLengthError",resellerIdLengthError:"Company.shared.validation.resellerIdLengthError"}),[r,v]=L({name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||"",legalName:(e==null?void 0:e.legalName)||"",vatTaxId:(e==null?void 0:e.vatTaxId)||"",resellerId:(e==null?void 0:e.resellerId)||"",legalAddress:{street:((Y=(H=e==null?void 0:e.legalAddress)==null?void 0:H.street)==null?void 0:Y[0])||"",street2:((h=(q=e==null?void 0:e.legalAddress)==null?void 0:q.street)==null?void 0:h[1])||"",city:(($=e==null?void 0:e.legalAddress)==null?void 0:$.city)||"",region:((te=(ee=e==null?void 0:e.legalAddress)==null?void 0:ee.region)==null?void 0:te.region)||"",regionCode:((re=(ae=e==null?void 0:e.legalAddress)==null?void 0:ae.region)==null?void 0:re.regionCode)||"",countryCode:((se=e==null?void 0:e.legalAddress)==null?void 0:se.countryCode)||"",postcode:((le=e==null?void 0:e.legalAddress)==null?void 0:le.postcode)||"",telephone:((ne=e==null?void 0:e.legalAddress)==null?void 0:ne.telephone)||""}}),[C,p]=L({}),[s,c]=L({}),A=((ie=e==null?void 0:e.permissionsFlags)==null?void 0:ie.canEditAccount)===!0,N=((oe=e==null?void 0:e.permissionsFlags)==null?void 0:oe.canEditAddress)===!0,{countryOptions:_,regionOptions:R,isRegionRequired:g,hasRegionOptions:V,loadingCountries:S}=Te(r.legalAddress.countryCode),m=(l,i)=>l==="name"?i.trim()?i.length>40?d.companyNameLengthError:null:d.companyNameRequired:l==="email"?i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?null:d.invalidEmail:d.emailRequired:l==="legalName"?i.length>80?d.legalNameLengthError:null:l==="vatTaxId"?i.length>40?d.vatTaxIdLengthError:null:l==="resellerId"?i.length>40?d.resellerIdLengthError:null:l==="legalAddress.street"||l==="legalAddress.city"||l==="legalAddress.postcode"||l==="legalAddress.telephone"||l==="legalAddress.countryCode"?i.trim()?null:d.required:l==="legalAddress.region"&&g&&!i.trim()?d.required:null,b=()=>{var w,F;const l={};let i=!0;const T=((w=e==null?void 0:e.permissionsFlags)==null?void 0:w.canEditAccount)===!0,u=((F=e==null?void 0:e.permissionsFlags)==null?void 0:F.canEditAddress)===!0;if(T){const E=m("name",r.name);E&&(l.name=E,i=!1);const I=m("email",r.email);if(I&&(l.email=I,i=!1),r.legalName){const x=m("legalName",r.legalName);x&&(l.legalName=x,i=!1)}if(r.vatTaxId){const x=m("vatTaxId",r.vatTaxId);x&&(l.vatTaxId=x,i=!1)}if(r.resellerId){const x=m("resellerId",r.resellerId);x&&(l.resellerId=x,i=!1)}}if(u){const E=m("legalAddress.street",r.legalAddress.street);E&&(l["legalAddress.street"]=E,i=!1);const I=m("legalAddress.city",r.legalAddress.city);I&&(l["legalAddress.city"]=I,i=!1);const x=m("legalAddress.postcode",r.legalAddress.postcode);x&&(l["legalAddress.postcode"]=x,i=!1);const de=m("legalAddress.telephone",r.legalAddress.telephone);de&&(l["legalAddress.telephone"]=de,i=!1);const ce=m("legalAddress.countryCode",r.legalAddress.countryCode);ce&&(l["legalAddress.countryCode"]=ce,i=!1);const me=m("legalAddress.region",r.legalAddress.region);me&&(l["legalAddress.region"]=me,i=!1)}return p(l),i},k=async l=>{var w,F;l.preventDefault();const i=((w=e==null?void 0:e.permissionsFlags)==null?void 0:w.canEditAccount)===!0,T=((F=e==null?void 0:e.permissionsFlags)==null?void 0:F.canEditAddress)===!0,u={};if(i&&(u.name=!0,u.email=!0,u.legalName=!0,u.vatTaxId=!0,u.resellerId=!0),T&&(u["legalAddress.street"]=!0,u["legalAddress.street2"]=!0,u["legalAddress.city"]=!0,u["legalAddress.region"]=!0,u["legalAddress.regionCode"]=!0,u["legalAddress.countryCode"]=!0,u["legalAddress.postcode"]=!0,u["legalAddress.telephone"]=!0),c(u),!!b()){if(i&&r.email!==(e==null?void 0:e.email)){const E=await Ee(r.email);if(!E.isValid){p(I=>({...I,email:E.error||d.emailNotAvailable}));return}}if(y){const E={};i&&(E.name=r.name,E.email=r.email,E.legalName=r.legalName,E.vatTaxId=r.vatTaxId,E.resellerId=r.resellerId),T&&(E.legalAddress={street:[r.legalAddress.street,r.legalAddress.street2].filter(Boolean),city:r.legalAddress.city,region:{region:r.legalAddress.region,regionCode:r.legalAddress.regionCode},countryCode:r.legalAddress.countryCode,postcode:r.legalAddress.postcode,telephone:r.legalAddress.telephone}),await y(E)}}},B=(l,i)=>{if(l.startsWith("legalAddress.")){const T=l.split(".")[1];T==="countryCode"?(v(u=>({...u,legalAddress:{...u.legalAddress,[T]:i,region:"",regionCode:""}})),p(u=>{const w={...u};return delete w["legalAddress.region"],delete w["legalAddress.regionCode"],w}),c(u=>{const w={...u};return delete w["legalAddress.region"],delete w["legalAddress.regionCode"],w})):v(T==="region"?u=>({...u,legalAddress:{...u.legalAddress,region:i,regionCode:V?u.legalAddress.regionCode:i}}):u=>({...u,legalAddress:{...u.legalAddress,[T]:i}}))}else v(T=>({...T,[l]:i}))},P=l=>i=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),u=l.startsWith("legalAddress.");T.has(l)&&!A||u&&!N||(B(l,i),C[l]&&p(F=>{const E={...F};return delete E[l],E}))},z=(l,i)=>{const T=new Set(["name","email","legalName","vatTaxId","resellerId"]),u=l.startsWith("legalAddress.");if(T.has(l)&&!A||u&&!N)return;i!==void 0&&B(l,i),c(I=>({...I,[l]:!0}));let F=i;if(F===void 0)if(l.startsWith("legalAddress.")){const I=l.split(".")[1],x=r.legalAddress[I];F=typeof x=="string"?x:""}else{const I=r[l];F=typeof I=="string"?I:""}const E=m(l,F);p(E?I=>({...I,[l]:E}):I=>{const x={...I};return delete x[l],x})};return f(J,{variant:"secondary",className:"account-edit-company-profile",children:[a(ge,{title:d.title,divider:!1,className:"account-edit-company-profile__title"}),t!=null&&t.text?a(Ae,{className:"account-edit-company-profile__notification",type:t.type,variant:"secondary",heading:t.text,icon:t.icon,"data-testid":"editCompanyInLineAlert"}):null,f("form",{className:"account-edit-company-profile-form",onSubmit:k,children:[A&&a($e,{loading:o,value:{name:r.name,email:r.email,legalName:r.legalName,vatTaxId:r.vatTaxId,resellerId:r.resellerId},errors:C,touched:s,onBlur:z}),N&&a(we,{loading:o,loadingCountries:S,value:r.legalAddress,errors:C,touched:s,onChange:P,onBlur:z,countryOptions:_,regionOptions:R,isRegionRequired:g,hasRegionOptions:V}),f("div",{className:"account-edit-company-profile__actions",children:[a(X,{disabled:o,type:"button",variant:"secondary",onClick:()=>n==null?void 0:n(),children:d.cancel}),a(X,{disabled:o||!A&&!N,type:"submit",variant:"primary",children:d.save})]})]}),o&&f("div",{className:"account-edit-company-profile__loading-overlay","data-testid":"editCompanyLoadingOverlay",children:[a(Ce,{size:"large"}),a("div",{className:"account-edit-company-profile__loading-text",children:d.saving})]})]})};var fe=(t=>(t.EDIT_COMPANY_EVENT="edit-company",t))(fe||{});const Fe={EDIT_COMPANY_EVENT:"edit-company"},Me=()=>(window.adobeDataLayer||(window.adobeDataLayer=[]),window.adobeDataLayer),Re=t=>{Me().push(o=>{const y=o.getState?o.getState():{};o.push({event:t,context:y})})},De=(t,e)=>{if(!Fe[t])return null;switch(t){case"edit-company":Re({type:"company",eventType:"edit",companyData:e});break;default:return null}},Le=({handleSetInLineAlert:t,editFormRef:e})=>{const o=j({companySuccess:"Company.CompanyProfile.editCompanyProfile.companySuccess",companyError:"Company.CompanyProfile.editCompanyProfile.companyError",loadError:"Company.CompanyProfile.messages.loadError",updateError:"Company.CompanyProfile.messages.updateError"}),{companySuccess:y,companyError:n,loadError:d,updateError:r}=o,[v,C]=L(null),[p,s]=L(!0),[c,A]=L(!1),[N,_]=L(!1),[R,g]=L([]),[V,S]=L({}),m=G(t),b=G(!1),k=G(!1);W(()=>{m.current=t},[t]);const B=O(h=>{S(h)},[]),P=O((h,$)=>{t&&(h==="success"?t({type:"success",text:$??y}):h==="error"?t({type:"error",text:$??n}):t(),A(!1))},[t,y,n]),z=O(async()=>{if(b.current)return null;b.current=!0,s(!0);try{const h=await Ne();return h&&C(h),s(!1),h}catch(h){return console.error("Failed to load company:",h),s(!1),m.current&&m.current({type:"error",text:d}),null}finally{b.current=!1}},[d]);W(()=>{k.current||(k.current=!0,z())},[z]),W(()=>{const h=()=>{s(!0),_(!1),S({}),z()},$=pe.on("companyContext/changed",h,{eager:!0});return()=>{$==null||$.off()}},[z]),W(()=>{he().then(h=>{g(h.availableCountries)}).catch(h=>{console.error("Failed to load countries:",h)})},[]);const H=O(()=>{_(!0),P("success",""),S({})},[P]);W(()=>{N&&(e!=null&&e.current)&&setTimeout(()=>{var h;(h=e.current)==null||h.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},[N,e]);const Y=O(h=>{h==null||h(),_(!1),S({})},[]),q=O(async h=>{try{if(A(!0),!h){P("error","No data to update");return}const $=await be(h);C($),_(!1),S({}),P("success"),De(fe.EDIT_COMPANY_EVENT,{...h,companyId:v==null?void 0:v.id}),pe.emit("company/updated",{company:$})}catch($){console.error("Failed to update company:",$),P("error",$.message||r)}finally{A(!1)}},[v,P,r]);return{company:v,countries:R,loading:p,submitLoading:c,showEditForm:N,inputChange:V,handleShowEditForm:H,handleHideEditForm:Y,handleUpdateCompany:q,handleInputChange:B,renderAlertMessage:P,saving:c}},Qe=({className:t,withHeader:e=!0,slots:o})=>{const y=j({containerTitle:"Company.CompanyProfile.containerTitle"}),{inLineAlertProps:n,handleSetInLineAlert:d}=_e(),r=G(null),{company:v,loading:C,saving:p,showEditForm:s,handleShowEditForm:c,handleHideEditForm:A,handleUpdateCompany:N}=Le({handleSetInLineAlert:d,editFormRef:r});return C?a("div",{"data-testid":"companyProfileLoader",children:a(Ie,{withCard:!0})}):f("div",{className:Z(["account-company-profile",t]),children:[e?a(ge,{title:y.containerTitle,divider:!1,className:"company-profile__title"}):null,a(xe,{company:v,slots:o,showEditForm:s,handleShowEditForm:c}),s?a("div",{ref:r,children:a(Pe,{inLineAlertProps:n,company:v,loading:p,onSubmit:N,onCancel:A})}):null]})};export{Qe as CompanyProfile,Qe as default};
//# sourceMappingURL=CompanyProfile.js.map
