/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as j,Fragment as me}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as he,classes as ge}from"@dropins/tools/lib.js";import{Checkbox as be,Card as ie,InLineAlert as le,ProgressSpinner as de,Field as pe,Input as ye,Button as Y,Modal as fe,Header as Se}from"@dropins/tools/components.js";import{useMemo as ue,useRef as ae,useCallback as R,useState as N,useEffect as ne}from"@dropins/tools/preact-hooks.js";import{f as ve}from"../chunks/fetchUserPermissions.js";import{b as Ie}from"../chunks/company-permissions.js";import{useText as re}from"@dropins/tools/i18n.js";import{memo as Ce}from"@dropins/tools/preact-compat.js";import{C as Te}from"../chunks/CompanyUserForm.js";import{c as we,u as Ne,d as Ee}from"../chunks/useInLineAlert.js";import{events as se}from"@dropins/tools/event-bus.js";import{p as oe,E as ce}from"../chunks/acdl.js";import{a as xe,c as ke,b as De,g as _e,u as Ue,d as Me}from"../chunks/updateCompanyTeam.js";import{d as Ae}from"../chunks/updateCompanyUser.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";const Pe=d=>{const v=new Map;for(const u of d){const g=u.parentId??null,r=v.get(g)??[];r.push(u),v.set(g,r)}for(const[,u]of v)u.sort((g,r)=>g.label.localeCompare(r.label));return v},Fe=({items:d,rootId:v=null,className:u,expandedIds:g,selectedId:r=null,selectedIds:_,onExpandedChange:b,onSelectedChange:n,onSelectedIdsChange:S,renderNode:m,role:H="tree",draggable:w,canDrop:F,onMove:U,isCheckable:I,checkedIds:x,onCheckedChange:V,renderExpander:k,renderCheckbox:K,renderIcon:z})=>{const Q=ue(()=>Pe(d),[d]),y=ae(null),D=ae(!1),f=ue(()=>new Map(d.map(i=>[i.id,i])),[d]),B=(i,C)=>{const A=[],L=[C];for(;L.length;){const l=L.pop(),t=i.get(l)??[];for(const s of t)A.push(s.id),L.push(s.id)}return A},M=R(i=>B(Q,i),[Q]),O=R(i=>I?I(i):!0,[I]),E=R(i=>{if(!f.get(i))return{checked:!1,indeterminate:!1};const A=[i,...M(i)].filter(t=>{const s=f.get(t);return s?O(s):!1});if(A.length===0)return{checked:!1,indeterminate:!1};const L=x??new Set,l=A.reduce((t,s)=>L.has(s)?t+1:t,0);return l===0?{checked:!1,indeterminate:!1}:l===A.length?{checked:!0,indeterminate:!1}:{checked:!1,indeterminate:!0}},[f,M,O,x]),W=R(i=>{if(!V)return;const C=new Set(x??[]),{checked:A}=E(i),L=[i,...M(i)].filter(l=>{const t=f.get(l);return t?O(t):!1});if(A)for(const l of L)C.delete(l);else for(const l of L)C.add(l);V(C)},[x,V,E,M,f,O]),G=R(i=>a(be,{name:`tree-checkbox-${Math.random().toString(36).substr(2,9)}`,checked:i.checked,indeterminate:i.indeterminate,onChange:i.onCheck}),[]),X=R(i=>{const C=new Set(g);C.has(i)?C.delete(i):C.add(i),b(C)},[g,b]),te=R(i=>{const C=f.get(i);if(C&&O(C)&&V&&W(i),!S){n==null||n(i);return}const A=!!D.current,L=A?new Set(_??[]):new Set;A&&L.has(i)?L.delete(i):L.add(i),S(L),D.current=!1},[n,S,_,f,O,V,W]),Z=(i,C)=>{const A=Q.get(i)??[];return A.length?a("ul",{role:C===1?H:"group",className:C===1?u??"acm-tree":"acm-tree__group",children:A.map((l,t)=>{const s=(Q.get(l.id)??[]).length>0,h=g.has(l.id),e=_?_.has(l.id):r===l.id,o=!!(w!=null&&w(l)),T=p=>F?F(p,l.id):p!==l.id,c=s?()=>k?k({expanded:h,hasChildren:s,toggle:()=>X(l.id)}):null:void 0,P=(()=>{if(!V)return;const p=f.get(l.id);if(!p||!O(p))return;const q=E(l.id),J=K||G;return()=>J({checked:q.checked,indeterminate:q.indeterminate,onCheck:()=>W(l.id)})})(),$=z?()=>z({item:l,level:C,hasChildren:s,expanded:h}):void 0,ee=m({item:l,level:C,expanded:h,selected:!!e,hasChildren:s,toggle:()=>X(l.id),select:()=>te(l.id),...c?{expander:c}:{},...P?{checkbox:P}:{},...$?{icon:$}:{}});return j("li",{role:"treeitem",className:"acm-tree__item","data-level":C,"aria-expanded":s?h:void 0,"aria-selected":e||void 0,"aria-level":C,"aria-setsize":A.length,"aria-posinset":t+1,draggable:o,onMouseDown:p=>{D.current=!!(p.metaKey||p.ctrlKey)},onDragStart:p=>{var q;if(p.stopPropagation(),!!o){y.current=l.id;try{(q=p.dataTransfer)==null||q.setData("text/plain",l.id)}catch{}}},onDragOver:p=>{var J;p.stopPropagation();const q=y.current??(((J=p.dataTransfer)==null?void 0:J.getData("text/plain"))||"");q&&T(q)&&p.preventDefault()},onDrop:p=>{var J;p.stopPropagation();const q=y.current??(((J=p.dataTransfer)==null?void 0:J.getData("text/plain"))||"");y.current=null,q&&T(q)&&(U==null||U({id:q,newParentId:l.id}))},children:[ee,s&&h?Z(l.id,C+1):null]},l.id)})}):null};return a("div",{className:"acm-tree-root",children:Z(v,1)})};function Le(d){const{mode:v,entityId:u,parentStructureId:g,onSaved:r}=d,_=re({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError"}),[b,n]=N({id:"",name:"",description:""}),[S,m]=N({}),[H,w]=N({}),[F,U]=N(!1),[I,x]=N(null);ne(()=>{v!=="edit"||!u||(U(!0),xe(u).then(y=>{y&&n({id:y.id,name:y.name||"",description:y.description||""})}).finally(()=>U(!1)))},[v,u]);const V=(y,D)=>y==="name"?D.trim()?null:_.teamTitleRequired:null,k=(y,D)=>{n(f=>({...f,[y]:D})),I&&x(null)},K=(y,D)=>{D!==void 0&&k(y,D),w(M=>({...M,[y]:!0}));const f=D!==void 0?D:b[y]||"",B=V(y,f);m(B?M=>({...M,[y]:B}):M=>{const O={...M};return delete O[y],O})},z=ue(()=>!!b.name.trim(),[b.name]);return{values:b,errors:S,touched:H,loading:F,setValue:k,onBlur:K,canSubmit:z,submit:async()=>{const y=V("name",b.name);if(y){m({name:y}),w({name:!0});return}const D=b.name;try{if(v==="add"){const f=await ke({name:b.name,description:b.description||null,targetId:g??null});if(!f){x(_.createTeamError);return}r({label:D,structureId:f.structureId,entityId:f.id,type:"team",description:b.description||void 0})}else u&&(await De({id:u,name:b.name,description:b.description||null}),r({label:D,entityId:u,type:"team",description:b.description||void 0}))}catch(f){const B=f instanceof Error?f.message:_.saveTeamError;x(B)}},generalError:I}}const Re=Ce(({mode:d,entityId:v,parentStructureId:u,permissions:g,onSaved:r,onCancel:_})=>{const b=(g==null?void 0:g.canEditUsers)??!1,{values:n,errors:S,touched:m,loading:H,onBlur:w,canSubmit:F,submit:U,generalError:I}=Le({mode:d,entityId:v,parentStructureId:u,onSaved:r}),[x,V]=N(!1),k=re({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return j("div",{children:[a("h3",{className:"acm-structure-panel__title",children:d==="add"?k.addTeam:k.editTeam}),j(ie,{variant:"secondary",className:`company-team-form__card ${x?"is-working":""}`,children:[I?a(le,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:I}):null,x?a("div",{className:"company-team-form__overlay","aria-live":"polite",children:a(de,{size:"small"})}):null,H?a(we,{}):j("div",{className:"company-team-form__content",children:[a(pe,{label:k.teamTitle,required:!0,className:"acm-structure-panel__field",error:m.name&&S.name?S.name:void 0,children:a(ye,{name:"team_title",type:"text",value:n.name,onBlur:K=>{const z=K.target;w("name",z.value)},variant:"primary",size:"medium",disabled:!b})}),a(pe,{label:k.description,className:"acm-structure-panel__field",children:a(ye,{name:"team_description",type:"textarea",value:n.description||"",onBlur:K=>{const z=K.target;w("description",z.value)},variant:"primary",size:"medium",disabled:!b})})]})]}),H?null:j("div",{className:"acm-structure-modal__actions",children:[a(Y,{type:"button",variant:"primary",onClick:async()=>{if(!x){V(!0);try{await U()}finally{V(!1)}}},disabled:!F||x,children:"Save"}),a(Y,{type:"button",variant:"secondary",disabled:x,onClick:_,children:"Cancel"})]})]})});function Ve({handleSetInLineAlert:d,permissions:v}={permissions:null}){const u=(v==null?void 0:v.canViewUsers)??!1,g=re({structureSuccess:"Company.CompanyStructure.messages.structureSuccess",structureError:"Company.CompanyStructure.messages.structureError",loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem"}),{structureSuccess:r,structureError:_,loadError:b,updateError:n}=g,[S,m]=N(null),[H,w]=N(!0),[F,U]=N(!1),[I,x]=N(!1),[V,k]=N(new Set),[K,z]=N(null),[Q,y]=N(new Set),[D,f]=N({}),B=ae(d),M=ae(!1),O=ae(!1);ne(()=>{B.current=d},[d]);const E=R((t,s)=>{d&&(t==="success"?d({type:"success",text:s??r}):t==="error"?d({type:"error",text:s??_}):d(),U(!1))},[d,r,_]),W=R(async()=>{if(M.current)return null;if(M.current=!0,!u)return w(!1),m(null),k(new Set),z(null),y(new Set),M.current=!1,null;w(!0);try{const s=await _e();return m(s),k(new Set(s.map(h=>h.id))),w(!1),s}catch{return w(!1),B.current&&B.current({type:"error",text:b}),null}finally{M.current=!1}},[u,b]);ne(()=>{u&&!O.current&&(O.current=!0,W())},[u,W]),ne(()=>{const t=()=>{w(!0),k(new Set),z(null),y(new Set),W()},s=se.on("companyContext/changed",t,{eager:!0});return()=>{s==null||s.off()}},[W]);const G=R(async(t,s)=>{try{return U(!0),await Ue({id:t,parentId:s})?(m(e=>e?e.map(o=>o.id===t?{...o,parentId:s}:o):null),k(e=>new Set([...e,s])),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:t,newParentId:s}),se.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:t,newParentId:s,nodes:S||[]}),E("success"),!0):(E("error",g.failedToMoveItem),!1)}catch(h){const e=h instanceof Error?h.message:n;return E("error",e),!1}finally{U(!1)}},[S,E,n,g.failedToMoveItem]),X=R(()=>{S&&k(new Set(S.map(t=>t.id)))},[S]),te=R(()=>{if(S){const t=S.filter(s=>s.parentId===null).map(s=>s.id);k(new Set(t))}},[S]),Z=R(t=>{m(s=>{const h=s?[...s,{id:t.id,parentId:t.parentId,label:t.label,type:t.type,entityId:t.entityId,description:t.description}]:[{id:t.id,parentId:t.parentId,label:t.label,type:t.type,entityId:t.entityId,description:t.description}];return se.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:t.id,newParentId:t.parentId||void 0,nodes:h}),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:t.id,newParentId:t.parentId||void 0,nodeType:t.type}),h}),t.parentId&&k(s=>new Set([...s,t.parentId]))},[]),i=R((t,s,h)=>{s&&m(e=>e?e.map(o=>t.includes(o.id)?{...o,label:s,description:h}:o):null)},[]),C=R(async t=>{if(t.length)try{U(!0);const s=new Map((S||[]).map(h=>[h.id,h]));for(const h of t){const e=s.get(h);!e||!e.entityId||(e.type==="team"?await Me(e.entityId):await Ae(e.entityId))}m(h=>{if(!h)return null;const e=new Set(t);return h.filter(o=>!e.has(o.id))}),z(null),y(new Set),oe(ce.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:t}),se.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:t,nodes:S||[]}),E("success")}catch(s){const h=s instanceof Error?s.message:n;E("error",h)}finally{U(!1)}},[S,E,n]),A=R(t=>{f(t)},[]),L=R(()=>{x(!0),E("success",""),f({})},[E]),l=R(t=>{t==null||t(),x(!1),f({})},[]);return{nodes:S,loading:H,submitLoading:F,showEditForm:I,inputChange:D,expanded:V,setExpanded:k,selected:K,setSelected:z,selectedMany:Q,setSelectedMany:y,move:G,expandAll:X,collapseAll:te,insertNode:Z,renameNodes:i,removeNodes:C,handleInputChange:A,handleShowEditForm:L,handleHideEditForm:l,renderAlertMessage:E,working:F}}const ze=Ce(({permissions:d,slots:v})=>{var h;const u=(d==null?void 0:d.canEditUsers)??!1,g=(d==null?void 0:d.canViewUsers)??!1,r=re({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:_,handleSetInLineAlert:b}=Ne(),{nodes:n,loading:S,submitLoading:m,expanded:H,setExpanded:w,selected:F,setSelected:U,selectedMany:I,setSelectedMany:x,move:V,expandAll:k,collapseAll:K,insertNode:z,renameNodes:Q,removeNodes:y}=Ve({handleSetInLineAlert:b,permissions:d}),[D,f]=N(null),[B,M]=N("add"),[O,E]=N(!1),[W,G]=N([]),[X,te]=N({title:"",body:"",confirmLabel:r.remove,blocked:!1}),[Z,i]=N(null),C=()=>f(null),A=((h=n==null?void 0:n.find(e=>e.parentId===null))==null?void 0:h.id)??null,L=(n||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label})),l=(e,o)=>{let T=e;const c=new Map(L.map($=>[$.id,$])),P=new Set;for(;T&&!P.has(T);){P.add(T);const $=c.get(T);if(!$)break;if($.parentId===o)return!0;T=$.parentId??null}return!1},t=(n||[]).map(e=>({id:e.id,parentId:e.parentId,label:e.label,type:e.type,description:e.description,entityId:e.entityId})),s=j(me,{children:[(()=>{const e=I!=null&&I.size?Array.from(I):F?[F]:[],o=u&&e.length===1,T=u&&e.length>=1;return a(ie,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:j("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":r.companyStructureActions,children:[a(Y,{type:"button",variant:"secondary",onClick:k,"aria-label":r.expandAllNodes,disabled:!g,"aria-disabled":!g,children:r.expandAll}),a(Y,{type:"button",variant:"secondary",onClick:K,"aria-label":r.collapseAllNodes,disabled:!g,"aria-disabled":!g,children:r.collapseAll}),a(Y,{type:"button",variant:"primary",onClick:()=>{M("add"),f("user")},"aria-label":r.addUserAria,disabled:!u,"aria-disabled":!u,children:r.addUser}),a(Y,{type:"button",variant:"primary",onClick:()=>{M("add"),f("team")},"aria-label":r.addTeamAria,disabled:!u,"aria-disabled":!u,children:r.addTeam}),a(Y,{type:"button",variant:"primary",disabled:!o,"aria-disabled":!o,"aria-label":r.editSelectedAria,onClick:()=>{if(!o)return;const c=e,P=n==null?void 0:n.find($=>$.id===c[0]);(P==null?void 0:P.type)==="user"?(M("edit"),f("user")):(M("edit"),f("team"))},children:r.editSelected}),a(Y,{type:"button",variant:"secondary",disabled:!T||m,"aria-disabled":!T||m,"aria-label":r.removeSelectedAria,onClick:()=>{if(!T||m)return;const c=e;if(c.length===1){const P=n==null?void 0:n.find(ee=>ee.id===c[0]);if(!P)return;(n==null?void 0:n.some(ee=>ee.parentId===P.id))?(te({title:P.type==="user"?r.cannotDeleteUser:r.cannotDeleteTeam,body:P.type==="user"?r.cannotDeleteUserMessage:r.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),G([]),E(!0)):(te({title:P.type==="user"?r.removeUserConfirm:r.deleteTeamConfirm,body:P.type==="user"?r.removeUserMessage:r.deleteTeamMessage,confirmLabel:P.type==="user"?r.remove:r.delete,blocked:!1}),G(c),E(!0))}else te({title:r.removeItemsConfirm,body:r.removeItemsMessage,confirmLabel:r.remove,blocked:!1}),G(c),E(!0)},children:r.remove})]})})})(),D?j("div",{className:"acm-structure-panel",children:[m?j("div",{className:"acm-structure-working","aria-live":"polite",children:[a(de,{size:"small"})," ",r.processing]}):null,D==="user"?(()=>{const e=I!=null&&I.size?Array.from(I):F?[F]:[],o=e.length?n==null?void 0:n.find(c=>c.id===e[0]):void 0,T=(o==null?void 0:o.id)??A;return a(Te,{mode:B,entityId:o==null?void 0:o.entityId,parentStructureId:T,permissions:d,onSaved:c=>{B==="add"?c.structureId&&(z({id:c.structureId,parentId:T,label:c.label,type:c.type,entityId:c.entityId}),c.structureId&&(U(c.structureId),x(new Set([c.structureId])))):e.length&&Q(e,c.label),C()},onCancel:C})})():null,D==="team"?(()=>{const e=I!=null&&I.size?Array.from(I):F?[F]:[],o=e.length?n==null?void 0:n.find(c=>c.id===e[0]):void 0,T=(o==null?void 0:o.id)??A;return a(Re,{mode:B,entityId:o==null?void 0:o.entityId,parentStructureId:T,permissions:d,onSaved:c=>{B==="add"?c.structureId&&(z({id:c.structureId,parentId:T,label:c.label,type:c.type,entityId:c.entityId,description:c.description}),c.structureId&&(U(c.structureId),x(new Set([c.structureId])))):e.length&&Q(e,c.label,c.description),C()},onCancel:C})})():null]}):null,j(ie,{variant:"secondary",className:`acm-structure-tree-card ${m?"is-working":""}`,children:[_&&_.text?a(le,{className:"acm-structure-panel__notification",type:_.type||"success",variant:"secondary",heading:_.text}):null,!S&&!m&&n&&n.length===0?a(le,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:r.noStructureData}):null,!S&&m?a("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:a(de,{size:"medium"})}):null,S?a("div",{className:"acm-structure-tree-content",children:a(Ee,{rows:8})}):a("div",{className:"acm-structure-tree-content",children:a(Fe,{rootId:null,items:L,expandedIds:H,selectedId:F,selectedIds:I,onExpandedChange:w,onSelectedChange:U,onSelectedIdsChange:x,renderExpander:({expanded:e,toggle:o})=>a("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${e?"is-open":""}`,"aria-label":e?r.collapse:r.expand,onClick:T=>{T.stopPropagation(),o()},children:e?"âˆ’":"+"}),renderNode:({item:e,hasChildren:o,select:T,expander:c,checkbox:P,icon:$})=>{var ee;return j("div",{className:"acm-structure-row",onClick:T,children:[o?c?a("span",{onClick:p=>p.stopPropagation(),children:c()}):a("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}):a("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}),a("span",{className:"acm-structure-handle","aria-hidden":!0}),$?a("span",{onClick:p=>p.stopPropagation(),children:$()}):a("span",{className:`acm-structure-icon ${((ee=n==null?void 0:n.find(p=>p.id===e.id))==null?void 0:ee.type)==="team"?"is-team":"is-user"}`,"aria-hidden":!0}),P?a("span",{onClick:p=>p.stopPropagation(),children:P()}):null,a("span",{className:"acm-structure-label",children:e.label}),(()=>{const p=n==null?void 0:n.find(J=>J.id===e.id),q=(p==null?void 0:p.type)==="team"&&p.description||"";return q?a(Y,{type:"button",variant:"secondary",onClick:J=>{J.stopPropagation(),i({id:e.id,text:q})},"aria-label":r.showDescription,className:"acm-structure-description-button",children:"?"}):null})()]})},draggable:()=>!m&&u,canDrop:(e,o)=>{if(!u||e===o)return!1;const T=n==null?void 0:n.find(c=>c.id===e);return T&&T.parentId===o?!1:!l(o,e)},onMove:async({id:e,newParentId:o})=>{u&&await V(e,o)}})})]}),O?a(fe,{open:O,onClose:()=>{m||(E(!1),G([]))},children:j("div",{className:"acm-structure-modal-content",children:[a("h3",{className:"acm-structure-modal-title",children:X.title}),a("div",{children:X.body}),a("div",{className:"acm-structure-modal-actions",children:X.blocked?a(Y,{type:"button",variant:"secondary",disabled:m,onClick:()=>{m||(E(!1),G([]))},children:r.ok}):j(me,{children:[a(Y,{type:"button",variant:"secondary",disabled:m,onClick:()=>{m||(E(!1),G([]))},children:r.cancel}),a(Y,{type:"button",variant:"primary",disabled:m,onClick:async()=>{await y(W),E(!1),G([])},children:m?X.confirmLabel===r.delete?r.deleting:r.removing:X.confirmLabel||r.remove})]})})]})}):null,Z?a(fe,{open:!!Z,onClose:()=>i(null),children:j("div",{className:"acm-structure-modal-content",children:[a("h3",{className:"acm-structure-modal-title",children:r.teamDescription}),a("div",{children:Z.text}),a("div",{className:"acm-structure-modal-actions",children:a(Y,{type:"button",variant:"secondary",onClick:()=>i(null),children:r.close})})]})}):null]});return v!=null&&v.StructureData?a(he,{name:"StructureData",slot:v.StructureData,context:{structureData:t,Default:s}}):s}),Oe=()=>{const d=re({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[v,u]=N(null),[g,r]=N(!0),[_,b]=N(null);return ne(()=>{let n=!0;return(async()=>{var m,H;try{r(!0),b(null);const{roleResponse:w}=await ve();if(!n)return;const F=(H=(m=w==null?void 0:w.data)==null?void 0:m.customer)==null?void 0:H.role,U=Ie(F);u(U)}catch(w){if(!n)return;b(w instanceof Error?w:new Error(d.fetchPermissionsError))}finally{n&&r(!1)}})(),()=>{n=!1}},[]),{permissions:v,loading:g,error:_}},at=({className:d,withHeader:v=!1,slots:u})=>{const g=re({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:r}=Oe();return j("div",{className:ge(["account-company-structure",d]),children:[v?a(Se,{title:g.containerTitle,divider:!1,className:"company-structure__title"}):null,a(ze,{slots:u,permissions:r})]})};export{at as CompanyStructure,at as default};
//# sourceMappingURL=CompanyStructure.js.map
