{"version":3,"file":"isProductConfigurationValid.js","sources":["/@dropins/storefront-pdp/src/lib/url-params.ts","/@dropins/storefront-pdp/src/data/transforms/acdl-context.ts","/@dropins/storefront-pdp/src/lib/acdl.ts","/@dropins/storefront-pdp/src/data/models/acdl-models.ts","/@dropins/storefront-pdp/src/data/transforms/product-transform.ts","/@dropins/storefront-pdp/src/api/initialize/initialize.ts","/@dropins/storefront-pdp/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-pdp/src/api/getProductData/graphql/getProductData.graphql.ts","/@dropins/storefront-pdp/src/api/getProductData/getProductData.ts","/@dropins/storefront-pdp/src/api/getRefinedProduct/graphql/RefineProductQuery.graphql.ts","/@dropins/storefront-pdp/src/api/getRefinedProduct/getRefinedProduct.ts","/@dropins/storefront-pdp/src/api/fetchProductData/fetchProductData.ts","/@dropins/storefront-pdp/src/api/setProductConfigurationValues/setProductConfigurationValues.ts","/@dropins/storefront-pdp/src/api/getProductConfigurationValues/getProductConfigurationValues.ts","/@dropins/storefront-pdp/src/api/setProductConfigurationValid/setProductConfigurationValid.ts","/@dropins/storefront-pdp/src/api/isProductConfigurationValid/isProductConfigurationValid.ts"],"sourcesContent":["/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nexport function setUrlParams(\n  params: Record<string, string | number | null>\n): void {\n  const urlSearchParams = new URLSearchParams(window.location.search);\n\n  Object.entries(params).forEach(([key, value]) => {\n    if (value === null) {\n      urlSearchParams.delete(key);\n    } else {\n      urlSearchParams.set(key, String(value));\n    }\n  });\n\n  let url = window.location.pathname;\n  url += `?${urlSearchParams.toString()}`;\n  url += window.location.hash;\n\n  window.history.replaceState({}, '', url);\n}\n\nexport function getUrlParams(): Record<string, string> {\n  const urlSearchParams = new URLSearchParams(window.location.search);\n  const params: Record<string, string> = {};\n\n  urlSearchParams.forEach((value, key) => {\n    params[key] = value;\n  });\n\n  return params;\n}\n\nexport function getValidatedQuantityFromUrl(\n  defaultQuantity: number = 1\n): number {\n  const urlParams = getUrlParams() || {};\n  const quantityParam = urlParams.quantity; // 'quantity' is the key\n\n  if (quantityParam) {\n    const parsedQuantity = parseInt(quantityParam, 10);\n\n    if (\n      !isNaN(parsedQuantity) &&\n      Number.isInteger(parsedQuantity) &&\n      parsedQuantity > 0\n    ) {\n      // Return the valid quantity from the URL\n      return parsedQuantity;\n    }\n  }\n\n  // Return the default quantity if the parameter is missing, invalid, or not positive\n  return defaultQuantity;\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { ProductModel } from '../models';\n\nimport { Product } from '../models/acdl-models';\n\nexport function transformProduct(product: ProductModel): Product {\n  return {\n    productId: Number(product?.externalId),\n    name: product?.name,\n    sku: product?.variantSku || product?.sku,\n    topLevelSku: product?.sku,\n    specialToDate: undefined,\n    specialFromDate: undefined,\n    newToDate: undefined,\n    newFromDate: undefined,\n    createdAt: undefined,\n    updatedAt: undefined,\n    manufacturer: undefined,\n    countryOfManufacture: undefined,\n    categories: undefined,\n    productType: product?.productType,\n    pricing: {\n      regularPrice: product?.prices?.regular?.amount || 0,\n      minimalPrice: product?.prices?.final?.minimumAmount,\n      maximalPrice: product?.prices?.final?.maximumAmount,\n      specialPrice: product?.prices?.final?.amount,\n      tierPricing: undefined,\n      currencyCode: product?.prices?.final?.currency || 'USD',\n    },\n    canonicalUrl: product?.url,\n    mainImageUrl: product?.images?.[0]?.url,\n  };\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\n/* Publish functions for the Adobe Client Data Layer (ACDL) */\n\nimport { ProductModel } from '../data/models';\nimport { transformProduct } from '../data/transforms/acdl-context';\n\n/**\n * See: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/contexts.ts\n */\nexport const contexts = {\n  PRODUCT_CONTEXT: 'productContext',\n  CHANNEL_CONTEXT: 'channelContext',\n};\n\n/**\n * See: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/events.ts\n */\nexport const events = {\n  PRODUCT_PAGE_VIEW: 'product-page-view',\n};\n\nexport function getAdobeDataLayer() {\n  // @ts-ignore\n  window.adobeDataLayer = window.adobeDataLayer || [];\n  // @ts-ignore\n  return window.adobeDataLayer;\n}\n\nexport function getChannelContext() {\n  return {\n    _id: 'https://ns.adobe.com/xdm/channels/web',\n    _type: 'https://ns.adobe.com/xdm/channel-types/web',\n  };\n}\n\n/**\n * Sets a context in the Adobe Client Data Layer (ACDL)\n * Logic based on: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/Base.ts#L6\n */\nfunction setContext(name: string, data: any) {\n  const adobeDataLayer = getAdobeDataLayer();\n\n  // Clear existing context\n  adobeDataLayer.push({\n    [name]: null,\n  });\n\n  // Set new context\n  adobeDataLayer.push({\n    [name]: data,\n  });\n}\n\nexport function setChannelContext() {\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  setContext(contexts.CHANNEL_CONTEXT, getChannelContext());\n}\n\n/**\n * Pushes an event to the Adobe Client Data Layer (ACDL)\n * Logic based on: https://github.com/adobe/commerce-events/blob/1973d0ce28471ef190fa06dad6359ffa0ab51db6/packages/storefront-events-sdk/src/Base.ts#L34\n */\nfunction pushEvent(event: string, additionalContext?: any) {\n  const adobeDataLayer = getAdobeDataLayer();\n\n  adobeDataLayer.push((acdl: any) => {\n    const state = acdl.getState ? acdl.getState() : {};\n\n    acdl.push({\n      event,\n      eventInfo: {\n        ...state,\n        ...additionalContext,\n      },\n    });\n  });\n}\n\n// Triggered when a product page is viewed\nexport function publishProductPageViewEvent(product: ProductModel) {\n  const productItem = transformProduct(product);\n  setContext(contexts.PRODUCT_CONTEXT, productItem);\n  setChannelContext();\n  pushEvent(events.PRODUCT_PAGE_VIEW);\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\n/**\n * ACDL Product Types from:\n * https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/types/schemas/product.ts\n */\n\nexport type Product = {\n  productId: number;\n  name: string;\n  sku: string;\n  topLevelSku?: string | null;\n  specialToDate?: string | null;\n  specialFromDate?: string | null;\n  newToDate?: string | null;\n  newFromDate?: string | null;\n  createdAt?: string | null;\n  updatedAt?: string | null;\n  manufacturer?: string | null;\n  countryOfManufacture?: string | null;\n  categories?: string[] | null;\n  productType?: ProductType;\n  pricing?: {\n    regularPrice: number;\n    minimalPrice?: number;\n    maximalPrice?: number;\n    specialPrice?: number;\n    tierPricing?: {\n      customerGroupId?: number | null;\n      qty: number;\n      value: number;\n    }[];\n    currencyCode: string | null;\n  };\n  canonicalUrl?: string | null;\n  mainImageUrl?: string | null;\n};\n\nexport enum ProductType {\n  ComplexProduct = 'complex',\n  SimpleProduct = 'simple'\n}\n\nexport enum ProductViewType {\n  ComplexProductView = 'ComplexProductView',\n  SimpleProductView = 'SimpleProductView'\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\nimport { merge } from '@adobe-commerce/elsie/lib';\nimport { config } from '@/pdp/api';\nimport { ProductModel } from '@/pdp/data/models';\nimport { ProductType, ProductViewType } from '../models/acdl-models';\n\nexport function transformProductData(\n  data: any,\n  options?: {\n    preselectFirstOption?: boolean;\n  }\n): ProductModel | null {\n  const isBundle =\n    data?.options?.[0]?.values?.[0]?.__typename ===\n    'ProductViewOptionValueProduct';\n  const optionUIDs = getOptionUIDs(\n    data,\n    isBundle,\n    options?.preselectFirstOption\n  );\n  const productType =\n    data?.__typename === ProductViewType.SimpleProductView\n      ? ProductType.SimpleProduct\n      : ProductType.ComplexProduct;\n\n  const productData = data\n    ? ({\n        name: data.name,\n        sku: data.sku,\n        isBundle,\n        addToCartAllowed: data.addToCartAllowed,\n        inStock: data.inStock,\n        shortDescription: data.shortDescription,\n        metaDescription: data.metaDescription,\n        metaKeyword: data.metaKeyword,\n        metaTitle: data.metaTitle,\n        description: data.description,\n        images: transformImages(data),\n        prices: transformPrices(data, isBundle, optionUIDs),\n        attributes: transformAttributes(data),\n        options: transformOptions(data, isBundle),\n        optionUIDs,\n        url: data.url,\n        urlKey: data.urlKey,\n        externalId: data.externalId,\n        externalParentId: data.externalParentId,\n        variantSku: data.variantSku,\n        productType,\n      } as ProductModel)\n    : null;\n\n  // extend the model with custom transformer\n  return merge(\n    productData,\n    config.getConfig()?.models?.ProductDetails?.transformer?.(data) ??\n      config.getConfig()?.models?.ProductDetails?.transform?.(data)\n  );\n}\n\nfunction transformImages(data: any) {\n  return data.images\n    ?.filter((image: any) => !image.roles?.includes('hide_from_pdp'))\n    ?.map((image: any) => {\n      // Remove protocol from image URL\n      image.url = image.url.replace(/^https?:/, '');\n\n      return image;\n    });\n}\n\nfunction transformAttributes(data: any) {\n  return (\n    data.attributes\n      // only show attributes that are visible in PDP\n      ?.filter(({ roles }: any) => roles?.indexOf('visible_in_pdp') !== -1)\n      // transform attribute values\n      ?.map(({ label, value, name }: any) => {\n        return {\n          id: name,\n          label,\n          value: value.toString().split(',').join(', '),\n        };\n      })\n  );\n}\n\nfunction transformOptions(data: any, isBundle?: boolean) {\n  const { options, optionUIDs } = data;\n\n  return options?.map(({ id, title, required, multi, values }: any) => {\n    const typename = values?.[0]?.__typename;\n    let type: string = values?.[0].type;\n\n    if (type) {\n      type = type\n        .replace('COLOR_HEX', 'color')\n        .replace('TEXT', 'text')\n        .replace('IMAGE', 'image');\n    } else {\n      type = 'dropdown';\n    }\n\n    return {\n      id,\n      type,\n      typename,\n      label: title,\n      required,\n      multiple: multi,\n      items: isBundle\n        ? mapBundleOptionValues(values, optionUIDs)\n        : mapOptionValues(values, optionUIDs, type),\n    };\n  });\n}\n\nfunction mapBundleOptionValues(values: any, optionUIDs: string[]) {\n  return values\n    ?.filter(({ enabled }: any) => typeof enabled === 'undefined' || enabled)\n    .map(({ id, title, inStock, isDefault, product }: any) => {\n      return {\n        id,\n        inStock,\n        label: title,\n        selected: optionUIDs?.indexOf(id) > -1 || isDefault,\n        value: id,\n        product,\n      };\n    });\n}\n\nfunction mapOptionValues(values: any, optionUIDs: string[], type: string) {\n  return values?.map(({ id, title, inStock, value }: any) => {\n    return {\n      id,\n      inStock,\n      label: title,\n      selected: optionUIDs?.indexOf(id) > -1,\n      value:\n        type?.toLowerCase() === 'dropdown'\n          ? id\n          : value?.replace(/^https?:/, ''),\n    };\n  });\n}\n\nfunction transformPrices(\n  data: any,\n  isBundle: boolean,\n  defaultOptionUIDs?: string[]\n) {\n  const { price, priceRange, options, optionUIDs = defaultOptionUIDs } = data;\n  let { __typename: type } = data;\n\n  function getSimpleProductPrices() {\n    const regularPrice = price?.regular.amount.value;\n    const finalPrice =\n      price?.final?.amount.value ?? price?.regular.amount.value;\n\n    const currency =\n      price?.regular.amount.currency === 'NONE' //temporary fix if there is no currency\n        ? 'USD'\n        : price?.regular.amount.currency;\n\n    return [regularPrice, finalPrice, finalPrice, currency];\n  }\n\n  function getComplexProductPrices() {\n    const finalMinimumPrice = priceRange?.minimum?.final.amount.value;\n    const finalMaximumPrice = priceRange?.maximum?.final.amount.value;\n    let regularPrice;\n\n    if (\n      priceRange?.minimum?.regular?.amount.value ===\n      priceRange?.maximum?.regular?.amount.value\n    ) {\n      regularPrice = priceRange?.minimum?.regular?.amount.value;\n    }\n\n    const currency =\n      priceRange?.minimum?.final?.amount.currency === 'NONE'\n        ? 'USD'\n        : priceRange?.minimum?.final?.amount.currency;\n\n    return [regularPrice, finalMinimumPrice, finalMaximumPrice, currency];\n  }\n\n  function getBundleProductPrice() {\n    // Currently the Catalog Service does not have support for the individual prices of the options of a fixed bundle,\n    // so the price used in UI is taken from the priceRange object.\n\n    // The dynamic bundle has full support in Catalog Service.\n    // If there are pre-selected values of the option, then the starting price is the sum of those and\n    // after each selection, the price is updated with the sum of prices for the selected options.\n    // This is not supported by default and needs to be updated in the drop-in upon each selection.\n\n    let maxSumRegular = 0;\n    let bundlePrice = 0;\n    options?.forEach((option: any) => {\n      const values = option?.values;\n      if (values && Array.isArray(values)) {\n        const regularAmounts = values\n          .map((value) => value?.product?.price?.regular?.amount?.value)\n          .filter((amount) => amount !== undefined);\n\n        const maxRegularAmount =\n          regularAmounts.length > 0 ? Math.max(...regularAmounts) : 0;\n        maxSumRegular += maxRegularAmount;\n      }\n      option?.values?.forEach((value: any) => {\n        if (optionUIDs?.includes(value.id)) {\n          bundlePrice += value?.product?.price?.final?.amount?.value;\n        }\n      });\n    });\n\n    const finalMinimumPrice = priceRange?.minimum?.final.amount.value;\n    const finalMaximumPrice = priceRange?.maximum?.final.amount.value;\n    let regularPrice;\n\n    if (\n      priceRange?.minimum?.regular?.amount.value ===\n      priceRange?.maximum?.regular?.amount.value\n    ) {\n      regularPrice = priceRange?.minimum?.regular?.amount.value;\n    }\n\n    const currency =\n      priceRange?.minimum?.final?.amount.currency === 'NONE'\n        ? 'USD'\n        : priceRange?.minimum?.final?.amount.currency;\n\n    if (isBundle && optionUIDs?.length < 1) {\n      return [regularPrice, finalMinimumPrice, finalMaximumPrice, currency];\n    }\n\n    return maxSumRegular === priceRange?.maximum?.regular.amount.value\n      ? [bundlePrice, bundlePrice, bundlePrice, currency]\n      : [regularPrice, finalMinimumPrice, finalMaximumPrice, currency];\n  }\n\n  const [regularPrice, finalMinimumPrice, finalMaximumPrice, currency] =\n    type === 'SimpleProductView'\n      ? getSimpleProductPrices()\n      : isBundle\n      ? getBundleProductPrice()\n      : getComplexProductPrices();\n\n  const visible =\n    type === 'SimpleProductView'\n      ? price?.roles?.includes('visible')\n      : priceRange?.maximum?.roles?.includes('visible') &&\n        priceRange?.minimum?.roles?.includes('visible');\n\n  if (finalMaximumPrice && finalMinimumPrice === finalMaximumPrice) {\n    const hasDiscount = regularPrice && finalMinimumPrice !== regularPrice;\n\n    return {\n      regular: {\n        amount: regularPrice,\n        currency,\n        variant: hasDiscount ? 'strikethrough' : 'default',\n      },\n      final: {\n        amount: finalMaximumPrice,\n        currency,\n        variant: 'default',\n      },\n      visible,\n    };\n  }\n\n  return {\n    final: {\n      minimumAmount: finalMinimumPrice,\n      maximumAmount: finalMaximumPrice,\n      currency,\n    },\n    visible,\n  };\n}\n\nfunction getOptionUIDs(\n  data: any,\n  isBundle?: boolean,\n  preselectFirstOption?: boolean\n): string[] {\n  if (isBundle) {\n    const selections: Array<string | null> = data?.options?.map(\n      ({ values }: any) => {\n        const defaultSelection =\n          values?.find(({ isDefault }: any) => isDefault)?.id ?? null;\n        const preselectedFirstOption = preselectFirstOption\n          ? values[0].id\n          : null;\n        return defaultSelection || preselectedFirstOption;\n      }\n    );\n\n    return selections.filter((selection) => selection !== null) as string[];\n  }\n\n  return data?.optionUIDs;\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { Initializer } from '@adobe-commerce/elsie/lib';\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { ProductModel } from '@/pdp/data/models';\nimport {\n  fetchProductData,\n  setProductConfigurationValid,\n  setProductConfigurationValues,\n} from '@/pdp/api';\nimport { events } from '@adobe-commerce/event-bus';\nimport {\n  getUrlParams,\n  getValidatedQuantityFromUrl,\n} from '@/pdp/lib/url-params';\nimport { publishProductPageViewEvent } from '@/pdp/lib/acdl';\nimport { transformProductData } from '@/pdp/data/transforms/product-transform';\n\ntype ConfigProps = {\n  scope?: string;\n  langDefinitions?: Lang;\n  defaultLocale?: string;\n  sku?: string;\n  acdl?: boolean;\n  anchors?: string[];\n  persistURLParams?: boolean;\n  preselectFirstOption?: boolean;\n  optionsUIDs?: string[];\n  models?: {\n    [name: string]: {\n      initialData: any;\n      /** @deprecated Use \"transformer\" instead */\n      transform?: (data?: ProductModel) => ProductModel;\n      transformer?: (data?: ProductModel) => ProductModel;\n      fallbackData?: (\n        parentProduct: any,\n        simpleProduct: ProductModel\n      ) => ProductModel;\n    };\n  };\n};\n\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (_config) => {\n    const initialData = _config?.models?.ProductDetails?.initialData;\n\n    // Get URL parameters safely\n    const urlParams = getUrlParams() || {};\n\n    // Get optionsUIDs from URL params or config\n    const optionsUIDs =\n      urlParams.optionsUIDs?.split(',') || initialData?.optionsUIDs;\n\n    // Get and validate quantity from URL params\n    const initialQuantity = getValidatedQuantityFromUrl(1); // Default quantity to 1 - Ensures backward compatibility\n\n    // Set default config\n    const defaultConfig: ConfigProps = {\n      defaultLocale: 'en-US',\n      persistURLParams: false,\n      acdl: false,\n      optionsUIDs,\n    };\n\n    const config = { ...defaultConfig, ..._config };\n\n    initialize.config.setConfig({ ...config });\n\n    if (config?.sku) {\n      // Get PDP data\n      const data = initialData\n        ? transformProductData(initialData)\n        : await fetchProductData(config.sku, {\n            preselectFirstOption: config.preselectFirstOption,\n          });\n\n      // Emit PDP initial data\n      events.emit('pdp/data', data, { scope: config.scope });\n\n      // Set default values for product configuration\n      const defaultValues = {\n        sku: config.sku,\n        quantity: initialQuantity, // Use the determined quantity from URL params or default to 1\n        optionsUIDs: data?.optionUIDs,\n      };\n\n      setProductConfigurationValues(() => ({ ...defaultValues }), {\n        scope: config.scope,\n      });\n\n      setProductConfigurationValid(\n        () => {\n          // configurable product, check if all options are selected\n          if (data?.options) {\n            // all selections should be made\n            return data.options.length === data?.optionUIDs?.length;\n          }\n\n          // simple product\n          return true;\n        },\n        { scope: config.scope }\n      );\n\n      // Publish ACDL event\n      if (config.acdl && data) {\n        publishProductPageViewEvent(data);\n      }\n    }\n  },\n\n  listeners: () => [\n    events.on('locale', async () => {\n      const { sku, scope } = initialize.config.getConfig();\n\n      if (sku) {\n        const next = await fetchProductData(sku);\n        events.emit('pdp/data', next, { scope });\n      }\n    }),\n  ],\n});\n\nexport const config = initialize.config;\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { PRODUCT_FRAGMENT } from '@/pdp/api/graphql/ProductFragment.graphql';\n\nexport const GET_PRODUCT_DATA = `\nquery GET_PRODUCT_DATA($skus: [String]) {\n    products(skus: $skus) {\n        ...PRODUCT_FRAGMENT\n    }\n}\n\n${PRODUCT_FRAGMENT}\n`;\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { fetchGraphQl } from '@/pdp/api';\nimport { ProductModel } from '@/pdp/data/models';\nimport { transformProductData } from '@/pdp/data/transforms';\nimport { GET_PRODUCT_DATA } from './graphql/getProductData.graphql';\n\nexport const getProductData = async (\n  sku: string,\n  options?: {\n    preselectFirstOption?: boolean;\n    optionsUIDs?: string[];\n  },\n  raw?: boolean\n): Promise<ProductModel | null> => {\n  const { data } = await fetchGraphQl(GET_PRODUCT_DATA, {\n    method: 'GET',\n    variables: { skus: [sku] },\n  });\n\n  const product = data?.products?.[0];\n\n  // If optionsUIDs are provided, override the optionsUIDs from the response\n  if (options?.optionsUIDs) {\n    product.optionUIDs = options.optionsUIDs;\n  }\n\n  if (!product) {\n    return null;\n  }\n  return raw\n    ? product\n    : transformProductData(product, {\n        preselectFirstOption: options?.preselectFirstOption,\n      });\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { PRODUCT_FRAGMENT } from '@/pdp/api/graphql/ProductFragment.graphql';\n\nexport const REFINE_PRODUCT_QUERY = `\nquery REFINE_PRODUCT_QUERY(\n    $optionIds: [String!]!\n    $sku: String!\n) {\n    # Refined Product\n    refineProduct(\n        optionIds: $optionIds \n        sku: $sku\n    ) {\n        ...PRODUCT_FRAGMENT\n    }\n\n    # Parent Product\n    products(skus: [$sku]) {\n        ...PRODUCT_FRAGMENT\n    }\n\n    # %extendedPlaceholder%\n}\n\n${PRODUCT_FRAGMENT}\n`;\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2023 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { fetchGraphQl, config } from '@/pdp/api';\nimport { ProductModel } from '@/pdp/data/models';\nimport { transformProductData } from '@/pdp/data/transforms';\nimport { REFINE_PRODUCT_QUERY } from './graphql/RefineProductQuery.graphql';\n\nasync function getProductData(sku: string, optionUIDs: string[]): Promise<any> {\n  const optionPairCombinations = getPairCombination(optionUIDs);\n  const optionQueries = getProductOptionQuery(optionPairCombinations, sku);\n\n  const mergedQueries = REFINE_PRODUCT_QUERY.replace(\n    '# %extendedPlaceholder%',\n    optionQueries\n  );\n\n  const { data } = await fetchGraphQl(mergedQueries, {\n    method: 'GET',\n    variables: { optionIds: optionUIDs, sku },\n  });\n  return data;\n}\n\nexport const getRefinedProduct = async (\n  sku: string,\n  optionUIDs: string[],\n  anchorOptions?: string[],\n  raw?: boolean\n): Promise<ProductModel | null> => {\n  const data = await getProductData(sku, optionUIDs);\n  if (!data) return null;\n\n  let { products, refineProduct, ...refinedOptions } = data;\n\n  const parent = products?.[0];\n\n  const options = mergeRefinedOptions(\n    Object.values(refinedOptions),\n    parent.options,\n    anchorOptions\n  );\n\n  // needed when anchor options exist\n  if (anchorOptions?.length && refineProduct === null) {\n    optionUIDs = updateSelections(options, optionUIDs, anchorOptions);\n    const updatedRefinedData = await getProductData(sku, optionUIDs);\n    refineProduct = updatedRefinedData?.refineProduct;\n  }\n\n  const response = {\n    ...(refineProduct || parent),\n    sku: parent.sku,\n    name: parent.name,\n    externalParentId: parent?.externalId,\n    options,\n    optionUIDs,\n    variantSku:\n      refineProduct?.__typename === 'SimpleProductView'\n        ? refineProduct?.sku\n        : undefined,\n  };\n\n  const refinedData = raw ? response : transformProductData(response);\n\n  const fallback = config?.getConfig()?.models?.ProductDetails?.fallbackData;\n\n  if (fallback) {\n    return fallback(parent, refinedData!);\n  }\n\n  return refinedData;\n};\n\nfunction getPairCombination(arr: string[]): string[][] {\n  if (arr.length < 2) {\n    return [arr];\n  }\n\n  const result: string[][] = [];\n\n  arr.forEach((item) => {\n    const temp: string[] = [];\n\n    arr.forEach((item2) => {\n      if (item !== item2) {\n        temp.push(item2);\n      }\n    });\n\n    result.push(temp);\n  });\n\n  return result;\n}\n\nfunction getProductOptionQuery(optionUIDs: string[][], sku: string): string {\n  return optionUIDs\n    .map((ids: string[], i: number) => {\n      return `\n          ProductOption${i}: refineProduct(\n            optionIds: [\n              ${ids.map((id) => `\"${id}\"`).join(', ')}\n            ]\n            sku: \"${sku}\"\n          ) {\n            ... on ComplexProductView {\n              options {\n                ...PRODUCT_OPTION_FRAGMENT\n              }\n            }\n          }\n        `;\n    })\n    .join('');\n}\n\nfunction mergeRefinedOptions(\n  options: {},\n  parent: [] = [],\n  anchorOptions?: string[]\n) {\n  // flat _refined[].options[] to _refinedOptions[]\n  const refinedOptions: any = Object.values(options)\n    .filter((x) => !!x)\n    .reduce((acc: any, curr: any) => {\n      if (!curr.options) return [...acc];\n\n      return [...acc, ...curr.options];\n    }, []);\n\n  // Create a map to store items by their id from original\n  const map = new Map(parent.map((item: any) => [item.id, item]));\n\n  // Iterate through refinedOptions and merge items\n  refinedOptions.forEach((current: any) => {\n    // anchor options should display all values, so no merge is performed\n    if (anchorOptions?.includes(current.id)) {\n      return;\n    }\n\n    map.set(current.id, current);\n  });\n\n  return [...map.values()];\n}\n\nfunction updateSelections(\n  options: any[],\n  optionsUIDs: string[],\n  anchorOptions: string[]\n): string[] {\n  const updatedOptionsUIDs: string[] = [];\n\n  let optionValue: string;\n  options.forEach((option: any) => {\n    if (anchorOptions.includes(option.id)) {\n      optionValue =\n        option.values?.find((value: any) => optionsUIDs.includes(value?.id))\n          ?.id || option.values[0]?.id;\n    } else {\n      optionValue = option.values[0]?.id; // TODO check if we should use default value instead\n    }\n    updatedOptionsUIDs.push(optionValue);\n  });\n  return updatedOptionsUIDs;\n}\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { getProductData, getRefinedProduct, config } from '@/pdp/api';\n\nexport type Options = {\n  anchors?: string[];\n  optionsUIDs?: string[];\n  preselectFirstOption?: boolean;\n  isBundle?: boolean;\n  skipTransform?: boolean;\n};\n\nexport const fetchProductData = async (sku: string, options?: Options) => {\n  // Get the default configuration values\n  const { anchors: defaultAnchors, optionsUIDs: defaultOptionsUIDs } =\n    config.getConfig();\n\n  // Destructure the options object\n  const {\n    optionsUIDs = defaultOptionsUIDs,\n    anchors = defaultAnchors,\n    preselectFirstOption,\n    isBundle,\n    skipTransform,\n  } = options ?? {};\n\n  // ❗️ Warning ❗️\n  // If we have default selections, but we cannot determine that the product is of type bundle, then the response is going to result in null objects and error(s).\n  // Only the `products` object will be populated correctly, the `ProductOption${i}` and `refinedProduct` will be set as null.\n  // This does not affect the UI, but the error message(s) can be detected by 3rd party tools that the client might be using.\n  // This is accepted as a known behaviour, since a bundle product does not have variants.\n  // However, if initialData is passed from the integration layer, then we can determine if the product is a bundle and set the isBundle flag accordingly.\n  return !isBundle && optionsUIDs\n    ? await getRefinedProduct(sku, optionsUIDs, anchors, skipTransform)\n    : await getProductData(\n        sku,\n        {\n          preselectFirstOption,\n          optionsUIDs,\n        },\n        skipTransform\n      );\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { events } from '@adobe-commerce/event-bus';\nimport { ValuesModel } from '@/pdp/data/models';\nimport { getProductConfigurationValues } from '@/pdp/api';\n\nexport const setProductConfigurationValues = (\n  callback: (prev: ValuesModel) => ValuesModel,\n  options?: { scope?: string }\n) => {\n  const prev = getProductConfigurationValues({ scope: options?.scope });\n\n  const next = callback(prev as ValuesModel);\n\n  events.emit('pdp/values', { ...next }, { scope: options?.scope });\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { events } from '@adobe-commerce/event-bus';\nimport { ValuesModel } from '@/pdp/data/models';\n\nexport const getProductConfigurationValues = ({\n  scope,\n}: { scope?: string } = {}): ValuesModel | null => {\n  return events.lastPayload('pdp/values', { scope }) ?? null;\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { events } from '@adobe-commerce/event-bus';\nimport { isProductConfigurationValid } from '@/pdp/api';\n\nexport const setProductConfigurationValid = (\n  callback: (prev: boolean) => boolean,\n  options?: { scope?: string }\n) => {\n  const prev = isProductConfigurationValid({ scope: options?.scope });\n\n  const next = callback(prev as boolean);\n\n  events.emit('pdp/valid', next, { scope: options?.scope });\n};\n","/**\n * ADOBE CONFIDENTIAL\n * __________________\n * Copyright 2024 Adobe\n * All Rights Reserved.\n * __________________\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n */\n\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const isProductConfigurationValid = ({\n  scope,\n}: { scope?: string } = {}): boolean | null => {\n  return events.lastPayload('pdp/valid', { scope }) ?? null;\n};\n"],"names":["setUrlParams","params","urlSearchParams","key","value","url","getUrlParams","getValidatedQuantityFromUrl","defaultQuantity","quantityParam","parsedQuantity","transformProduct","product","_b","_a","_d","_c","_f","_e","_h","_g","_j","_i","_l","_k","contexts","events","getAdobeDataLayer","getChannelContext","setContext","name","data","adobeDataLayer","setChannelContext","pushEvent","event","additionalContext","acdl","state","publishProductPageViewEvent","productItem","ProductType","ProductViewType","transformProductData","options","isBundle","optionUIDs","getOptionUIDs","productType","productData","transformImages","transformPrices","transformAttributes","transformOptions","merge","config","image","roles","label","id","title","required","multi","values","typename","type","mapBundleOptionValues","mapOptionValues","enabled","inStock","isDefault","defaultOptionUIDs","price","priceRange","getSimpleProductPrices","regularPrice","finalPrice","currency","getComplexProductPrices","finalMinimumPrice","finalMaximumPrice","getBundleProductPrice","maxSumRegular","bundlePrice","option","regularAmounts","amount","maxRegularAmount","_m","visible","preselectFirstOption","defaultSelection","preselectedFirstOption","selection","initialize","Initializer","_config","initialData","optionsUIDs","initialQuantity","fetchProductData","defaultValues","setProductConfigurationValues","setProductConfigurationValid","sku","scope","next","setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","GET_PRODUCT_DATA","PRODUCT_FRAGMENT","getProductData","raw","REFINE_PRODUCT_QUERY","optionPairCombinations","getPairCombination","optionQueries","getProductOptionQuery","mergedQueries","getRefinedProduct","anchorOptions","products","refineProduct","refinedOptions","parent","mergeRefinedOptions","updateSelections","updatedRefinedData","response","refinedData","fallback","arr","result","item","temp","item2","ids","i","x","acc","curr","map","current","updatedOptionsUIDs","optionValue","defaultAnchors","defaultOptionsUIDs","anchors","skipTransform","callback","prev","getProductConfigurationValues","isProductConfigurationValid"],"mappings":"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"}