{"version":3,"file":"MiniCart.js","sources":["/@dropins/storefront-cart/src/components/MiniCart/MiniCart.tsx","/@dropins/storefront-cart/src/containers/MiniCart/MiniCart.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { VComponent, classes } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\n\nimport '@/cart/components/MiniCart/MiniCart.css';\n\nexport interface MiniCartProps extends HTMLAttributes<HTMLDivElement> {\n  products?: VNode;\n  productListFooter?: VNode;\n  subtotal?: VNode;\n  subtotalExcludingTaxes?: VNode;\n  preCheckoutSection?: VNode;\n  ctas?: VNode;\n}\n\nexport const MiniCart: FunctionComponent<MiniCartProps> = ({\n  className,\n  products,\n  productListFooter,\n  subtotal,\n  subtotalExcludingTaxes,\n  preCheckoutSection,\n  ctas,\n  ...props\n}) => {\n  const dictionary = useText({\n    subtotal: 'Cart.MiniCart.subtotal',\n    subtotalExcludingTaxes: 'Cart.MiniCart.subtotalExcludingTaxes',\n  });\n\n  return (\n    <div {...props} className={classes(['cart-mini-cart', className])}>\n      {/* Content */}\n      {products && (\n        <>\n          <div\n            className=\"cart-mini-cart__products\"\n            data-testid=\"mini-cart-products-wrapper\"\n          >\n            {products}\n          </div>\n\n          {/* Product List Footer */}\n          {productListFooter && (\n            <div\n              className={classes(['cart-mini-cart__productListFooter'])}\n              data-testid=\"mini-cart-product-list-footer\"\n            >\n              <VComponent node={productListFooter} />\n            </div>\n          )}\n\n          <div\n            className=\"cart-mini-cart__footer\"\n            data-testid=\"mini-cart-subtotals\"\n          >\n            {/* Subtotal */}\n            {subtotal && (\n              <div\n                className=\"cart-mini-cart__footer__estimated-total\"\n                data-testid=\"mini-cart-subtotal\"\n              >\n                {dictionary.subtotal}\n                <VComponent node={subtotal} />\n              </div>\n            )}\n            {/* Subtotal Excluding Taxes */}\n            {subtotalExcludingTaxes && (\n              <div\n                className=\"cart-mini-cart__footer__estimated-total-excluding-taxes\"\n                data-testid=\"mini-cart-subtotal-excluding-taxes\"\n              >\n                {dictionary.subtotalExcludingTaxes}\n                <VComponent\n                  node={subtotalExcludingTaxes}\n                  className={classes([\n                    'dropin-price-summary__price',\n                    'dropin-price-summary__price--muted',\n                  ])}\n                />\n              </div>\n            )}\n\n            {/* Pre-checkout section */}\n            {preCheckoutSection && (\n              <div\n                className={classes(['cart-mini-cart__preCheckoutSection'])}\n                data-testid=\"mini-cart-pre-checkout-section\"\n              >\n                <VComponent node={preCheckoutSection} />\n              </div>\n            )}\n\n            {ctas && (\n              <VComponent\n                node={ctas}\n                className=\"cart-mini-cart__footer__ctas\"\n              />\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  HTMLAttributes,\n  useCallback,\n  useEffect,\n  useState,\n} from 'preact/compat';\nimport { Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { CartModel } from '@/cart/data/models';\nimport { getPersistedCartData } from '@/cart/lib/persisted-data';\nimport { events } from '@adobe-commerce/event-bus';\nimport { MiniCart as MiniCartComponent } from '@/cart/components';\nimport { CartSummaryList } from '@/cart/containers';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { Button, ImageProps, Price } from '@adobe-commerce/elsie/components';\nimport { updateProductsFromCart } from '@/cart/api';\nimport { publishInitiateCheckoutEvent } from '@/cart/lib/acdl';\nimport { state } from '@/cart/lib/state';\n\nexport interface MiniCartProps extends HTMLAttributes<HTMLDivElement> {\n  routeProduct?: (item: CartModel['items'][0]) => string;\n  routeCart?: () => string;\n  routeCheckout?: () => string;\n  routeEmptyCartCTA?: () => string;\n  slots?: {\n    ProductList?: SlotProps;\n    ProductListFooter?: SlotProps;\n    PreCheckoutSection?: SlotProps;\n    Thumbnail?: SlotProps<{\n      item: CartModel['items'][number];\n      defaultImageProps: ImageProps;\n    }>;\n    Heading?: SlotProps;\n    EmptyCart?: SlotProps;\n    Footer?: SlotProps;\n    ProductAttributes?: SlotProps;\n    CartSummaryFooter?: SlotProps;\n    CartItem?: SlotProps; // For backward compatibility\n    UndoBanner?: SlotProps<{\n      item: CartModel['items'][0];\n      loading: boolean;\n      error?: string;\n      onUndo: () => void;\n      onDismiss: () => void;\n    }>;\n    ItemTitle?: SlotProps<{ item: CartModel['items'][number] }>;\n    ItemPrice?: SlotProps<{ item: CartModel['items'][number] }>;\n    ItemQuantity?: SlotProps<{\n      item: CartModel['items'][number];\n      enableUpdateItemQuantity: boolean;\n      handleItemQuantityUpdate: (\n        item: CartModel['items'][number],\n        quantity: number\n      ) => void;\n      itemsLoading: Set<string>;\n      handleItemsError: (uid: string, message?: string) => void;\n      handleItemsLoading: (uid: string, state: boolean) => void;\n      onItemUpdate?: ({ item }: { item: CartModel['items'][number] }) => void;\n    }>;\n    ItemTotal?: SlotProps<{ item: CartModel['items'][number] }>;\n    ItemSku?: SlotProps<{ item: CartModel['items'][number] }>;\n    ItemRemoveAction?: SlotProps<{\n      item: CartModel['items'][number];\n      enableRemoveItem: boolean;\n      handleItemQuantityUpdate: (\n        item: CartModel['items'][number],\n        quantity: number\n      ) => void;\n      handleItemsError: (uid: string, message?: string) => void;\n      handleItemsLoading: (uid: string, state: boolean) => void;\n      onItemUpdate?: ({ item }: { item: CartModel['items'][number] }) => void;\n      itemsLoading: Set<string>;\n    }>;\n  };\n  hideFooter?: boolean;\n  displayAllItems?: boolean;\n  showDiscount?: boolean;\n  showSavings?: boolean;\n  enableItemRemoval?: boolean;\n  enableQuantityUpdate?: boolean;\n  hideHeading?: boolean;\n  undo?: boolean;\n}\n\nexport const MiniCart: Container<MiniCartProps, CartModel | null> = ({\n  children,\n  initialData = null,\n  hideFooter = true, // Default to true for MiniCart\n  slots,\n  routeProduct,\n  routeCart,\n  routeCheckout,\n  routeEmptyCartCTA,\n  showDiscount,\n  showSavings,\n  enableItemRemoval = true, // Default to true for MiniCart\n  enableQuantityUpdate = false, // Default to false for MiniCart\n  hideHeading = false, // Default to false for MiniCart\n  undo = false,\n  ...props\n}) => {\n  const [data, setData] = useState<CartModel | null>(initialData);\n  const cartTaxesConfig = state.config?.shoppingCartDisplaySetting;\n\n  useEffect(() => {\n    const event = events.on(\n      'cart/data',\n      (payload) => {\n        setData(payload as CartModel);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      event?.off();\n    };\n  }, []);\n\n  const dictionary = useText({\n    cartLink: 'Cart.MiniCart.cartLink',\n    checkoutLink: 'Cart.MiniCart.checkoutLink',\n  });\n\n  const handleItemQuantityUpdate = (uid: string, quantity: number) => {\n    return updateProductsFromCart([{ uid, quantity }]);\n  };\n\n  const handleItemRemove = (uid: string) => handleItemQuantityUpdate(uid, 0);\n\n  const checkoutLinkDisabled = data?.hasOutOfStockItems;\n\n  const handleInitiateCheckout = useCallback(() => {\n    if (data && !checkoutLinkDisabled) {\n      publishInitiateCheckoutEvent(data, state.locale);\n    }\n  }, [data, checkoutLinkDisabled]);\n\n  const productList = (\n    <Slot\n      name=\"ProductList\"\n      slot={slots?.ProductList}\n      context={{\n        itemQuantityUpdateHandler: handleItemQuantityUpdate,\n        itemRemoveHandler: handleItemRemove,\n        totalQuantity: data?.totalQuantity,\n      }}\n    >\n      <CartSummaryList\n        data-testid=\"default-cart-summary-list\"\n        routeProduct={routeProduct}\n        routeEmptyCartCTA={routeEmptyCartCTA}\n        initialData={data}\n        maxItems={state.config?.miniCartMaxItemsDisplay}\n        showMaxItems={!!state.config?.miniCartMaxItemsDisplay}\n        hideHeading={hideHeading || !data?.totalQuantity}\n        hideFooter={hideFooter}\n        enableRemoveItem={enableItemRemoval}\n        enableUpdateItemQuantity={enableQuantityUpdate}\n        showDiscount={showDiscount}\n        showSavings={showSavings}\n        undo={undo}\n        slots={{\n          Thumbnail: slots?.Thumbnail,\n          Heading: slots?.Heading,\n          EmptyCart: slots?.EmptyCart,\n          Footer: slots?.Footer,\n          ProductAttributes: slots?.ProductAttributes,\n          CartSummaryFooter: slots?.CartSummaryFooter,\n          CartItem: slots?.CartItem, // Keep for backward compatibility\n          UndoBanner: slots?.UndoBanner,\n          ItemTitle: slots?.ItemTitle,\n          ItemPrice: slots?.ItemPrice,\n          ItemQuantity: slots?.ItemQuantity,\n          ItemTotal: slots?.ItemTotal,\n          ItemSku: slots?.ItemSku,\n          ItemRemoveAction: slots?.ItemRemoveAction,\n        }}\n      />\n    </Slot>\n  );\n\n  const getProductListFooter = (data: CartModel | null) => {\n    return (\n      <Slot\n        name=\"ProductListFooter\"\n        slot={slots?.ProductListFooter}\n        context={{\n          data,\n        }}\n      />\n    );\n  };\n\n  const getPreCheckoutSection = (data: CartModel | null) => {\n    return (\n      <Slot\n        name=\"PreCheckoutSection\"\n        slot={slots?.PreCheckoutSection}\n        context={{\n          data,\n        }}\n      />\n    );\n  };\n\n  const getSubtotalPriceProps = () =>\n    cartTaxesConfig?.subtotal === 'INCLUDING_TAX' ||\n    cartTaxesConfig?.subtotal === 'INCLUDING_EXCLUDING_TAX'\n      ? {\n          amount: data?.subtotal.includingTax.value,\n          currency: data?.subtotal.includingTax.currency,\n          'data-testid': 'subtotal-including-tax',\n          style: { font: 'inherit' },\n        }\n      : {\n          amount: data?.subtotal.excludingTax.value,\n          currency: data?.subtotal.excludingTax.currency,\n          'data-testid': 'subtotal-excluding-tax',\n          style: { font: 'inherit' },\n        };\n\n  return (\n    <MiniCartComponent\n      {...props}\n      productListFooter={getProductListFooter(data)}\n      subtotal={\n        !data?.totalQuantity\n          ? undefined\n          : data?.subtotal && <Price {...getSubtotalPriceProps()} />\n      }\n      subtotalExcludingTaxes={\n        !data?.totalQuantity\n          ? undefined\n          : data?.subtotal &&\n            (cartTaxesConfig?.subtotal === 'INCLUDING_EXCLUDING_TAX' ? (\n              <Price\n                amount={data?.subtotal.excludingTax.value}\n                currency={data?.subtotal.excludingTax.currency}\n                data-testid=\"subtotal-including-excluding-tax\"\n                style={{ font: 'inherit' }}\n              />\n            ) : undefined)\n      }\n      preCheckoutSection={getPreCheckoutSection(data)}\n      ctas={\n        !data?.totalQuantity ? undefined : (\n          <div>\n            {routeCheckout && (\n              <Button\n                data-testid=\"route-checkout-button\"\n                variant=\"primary\"\n                href={checkoutLinkDisabled ? undefined : routeCheckout()}\n                disabled={checkoutLinkDisabled}\n                aria-disabled={checkoutLinkDisabled}\n                onClick={handleInitiateCheckout}\n              >\n                {dictionary.checkoutLink}\n              </Button>\n            )}\n            {routeCart && (\n              <Button\n                data-testid=\"route-cart-button\"\n                variant=\"tertiary\"\n                href={routeCart()}\n              >\n                {dictionary.cartLink}\n              </Button>\n            )}\n          </div>\n        )\n      }\n      products={productList}\n    />\n  );\n};\n\nMiniCart.getInitialData = async function () {\n  return getPersistedCartData();\n};\n"],"names":["MiniCart","className","products","productListFooter","subtotal","subtotalExcludingTaxes","preCheckoutSection","ctas","props","dictionary","useText","jsx","classes","jsxs","Fragment","VComponent","children","initialData","hideFooter","slots","routeProduct","routeCart","routeCheckout","routeEmptyCartCTA","showDiscount","showSavings","enableItemRemoval","enableQuantityUpdate","hideHeading","undo","data","setData","useState","cartTaxesConfig","_a","state","useEffect","event","events","payload","handleItemQuantityUpdate","uid","quantity","updateProductsFromCart","handleItemRemove","checkoutLinkDisabled","handleInitiateCheckout","useCallback","publishInitiateCheckoutEvent","productList","Slot","CartSummaryList","_b","_c","getProductListFooter","getPreCheckoutSection","getSubtotalPriceProps","MiniCartComponent","Price","Button","getPersistedCartData"],"mappings":"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"}