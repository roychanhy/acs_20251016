{"version":3,"file":"OrderSearch.js","sources":["../../node_modules/@adobe-commerce/elsie/src/icons/WarningFilled.svg","/@dropins/storefront-order/src/hooks/containers/useOrderSearch.tsx","/@dropins/storefront-order/src/containers/OrderSearch/OrderSearch.tsx","/@dropins/storefront-order/src/components/OrderSearchForm/OrderSearchForm.tsx"],"sourcesContent":["import * as React from \"react\";\nconst SvgWarningFilled = (props) => /* @__PURE__ */ React.createElement(\"svg\", { width: 24, height: 24, viewBox: \"0 0 24 24\", fill: \"none\", xmlns: \"http://www.w3.org/2000/svg\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { vectorEffect: \"non-scaling-stroke\", fillRule: \"evenodd\", clipRule: \"evenodd\", d: \"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z\", fill: \"currentColor\" }));\nexport default SvgWarningFilled;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { useCallback, useEffect, useMemo, useState } from 'preact/hooks';\nimport {\n  FieldEnumList,\n  inLineAlertProps,\n  useOrderSearchProps,\n} from '@/order/types';\nimport { getFormValues } from '@/order/lib/getFormValues';\nimport { getCustomer, getGuestOrder } from '@/order/api';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { events } from '@adobe-commerce/event-bus';\nimport { OrderDataModel } from '@/order/data/models';\nimport { redirectTo } from '@/order/lib/redirectTo';\nimport { getQueryParam } from '@/order/lib/getQueryParam';\n\nexport const useOrderSearch = ({\n  onError,\n  isAuth,\n  renderSignIn,\n  routeCustomerOrder,\n  routeGuestOrder,\n}: useOrderSearchProps) => {\n  const [inLineAlert, setInLineAlert] = useState<inLineAlertProps>({\n    text: '',\n    type: 'success',\n  });\n  const [loading, setLoading] = useState(false);\n\n  const translations = useText({\n    invalidSearch: 'Order.Errors.invalidSearch',\n    email: 'Order.OrderSearchForm.email',\n    lastname: 'Order.OrderSearchForm.lastname',\n    number: 'Order.OrderSearchForm.orderNumber',\n  });\n\n  const orderSearchRedirect = useCallback(\n    async (order: OrderDataModel) => {\n      const orderRef = getQueryParam('orderRef');\n      const isToken = orderRef && orderRef.length > 20;\n      const dataIsEmpty =\n        (!order && !orderRef) || (!order?.number && !order?.token && !orderRef);\n\n      if (dataIsEmpty) return null;\n\n      if (isAuth) {\n        const customer = await getCustomer();\n\n        if (customer?.email === order.email) {\n          redirectTo(routeCustomerOrder, {\n            orderRef: order?.number,\n          });\n        } else if (!isToken) {\n          redirectTo(routeGuestOrder, { orderRef: order.token! });\n        }\n      } else if (!isToken) {\n        redirectTo(routeGuestOrder, { orderRef: order?.token! });\n      }\n    },\n    [isAuth, routeCustomerOrder, routeGuestOrder]\n  );\n\n  useEffect(() => {\n    const event = events.on(\n      'order/data',\n      (order: OrderDataModel) => {\n        orderSearchRedirect(order);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      event?.off();\n    };\n  }, [orderSearchRedirect]);\n\n  useEffect(() => {\n    const orderRef = getQueryParam('orderRef');\n    const isToken = orderRef && orderRef.length > 20 ? orderRef : null;\n\n    if (!orderRef) return;\n\n    if (isToken) {\n      redirectTo(routeGuestOrder, { orderRef });\n    } else if (isAuth) {\n      redirectTo(routeCustomerOrder, { orderRef });\n    } else {\n      renderSignIn?.({ render: true, formValues: { number: orderRef } });\n    }\n  }, [isAuth, routeCustomerOrder, routeGuestOrder, renderSignIn]);\n\n  const normalizeFieldsConfig = useMemo(() => {\n    return [\n      {\n        entityType: 'CUSTOMER_ADDRESS',\n        is_unique: false,\n        label: translations.email,\n        options: [],\n        defaultValue: '',\n        fieldType: FieldEnumList.TEXT,\n        className: '',\n        required: true,\n        orderNumber: 1,\n        name: 'email',\n        id: 'email',\n        code: 'email',\n        isUnique: false,\n      },\n      {\n        entityType: 'CUSTOMER_ADDRESS',\n        is_unique: false,\n        label: translations.lastname,\n        options: [],\n        defaultValue: '',\n        fieldType: FieldEnumList.TEXT,\n        className: '',\n        required: true,\n        orderNumber: 2,\n        name: 'lastname',\n        id: 'lastname',\n        code: 'lastname',\n        isUnique: false,\n      },\n      {\n        entityType: 'CUSTOMER_ADDRESS',\n        is_unique: false,\n        label: translations.number,\n        options: [],\n        defaultValue: '',\n        fieldType: FieldEnumList.TEXT,\n        className: '',\n        required: true,\n        orderNumber: 3,\n        name: 'number',\n        id: 'number',\n        code: 'number',\n        isUnique: false,\n      },\n    ];\n  }, [translations]);\n\n  const onSubmit = useCallback(\n    async (event: Event, valid: boolean) => {\n      if (!valid) return null;\n\n      setLoading(true);\n\n      const formValues = getFormValues(event.target as HTMLFormElement);\n\n      await getGuestOrder(formValues)\n        .then((guestOrder) => {\n          if (!guestOrder) {\n            setInLineAlert({\n              text: translations.invalidSearch,\n              type: 'warning',\n            });\n          }\n\n          events.emit('order/data', guestOrder as OrderDataModel);\n        })\n        .catch(async (error) => {\n          let showErrorMessage: boolean | undefined = true;\n\n          onError?.({\n            error: error.message,\n          });\n\n          const customer = isAuth ? await getCustomer() : { email: '' };\n\n          const isOrderBelongsToCustomer =\n            customer?.email === formValues?.email;\n\n          if (isOrderBelongsToCustomer) {\n            redirectTo(routeCustomerOrder, { orderRef: formValues.number });\n\n            return;\n          }\n\n          showErrorMessage = renderSignIn?.({\n            render:\n              customer === null ||\n              error?.message?.includes('Please login to view the order.'),\n            formValues,\n          });\n\n          if (showErrorMessage) {\n            setInLineAlert({\n              text: error.message,\n              type: 'warning',\n            });\n          }\n        })\n        .finally(() => {\n          setLoading(false);\n        });\n    },\n    [\n      isAuth,\n      onError,\n      renderSignIn,\n      routeCustomerOrder,\n      translations.invalidSearch,\n    ]\n  );\n\n  return { onSubmit, inLineAlert, loading, normalizeFieldsConfig };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { classes, Container } from '@adobe-commerce/elsie/lib';\nimport { OrderSearchForm } from '@/order/components';\nimport { useOrderSearch } from '@/order/hooks';\nimport { FieldsProps, OrderSearchProps } from '@/order/types';\n\nexport const OrderSearch: Container<OrderSearchProps> = ({\n  className,\n  isAuth,\n  renderSignIn,\n  routeCustomerOrder,\n  routeGuestOrder,\n  onError,\n}) => {\n  const { onSubmit, loading, inLineAlert, normalizeFieldsConfig } =\n    useOrderSearch({\n      onError,\n      isAuth,\n      renderSignIn,\n      routeCustomerOrder,\n      routeGuestOrder,\n    });\n\n  return (\n    <div className={classes(['order-order-search', className])}>\n      <OrderSearchForm\n        onSubmit={onSubmit}\n        loading={loading}\n        inLineAlert={inLineAlert}\n        fieldsConfig={normalizeFieldsConfig as FieldsProps[]}\n      />\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { Button, Card, Icon, InLineAlert } from '@adobe-commerce/elsie/components';\nimport { Text } from '@adobe-commerce/elsie/i18n';\nimport { WarningFilled } from '@adobe-commerce/elsie/icons';\nimport { FunctionComponent } from 'preact';\nimport { OrderSearchFormProps } from '@/order/types';\nimport { Form } from '@/order/components';\nimport '@/order/components/OrderSearchForm/OrderSearchForm.css';\n\nexport const OrderSearchForm: FunctionComponent<OrderSearchFormProps> = ({\n  onSubmit,\n  loading,\n  inLineAlert,\n  fieldsConfig,\n}) => {\n  return (\n    <Card variant={'secondary'} className={'order-order-search-form'}>\n      <h2 className={'order-order-search-form__title'}>\n        <Text id={'Order.OrderSearchForm.title'} />\n      </h2>\n\n      <p>\n        <Text id={'Order.OrderSearchForm.description'} />\n      </p>\n      {inLineAlert.text ? (\n        <InLineAlert\n          data-testid=\"orderAlert\"\n          className={'order-order-search-form__alert'}\n          type={inLineAlert.type}\n          variant=\"secondary\"\n          heading={inLineAlert.text}\n          icon={<Icon source={WarningFilled} />}\n        />\n      ) : null}\n\n      <Form\n        className={'order-order-search-form__wrapper'}\n        name=\"orderSearchForm\"\n        loading={loading}\n        fieldsConfig={fieldsConfig}\n        onSubmit={onSubmit}\n      >\n        <div className=\"order-order-search-form__button-container\">\n          <Button\n            className={'order-order-search-form__button'}\n            size={'medium'}\n            variant={'primary'}\n            key={'logIn'}\n            type={'submit'}\n            disabled={loading}\n          >\n            <Text id={'Order.OrderSearchForm.button'} />\n          </Button>\n        </div>\n      </Form>\n    </Card>\n  );\n};\n"],"names":["SvgWarningFilled","props","React","useOrderSearch","onError","isAuth","renderSignIn","routeCustomerOrder","routeGuestOrder","inLineAlert","setInLineAlert","useState","loading","setLoading","translations","useText","orderSearchRedirect","useCallback","order","orderRef","getQueryParam","isToken","customer","getCustomer","redirectTo","useEffect","event","events","normalizeFieldsConfig","useMemo","FieldEnumList","valid","formValues","getFormValues","getGuestOrder","guestOrder","error","showErrorMessage","_a","OrderSearch","className","onSubmit","jsx","classes","OrderSearchForm","fieldsConfig","jsxs","Card","Text","InLineAlert","Icon","WarningFilled","Form","Button"],"mappings":"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","x_google_ignoreList":[0]}