{"version":3,"file":"OrderProductList.js","sources":["/@dropins/storefront-order/src/hooks/containers/useOrderProductList.tsx","/@dropins/storefront-order/src/containers/OrderProductList/OrderProductList.tsx","/@dropins/storefront-order/src/lib/categorizeProducts.ts","/@dropins/storefront-order/src/components/OrderProductListContent/OrderProductListContent.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { OrderDataModel } from '@/order/data/models';\nimport { UseOrderProductListProps } from '@/order/types';\nimport { events } from '@adobe-commerce/event-bus';\nimport { useEffect, useState } from 'preact/hooks';\n\nexport const useOrderProductList = ({\n  orderData,\n}: UseOrderProductListProps) => {\n  const [loading, setLoading] = useState(true);\n  const [order, setOrder] = useState(orderData);\n\n  useEffect(() => {\n    const event = events.on(\n      'order/data',\n      (order: OrderDataModel) => {\n        setOrder(order);\n        setLoading(false);\n      },\n      { eager: true }\n    );\n\n    return () => {\n      event?.off();\n    };\n  }, []);\n\n  return { loading, order };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { OrderProductListContent } from '@/order/components';\nimport { useGetStoreConfig, useOrderProductList } from '@/order/hooks';\nimport { setTaxStatus } from '@/order/lib/setTaxStatus';\nimport { OrderProductListProps } from '@/order/types';\nimport { classes, Container } from '@adobe-commerce/elsie/lib';\n\nexport const OrderProductList: Container<OrderProductListProps> = ({\n  slots,\n  className,\n  orderData,\n  withHeader,\n  showConfigurableOptions,\n  routeProductDetails,\n}) => {\n  const storeConfig = useGetStoreConfig();\n  const { loading, order } = useOrderProductList({\n    orderData,\n  });\n\n  return (\n    <div className={classes(['order-order-product-list', className])}>\n      <OrderProductListContent\n        slots={slots}\n        loading={loading}\n        placeholderImage={storeConfig?.baseMediaUrl ?? ''}\n        taxConfig={setTaxStatus(storeConfig?.shoppingOrderDisplayPrice ?? 0)}\n        order={order}\n        withHeader={withHeader}\n        showConfigurableOptions={showConfigurableOptions}\n        routeProductDetails={routeProductDetails}\n      />\n    </div>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { OrderDataModel, OrderItemModel } from '../data/models';\n\nexport const categorizeProducts = (order: OrderDataModel) => {\n  const itemsList = order?.items ?? [];\n  const returnedList = itemsList\n    .filter((el) => el?.eligibleForReturn && el?.quantityReturnRequested)\n    .map((item) => ({\n      ...item,\n      totalQuantity: item.quantityReturnRequested,\n    }));\n\n  const returnedListMap = new Map(returnedList.map((item) => [item.id, item]));\n  const modifyOrder = itemsList\n    .map((mainItem) => {\n      const matchingItem = returnedListMap.get(mainItem?.id);\n\n      if (matchingItem) {\n        const quantityResult =\n          mainItem.totalQuantity - matchingItem.quantityReturnRequested;\n\n        if (quantityResult === 0) return null;\n\n        return {\n          ...mainItem,\n          totalQuantity: quantityResult,\n        };\n      }\n\n      return mainItem;\n    })\n    .filter((item): item is OrderItemModel => item !== null);\n\n  return {\n    returnedList,\n    canceledItems: modifyOrder?.filter((element) => element.quantityCanceled),\n    nonCanceledItems: modifyOrder?.filter(\n      (element) => !element.quantityCanceled\n    ),\n  };\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent, Fragment } from 'preact';\nimport { OrderProductListContentProps } from '@/order/types';\nimport { Card, Header } from '@adobe-commerce/elsie/components';\nimport { useMemo } from 'preact/hooks';\nimport { CartSummaryItem, OrderProductListSkeleton } from '@/order/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { OrderItemModel } from '@/order/data/models';\nimport '@/order/components/OrderProductListContent/OrderProductListContent.css';\nimport { categorizeProducts } from '@/order/lib/categorizeProducts';\n\nexport const OrderProductListContent: FunctionComponent<\n  OrderProductListContentProps\n> = ({\n  slots,\n  placeholderImage,\n  loading,\n  taxConfig,\n  order = null,\n  withHeader = true,\n  showConfigurableOptions,\n  routeProductDetails,\n}) => {\n  const isReturnPage = !!order?.returnNumber;\n\n  const translations = useText({\n    cancelled: 'Order.OrderProductListContent.cancelledTitle',\n    allOrders: 'Order.OrderProductListContent.allOrdersTitle',\n    returned: 'Order.OrderProductListContent.returnedTitle',\n    refunded: 'Order.OrderProductListContent.refundedTitle',\n    sender: 'Order.OrderProductListContent.GiftCard.sender',\n    recipient: 'Order.OrderProductListContent.GiftCard.recipient',\n    message: 'Order.OrderProductListContent.GiftCard.message',\n    outOfStock: 'Order.OrderProductListContent.stockStatus.outOfStock',\n    downloadableCount: 'Order.OrderProductListContent.downloadableCount',\n  });\n\n  const itemsList = useMemo(() => {\n    if (!order) return [];\n\n    if (!isReturnPage) {\n      const { returnedList, canceledItems, nonCanceledItems } =\n        categorizeProducts(order);\n\n      return [\n        {\n          type: 'returned',\n          list: returnedList,\n          title: translations.returned,\n        },\n        {\n          type: 'cancelled',\n          list: canceledItems,\n          title: translations.cancelled,\n        },\n        {\n          type: 'allItems',\n          list: nonCanceledItems,\n          title: translations.allOrders,\n        },\n      ].filter((section) => section?.list?.length > 0);\n    }\n\n    const returnItems =\n      order.returns\n        .find((returnData) => returnData.returnNumber === order?.returnNumber)\n        ?.items?.map((el) => ({ ...el, totalQuantity: el.requestQuantity })) ??\n      [];\n\n    return [\n      {\n        type: 'returned',\n        list: returnItems,\n        title: translations.returned,\n      },\n    ];\n  }, [order, isReturnPage, translations]);\n\n  if (!order) return <OrderProductListSkeleton />;\n\n  if (itemsList.every((el) => el.list.length === 0)) return null;\n\n  return (\n    <Card variant=\"secondary\" className={'order-order-product-list-content'}>\n      {itemsList.map((item, index) => {\n        const headerTotalProductValue = item.list\n          .filter((entry): entry is OrderItemModel => entry !== null)\n          .reduce(\n            (accumulator, { totalQuantity }) => totalQuantity + accumulator,\n            0\n          );\n\n        return (\n          <Fragment key={index}>\n            {withHeader ? (\n              <Header title={`${item.title} (${headerTotalProductValue})`} />\n            ) : null}\n            <ul className=\"order-order-product-list-content__items\">\n              {item.list\n                ?.filter(\n                  (product): product is OrderItemModel => product !== null\n                )\n                .map((product) => (\n                  <li\n                    data-testid=\"order-product-list-content-item\"\n                    key={product.id}\n                  >\n                    <CartSummaryItem\n                      slots={slots}\n                      placeholderImage={placeholderImage}\n                      loading={loading}\n                      product={product}\n                      itemType={item.type}\n                      taxConfig={taxConfig}\n                      translations={translations}\n                      showConfigurableOptions={showConfigurableOptions}\n                      routeProductDetails={routeProductDetails}\n                    />\n                  </li>\n                ))}\n            </ul>\n          </Fragment>\n        );\n      })}\n    </Card>\n  );\n};\n"],"names":["useOrderProductList","orderData","loading","setLoading","useState","order","setOrder","useEffect","event","events","OrderProductList","slots","className","withHeader","showConfigurableOptions","routeProductDetails","storeConfig","useGetStoreConfig","jsx","classes","OrderProductListContent","setTaxStatus","categorizeProducts","itemsList","returnedList","el","item","returnedListMap","modifyOrder","mainItem","matchingItem","quantityResult","element","placeholderImage","taxConfig","isReturnPage","translations","useText","useMemo","canceledItems","nonCanceledItems","section","_a","_b","returnData","Card","index","headerTotalProductValue","entry","accumulator","totalQuantity","Fragment","Header","product","CartSummaryItem","OrderProductListSkeleton"],"mappings":"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"}