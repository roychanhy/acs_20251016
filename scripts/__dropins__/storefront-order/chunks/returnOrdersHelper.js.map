{"version":3,"file":"returnOrdersHelper.js","sources":["/@dropins/storefront-order/src/lib/returnOrdersHelper.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n// @ts-nocheck\nimport { FieldEnumList } from '@/order/types';\nimport { getFormValues } from './getFormValues';\nconst returnStatus = {\n  PENDING: 'pending',\n  AUTHORIZED: 'authorized',\n  PARTIALLY_AUTHORIZED: 'partiallyAuthorized',\n  RECEIVED: 'received',\n  PARTIALLY_RECEIVED: 'partiallyReceived',\n  APPROVED: 'approved',\n  PARTIALLY_APPROVED: 'partiallyApproved',\n  REJECTED: 'rejected',\n  PARTIALLY_REJECTED: 'partiallyRejected',\n  DENIED: 'denied',\n  PROCESSED_AND_CLOSED: 'processedAndClosed',\n  CLOSED: 'closed',\n} as const;\n\ntype ReturnStatusKey = keyof typeof returnStatus;\ntype ReturnStatusValue = (typeof returnStatus)[ReturnStatusKey];\ntype KeyValueObject = { [key: string]: any };\ntype returnAttributesType = Array<{ attributeCode: string; value: string }>;\ntype normalizeAttributesTypes = {\n  selectedCustomAttributes: returnAttributesType;\n  enteredCustomAttributes: returnAttributesType;\n};\n\nconst formatTemplate = (el, index) => {\n  return {\n    id: `${el.id}_${el.fieldType}_${index + 1}`,\n    name: `${el.name}_${el.fieldType}_${index + 1}`,\n    code: `${el.code}_${el.fieldType}_${index + 1}`,\n    customUpperCode: `${el.customUpperCode}_${el.fieldType}_${index + 1}`,\n  };\n};\n\nexport const cleanObjectKeys = (obj: KeyValueObject): KeyValueObject => {\n  const cleanedObject: KeyValueObject = {};\n\n  if (!obj || typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    return cleanedObject;\n  }\n\n  Object.keys(obj).forEach((key) => {\n    const match = /_(\\d+)$/.exec(key);\n\n    if (match) {\n      const newKey = key?.replace(/_\\d+$/, '');\n      cleanedObject[newKey] = obj[key];\n    } else {\n      cleanedObject[key] = obj[key];\n    }\n  });\n\n  return cleanedObject;\n};\n\nexport const modifyFieldsConfig = (fieldsConfig, index: number) =>\n  fieldsConfig.map((el) => ({\n    ...el,\n    ...formatTemplate(el, index),\n  }));\n\nexport const replicateEntries = (objects: any[], n: number): any[] =>\n  objects?.flatMap((el) =>\n    Array.from({ length: n }, (_, index) => ({\n      ...el,\n      ...formatTemplate(el, index),\n    }))\n  );\n\nexport const normalizeAttributes = (\n  obj: Record<string, string>\n): normalizeAttributesTypes => {\n  const selectedCustomAttributes: returnAttributesType = [];\n  const enteredCustomAttributes: returnAttributesType = [];\n\n  Object.entries(obj).forEach(([key, value]) => {\n    const lastUnderscoreIndex = key.lastIndexOf('_');\n    const baseKey = key.slice(0, lastUnderscoreIndex);\n    const type = key.slice(lastUnderscoreIndex + 1);\n\n    type === FieldEnumList.MULTISELECT || type === FieldEnumList.SELECT\n      ? selectedCustomAttributes.push({\n          attributeCode: baseKey,\n          value,\n        })\n      : enteredCustomAttributes.push({ attributeCode: baseKey, value });\n  });\n\n  return { selectedCustomAttributes, enteredCustomAttributes };\n};\n\nexport const formatReturnStatus = (str: string): ReturnStatusValue | '' => {\n  if (typeof str !== 'string') return '';\n\n  return returnStatus[str as ReturnStatusKey] ?? '';\n};\n\nexport const processFormElement = (formsRef) => {\n  const items: any[] = [];\n\n  if (formsRef?.current.length) {\n    for (const { current } of formsRef.current) {\n      if (!current) continue;\n\n      const orderItemUid = current.name.replace(/_\\d+$/, '');\n      const quantity = current?.dataset?.quantity ?? 1;\n      const formsData = getFormValues(current as HTMLFormElement);\n      const valuesList = cleanObjectKeys(formsData);\n\n      items.push({\n        orderItemUid,\n        quantityToReturn: +quantity,\n        ...normalizeAttributes(valuesList),\n      });\n    }\n  }\n\n  return items;\n};\n\nexport const sortItemsByCondition = (order) => {\n  if (!order?.items?.length) return [];\n\n  return [...(order?.items ?? [])].sort((a, b) => {\n    const aCondition = a.quantityShipped - a.quantityReturnRequested === 0;\n    const bCondition = b.quantityShipped - b.quantityReturnRequested === 0;\n\n    if (a.eligibleForReturn && !b.eligibleForReturn) return -1;\n    if (!a.eligibleForReturn && b.eligibleForReturn) return 1;\n\n    if (aCondition && !bCondition) return 1;\n    if (!aCondition && bCondition) return -1;\n    return 0;\n  });\n};\n"],"names":["returnStatus","formatTemplate","el","index","cleanObjectKeys","obj","cleanedObject","key","newKey","modifyFieldsConfig","fieldsConfig","replicateEntries","objects","_","normalizeAttributes","selectedCustomAttributes","enteredCustomAttributes","value","lastUnderscoreIndex","baseKey","type","FieldEnumList","formatReturnStatus","str","processFormElement","formsRef","items","current","orderItemUid","quantity","_a","formsData","getFormValues","valuesList","sortItemsByCondition","order","a","b","aCondition","bCondition"],"mappings":"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"}