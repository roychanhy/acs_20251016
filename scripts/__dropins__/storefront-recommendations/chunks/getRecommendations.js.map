{"version":3,"file":"getRecommendations.js","sources":["/@dropins/storefront-recommendations/src/api/fetch-graphql/fetch-graphql.ts","/@dropins/storefront-recommendations/src/lib/fetch-error.ts","/@dropins/storefront-recommendations/src/api/getRecommendations/graphql/GetRecommendationsQuery.ts","/@dropins/storefront-recommendations/src/data/transforms/transform-recommendations.ts","/@dropins/storefront-recommendations/src/data/transforms/acdl-context.ts","/@dropins/storefront-recommendations/src/lib/acdl/utils.ts","/@dropins/storefront-recommendations/src/lib/acdl/contexts.ts","/@dropins/storefront-recommendations/src/lib/acdl/events.ts","/@dropins/storefront-recommendations/src/lib/acdl/publish.ts","/@dropins/storefront-recommendations/src/api/getRecommendations/getRecommendations.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FetchGraphQL } from '@adobe-commerce/fetch-graphql';\n\nexport const {\n  setEndpoint,\n  setFetchGraphQlHeader,\n  removeFetchGraphQlHeader,\n  setFetchGraphQlHeaders,\n  fetchGraphQl,\n  getConfig,\n} = new FetchGraphQL().getMethods();\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Handles GraphQL fetch errors\n * @param errors Array of GraphQL errors\n * @returns null if the error is handled, otherwise throws an error\n */\nexport const handleFetchError = (\n  errors: Array<{\n    message: string;\n    [key: string]: any;\n  }>\n) => {\n  const errorMessage = errors.map((e) => e.message).join(' ');\n\n  // For other errors, throw an exception\n  throw new Error(errorMessage);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { UNIT_FRAGMENT } from './UnitFragment';\n\nexport const GET_RECOMMENDATIONS_QUERY = /* GraphQL */ `\n  query GetRecommendations(\n    $pageType: PageType!\n    $currentSku: String!\n    $cartSkus: [String]\n    $userPurchaseHistory: [PurchaseHistory]\n    $userViewHistory: [ViewHistory]\n  ) {\n    recommendations(\n      cartSkus: $cartSkus\n      currentSku: $currentSku\n      pageType: $pageType\n      userPurchaseHistory: $userPurchaseHistory\n      userViewHistory: $userViewHistory\n    ) {\n      results {\n        ...UNIT_FRAGMENT\n      }\n      totalResults\n    }\n  }\n\n  ${UNIT_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { merge } from '@adobe-commerce/elsie/lib';\nimport {\n  RecommendationUnitModel,\n  PageType,\n  Item,\n} from '@/recommendations/data/models';\nimport { config } from '@/recommendations/api';\n\nexport function transformRecommendations(\n  data: any,\n  recId?: string\n): RecommendationUnitModel[] {\n  if (!data || !data.results?.length) return [];\n\n  // Filter out any results that don't have a matching recId if recId is provided\n  const resultsToTransform = recId\n    ? data.results.filter((result: any) => result.unitId === recId)\n    : data.results;\n\n  // Warn if recId doesn't match any recommendation units\n  if (recId && resultsToTransform.length === 0) {\n    console.warn(\n      `ProductList: recId \"${recId}\" does not match any recommendation units. Available unitIds: ${data.results\n        .map((result: any) => result.unitId)\n        .join(', ')}`\n    );\n  }\n\n  const model = resultsToTransform.map(\n    (result: any): RecommendationUnitModel => ({\n      displayOrder: result.displayOrder ?? 0,\n      pageType: result.pageType as PageType,\n      title: result.storefrontLabel ?? '',\n      items: transformItems(result.productsView ?? []),\n      totalProducts: result.totalProducts ?? 0,\n      typeId: result.typeId ?? '',\n      unitId: result.unitId ?? '',\n      unitName: result.unitName ?? '',\n    })\n  );\n\n  // extend the model with custom transformer\n  return merge(\n    model,\n    config.getConfig().models?.RecommendationUnitModel?.transformer?.(data)\n  );\n}\n\nfunction transformItems(products: any): Item[] {\n  if (!products?.length) return [];\n\n  return products.map((product: any) => ({\n    itemType: product.__typename ?? '',\n    uid: product.sku,\n    sku: product.sku,\n    name: product.name ?? '',\n    urlKey: product.urlKey ?? '',\n    images: [\n      {\n        label: product.name ?? '',\n        roles: ['thumbnail'],\n        url: (product.images?.[0]?.url ?? '').replace('http://', '//'),\n      },\n    ],\n    price: {\n      final: {\n        amount: {\n          value: product.price?.final?.amount?.value ?? null,\n          currency: product.price?.final?.amount?.currency ?? null,\n        },\n      },\n    },\n    priceRange: {\n      minimum: {\n        final: {\n          amount: {\n            value: product.priceRange?.minimum?.final?.amount?.value ?? null,\n            currency:\n              product.priceRange?.minimum?.final?.amount?.currency ?? null,\n          },\n        },\n      },\n      maximum: {\n        final: {\n          amount: {\n            value: product.priceRange?.maximum?.final?.amount?.value ?? null,\n            currency:\n              product.priceRange?.maximum?.final?.amount?.currency ?? null,\n          },\n        },\n      },\n    },\n    visibility: product.visibility ?? '',\n    queryType: product.queryType ?? '',\n  }));\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { RecommendationUnit, RecommendedProduct } from '../models/acdl-models';\nimport { Item, RecommendationUnitModel } from '@/recommendations/data/models';\n\n/**\n * Transform a recommendation unit data object into an ACDL model\n *\n * @param unitData - The recommendation unit data object to transform\n * @param additionalData - Additional data that may not be present in the unit data object\n * @returns The transformed recommendation unit\n */\nexport const transformRecommendationUnit = (\n  unitData: RecommendationUnitModel,\n  additionalData?: any\n) => {\n  // Handle null or undefined unitData\n  if (!unitData) {\n    console.error('transformRecommendationUnit: unitData is null or undefined');\n    throw new Error(\n      'Recommendation unit data is required but was not provided'\n    );\n  }\n\n  // Ensure items exists and is an array\n  const items = unitData.items || [];\n\n  const recUnit: RecommendationUnit = {\n    unitId: unitData.unitId,\n    unitName: unitData.unitName,\n    typeId: unitData.typeId,\n    unitType: unitData.typeId, // This is an assumption that the unit type is the typeId since the GraphQL schema does not have a unitType field\n    totalProducts: unitData.totalProducts,\n    primaryProducts: items.length, // This is an assumption that the primary products are the total items in the unit\n    products: items.map((item, index) =>\n      transformRecommendationProduct(item, index)\n    ),\n    // Data that may not be present in the unit data object\n    searchTime: additionalData?.searchTime || 0,\n    backupProducts: additionalData?.backupProducts || 0,\n    pagePlacement: additionalData?.pagePlacement || '',\n    yOffsetTop: additionalData?.yOffsetTop || null,\n    yOffsetBottom: additionalData?.yOffsetBottom || null,\n  };\n\n  return recUnit;\n};\n\n/**\n * Transform a product view data object into an ACDL model\n *\n * @param productData - The product view data object to transform\n * @param index - The index of the product in the recommendation unit\n * @returns The transformed product\n */\nconst transformRecommendationProduct = (\n  productData: Item,\n  index: number = 0\n) => {\n  const recProduct: RecommendedProduct = {\n    productId: Number(index), // Ensure productId is a number. This is an assumption that the product id is the index\n    sku: productData.sku,\n    name: productData.name,\n    url: productData.urlKey,\n    visibility: productData.visibility,\n    queryType: productData.queryType,\n\n    rank: Number(index), // Ensure rank is a number\n    type: productData.itemType, // Using itemType from the model\n\n    score: 0, // Deprecated in the GraphQL schema but is required by the ACDL model\n    categories: [], // Deprecated in the GraphQL schema but is required by the ACDL model\n\n    weight: 0, // Not sure where this is coming from its not in the GraphQL schema\n\n    // Optional fields that have corresponding fields in the GraphQL schema\n    image: productData.images?.[0],\n  };\n\n  return recProduct;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Utility functions for working with Adobe Client Data Layer (ACDL)\n */\n\n/**\n * Set and return the Adobe Client Data Layer (ACDL)\n * @returns ACDL instance or an empty array if it doesn't exist\n */\nexport function getAdobeDataLayer() {\n  // @ts-ignore\n  window.adobeDataLayer = window.adobeDataLayer || [];\n  // @ts-ignore\n  return window.adobeDataLayer;\n}\n\n/**\n * Sets a context in the Adobe Client Data Layer (ACDL)\n * Logic based on: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/Base.ts#L6\n * @param name - The name of the context\n * @param data - The data to set in the context\n */\nexport function setContext<T>(name: string, data: T) {\n  const adobeDataLayer = getAdobeDataLayer();\n\n  // Clear existing context\n  adobeDataLayer.push({\n    [name]: null,\n  });\n\n  // Set new context\n  adobeDataLayer.push({\n    [name]: data,\n  });\n}\n\n/**\n * Pushes an event to the Adobe Client Data Layer (ACDL)\n * Logic based on: https://github.com/adobe/commerce-events/blob/1973d0ce28471ef190fa06dad6359ffa0ab51db6/packages/storefront-events-sdk/src/Base.ts#L34\n * @param event - The event to push\n * @param contextName - The name of the context to add to the event\n * @param additionalContext - Additional context to add to the event\n */\nexport function pushEvent(\n  event: string,\n  contextName?: string,\n  additionalContext?: any\n) {\n  const adobeDataLayer = getAdobeDataLayer();\n\n  adobeDataLayer.push((acdl: any) => {\n    const state = acdl.getState ? acdl.getState(contextName) : {};\n\n    acdl.push({\n      event,\n      eventInfo: {\n        ...state,\n        ...additionalContext,\n      },\n    });\n  });\n}\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Context relevant to Storefront Recommendations dropin\n * See: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/contexts.ts\n */\n\nexport const RECOMMENDATIONS_CONTEXT = \"recommendationsContext\";","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\n/**\n * Events relevant to Storefront Recommendations dropin\n * See: https://github.com/adobe/commerce-events/blob/main/packages/storefront-events-sdk/src/events.ts\n * Relevant docs:\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n */\n\nexport const RECS_UNIT_RENDER = 'recs-unit-impression-render';\nexport const RECS_ITEM_ADD_TO_CART_CLICK = 'recs-item-add-to-cart-click';\nexport const RECS_ITEM_CLICK = 'recs-item-click';\nexport const RECS_UNIT_VIEW = 'recs-unit-view';\nexport const RECS_REQUEST_SENT = 'recs-api-request-sent';\nexport const RECS_RESPONSE_RECEIVED = 'recs-api-response-received';\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { transformRecommendationUnit } from '@/recommendations/data/transforms/acdl-context';\nimport { pushEvent, setContext } from './utils';\nimport { RECOMMENDATIONS_CONTEXT } from './contexts';\nimport {\n  RECS_ITEM_CLICK,\n  RECS_REQUEST_SENT,\n  RECS_RESPONSE_RECEIVED,\n  RECS_UNIT_RENDER,\n  RECS_UNIT_VIEW,\n} from './events';\nimport { Recommendations } from '@/recommendations/data/models/acdl-models';\nimport { RecommendationUnitModel } from '@/recommendations/data/models/recommendations-model';\n\n/**\n * Parameters for the publish events\n *\n * item: The item that was added to the cart\n * pagePlacement: The placement of the item on the page\n * yOffsetTop: The y offset of the item from the top of the page\n * yOffsetBottom: The y offset of the item from the bottom of the page\n */\nexport interface PublishParams {\n  recommendationUnit: RecommendationUnitModel;\n  pagePlacement: string;\n  yOffsetTop: number;\n  yOffsetBottom: number;\n  backupProducts?: number;\n  searchTime?: number;\n  productId?: number; // The index of the clicked product\n}\n\n/**\n * Publish a recs-unit-render event to the Adobe Client Data Layer (ACDL)\n *\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n * @param params - The parameters for the event\n */\nexport const publishRecsUnitRender = (params: PublishParams) => {\n  const { recommendationUnit, ...additionalData } = params;\n\n  const recommendationUnitContext = transformRecommendationUnit(\n    recommendationUnit,\n    additionalData\n  );\n\n  setContext<Recommendations>(RECOMMENDATIONS_CONTEXT, {\n    units: [recommendationUnitContext],\n  });\n\n  pushEvent(RECS_UNIT_RENDER, undefined, {\n    unitId: recommendationUnitContext.unitId,\n  });\n};\n\n/**\n * Publish a recs-item-click event to the Adobe Client Data Layer (ACDL)\n *\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n * @param params - The parameters for the event\n */\nexport const publishRecsItemClick = (params: PublishParams) => {\n  const { recommendationUnit, productId, ...additionalData } = params;\n\n  const recommendationUnitContext = transformRecommendationUnit(\n    recommendationUnit,\n    additionalData\n  );\n\n  setContext<Recommendations>(RECOMMENDATIONS_CONTEXT, {\n    units: [recommendationUnitContext],\n  });\n\n  pushEvent(RECS_ITEM_CLICK, undefined, {\n    unitId: recommendationUnitContext.unitId,\n    productId,\n  });\n};\n\n/**\n * Publish a recs-unit-view event to the Adobe Client Data Layer (ACDL)\n *\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n * @param params - The parameters for the event\n */\nexport const publishRecsUnitView = (params: PublishParams) => {\n  const { recommendationUnit, ...additionalData } = params;\n\n  const recommendationUnitContext = transformRecommendationUnit(\n    recommendationUnit,\n    additionalData\n  );\n\n  setContext<Recommendations>(RECOMMENDATIONS_CONTEXT, {\n    units: [recommendationUnitContext],\n  });\n\n  pushEvent(RECS_UNIT_VIEW, undefined, {\n    unitId: recommendationUnitContext.unitId,\n  });\n};\n\n/**\n * Publish a recs-api-request-sent event to the Adobe Client Data Layer (ACDL)\n *\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n */\nexport const publishRecsApiRequestSent = () => {\n\n  pushEvent(RECS_REQUEST_SENT);\n};\n\n/**\n * Publish a recs-api-response-received event to the Adobe Client Data Layer (ACDL)\n *\n * See: https://experienceleague.adobe.com/en/docs/commerce/product-recommendations/developer/events#events\n * @param params - The parameters for the event\n */\nexport const publishRecsApiResponseReceived = (params: PublishParams) => {\n  const { recommendationUnit, ...additionalData } = params;\n\n  const recommendationUnitContext = transformRecommendationUnit(\n    recommendationUnit,\n    additionalData\n  );\n\n  setContext<Recommendations>(RECOMMENDATIONS_CONTEXT, {\n    units: [recommendationUnitContext],\n  });\n\n  pushEvent(RECS_RESPONSE_RECEIVED);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { fetchGraphQl } from '@/recommendations/api/fetch-graphql';\nimport { handleFetchError } from '@/recommendations/lib/fetch-error';\nimport { GET_RECOMMENDATIONS_QUERY } from '@/recommendations/api/getRecommendations/graphql/GetRecommendationsQuery';\nimport {\n  GraphQLResponse,\n  RecommendationUnitModel,\n} from '@/recommendations/data/models';\nimport { events } from '@adobe-commerce/event-bus';\nimport { transformRecommendations } from '@/recommendations/data/transforms';\nimport {\n  publishRecsApiRequestSent,\n  publishRecsApiResponseReceived,\n} from '@/recommendations/lib/acdl/publish';\n\nexport interface GetRecommendationsProps {\n  currentSku?: string;\n  pageType: string;\n  cartSkus?: string[];\n  userPurchaseHistory?: any[];\n  userViewHistory?: any[];\n  recId?: string;\n}\n\nexport const getRecommendations = async (\n  params: GetRecommendationsProps\n): Promise<RecommendationUnitModel[] | null> => {\n  // Publish recs-api-request-sent event before making the API request\n  publishRecsApiRequestSent();\n\n  return fetchGraphQl(GET_RECOMMENDATIONS_QUERY, {\n    method: 'GET',\n    variables: params,\n  }).then(({ errors, data }: GraphQLResponse) => {\n    if (errors && errors.length > 0) return handleFetchError(errors);\n\n    // transform recommendations\n    const payload = transformRecommendations(\n      data?.recommendations,\n      params.recId\n    );\n\n    // Publish recs-api-response-received event for each recommendation unit\n    if (payload && payload.length > 0) {\n      payload.forEach((unit) => {\n        publishRecsApiResponseReceived({\n          recommendationUnit: unit,\n          pagePlacement: 'api-response',\n          yOffsetTop: 0,\n          yOffsetBottom: 0,\n          backupProducts: 0,\n          searchTime: 0,\n        });\n      });\n    }\n\n    // emit events\n    events.emit('recommendations/data', payload);\n\n    return payload;\n  });\n};\n"],"names":["setEndpoint","setFetchGraphQlHeader","removeFetchGraphQlHeader","setFetchGraphQlHeaders","fetchGraphQl","getConfig","FetchGraphQL","handleFetchError","errors","errorMessage","e","GET_RECOMMENDATIONS_QUERY","UNIT_FRAGMENT","transformRecommendations","data","recId","_a","resultsToTransform","result","model","transformItems","merge","_d","_c","_b","config","products","product","_e","_h","_g","_f","_l","_k","_j","_i","_p","_o","_n","_m","_t","_s","_r","_q","_x","_w","_v","_u","transformRecommendationUnit","unitData","additionalData","items","item","index","transformRecommendationProduct","productData","getAdobeDataLayer","setContext","name","adobeDataLayer","pushEvent","event","contextName","additionalContext","acdl","state","RECOMMENDATIONS_CONTEXT","RECS_UNIT_RENDER","RECS_ITEM_ADD_TO_CART_CLICK","RECS_ITEM_CLICK","RECS_UNIT_VIEW","RECS_REQUEST_SENT","RECS_RESPONSE_RECEIVED","publishRecsUnitRender","params","recommendationUnit","recommendationUnitContext","publishRecsItemClick","productId","publishRecsUnitView","publishRecsApiRequestSent","publishRecsApiResponseReceived","getRecommendations","payload","unit","events"],"mappings":"sPAmBa,KAAA,CACX,YAAAA,GACA,sBAAAC,GACA,yBAAAC,GACA,uBAAAC,GACA,aAAAC,EACA,UAAAC,EACF,EAAI,IAAIC,EAAa,EAAE,WAAW,ECJrBC,EACXC,GAIG,CACG,MAAAC,EAAeD,EAAO,IAAKE,GAAMA,EAAE,OAAO,EAAE,KAAK,GAAG,EAGpD,MAAA,IAAI,MAAMD,CAAY,CAC9B,ECbaE,EAA0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAsBnDC,CAAa;AAAA,EChBD,SAAAC,EACdC,EACAC,EAC2B,aAC3B,GAAI,CAACD,GAAQ,GAACE,EAAAF,EAAK,UAAL,MAAAE,EAAc,cAAe,CAAC,EAGtC,MAAAC,EAAqBF,EACvBD,EAAK,QAAQ,OAAQI,GAAgBA,EAAO,SAAWH,CAAK,EAC5DD,EAAK,QAGLC,GAASE,EAAmB,SAAW,GACjC,QAAA,KACN,uBAAuBF,CAAK,iEAAiED,EAAK,QAC/F,IAAKI,GAAgBA,EAAO,MAAM,EAClC,KAAK,IAAI,CAAC,EACf,EAGF,MAAMC,EAAQF,EAAmB,IAC9BC,IAA0C,CACzC,aAAcA,EAAO,cAAgB,EACrC,SAAUA,EAAO,SACjB,MAAOA,EAAO,iBAAmB,GACjC,MAAOE,EAAeF,EAAO,cAAgB,CAAA,CAAE,EAC/C,cAAeA,EAAO,eAAiB,EACvC,OAAQA,EAAO,QAAU,GACzB,OAAQA,EAAO,QAAU,GACzB,SAAUA,EAAO,UAAY,EAC/B,EACF,EAGO,OAAAG,EACLF,GACAG,GAAAC,GAAAC,EAAAC,EAAO,UAAU,EAAE,SAAnB,YAAAD,EAA2B,0BAA3B,YAAAD,EAAoD,cAApD,YAAAD,EAAA,KAAAC,EAAkET,EACpE,CACF,CAEA,SAASM,EAAeM,EAAuB,CAC7C,OAAKA,GAAA,MAAAA,EAAU,OAERA,EAAS,IAAKC,GAAkB,qDAAA,OACrC,SAAUA,EAAQ,YAAc,GAChC,IAAKA,EAAQ,IACb,IAAKA,EAAQ,IACb,KAAMA,EAAQ,MAAQ,GACtB,OAAQA,EAAQ,QAAU,GAC1B,OAAQ,CACN,CACE,MAAOA,EAAQ,MAAQ,GACvB,MAAO,CAAC,WAAW,EACnB,OAAMH,GAAAR,EAAAW,EAAQ,SAAR,YAAAX,EAAiB,KAAjB,YAAAQ,EAAqB,MAAO,IAAI,QAAQ,UAAW,IAAI,CAAA,CAEjE,EACA,MAAO,CACL,MAAO,CACL,OAAQ,CACN,QAAOI,GAAAN,GAAAC,EAAAI,EAAQ,QAAR,YAAAJ,EAAe,QAAf,YAAAD,EAAsB,SAAtB,YAAAM,EAA8B,QAAS,KAC9C,WAAUC,GAAAC,GAAAC,EAAAJ,EAAQ,QAAR,YAAAI,EAAe,QAAf,YAAAD,EAAsB,SAAtB,YAAAD,EAA8B,WAAY,IAAA,CACtD,CAEJ,EACA,WAAY,CACV,QAAS,CACP,MAAO,CACL,OAAQ,CACN,QAAOG,GAAAC,GAAAC,GAAAC,EAAAR,EAAQ,aAAR,YAAAQ,EAAoB,UAApB,YAAAD,EAA6B,QAA7B,YAAAD,EAAoC,SAApC,YAAAD,EAA4C,QAAS,KAC5D,WACEI,GAAAC,GAAAC,GAAAC,EAAAZ,EAAQ,aAAR,YAAAY,EAAoB,UAApB,YAAAD,EAA6B,QAA7B,YAAAD,EAAoC,SAApC,YAAAD,EAA4C,WAAY,IAAA,CAC5D,CAEJ,EACA,QAAS,CACP,MAAO,CACL,OAAQ,CACN,QAAOI,GAAAC,GAAAC,GAAAC,EAAAhB,EAAQ,aAAR,YAAAgB,EAAoB,UAApB,YAAAD,EAA6B,QAA7B,YAAAD,EAAoC,SAApC,YAAAD,EAA4C,QAAS,KAC5D,WACEI,GAAAC,GAAAC,GAAAC,EAAApB,EAAQ,aAAR,YAAAoB,EAAoB,UAApB,YAAAD,EAA6B,QAA7B,YAAAD,EAAoC,SAApC,YAAAD,EAA4C,WAAY,IAAA,CAC5D,CACF,CAEJ,EACA,WAAYjB,EAAQ,YAAc,GAClC,UAAWA,EAAQ,WAAa,EAAA,EAChC,EA7C4B,CAAC,CA8CjC,CCrFa,MAAAqB,EAA8B,CACzCC,EACAC,IACG,CAEH,GAAI,CAACD,EACH,cAAQ,MAAM,4DAA4D,EACpE,IAAI,MACR,2DACF,EAII,MAAAE,EAAQF,EAAS,OAAS,CAAC,EAoB1B,MAlB6B,CAClC,OAAQA,EAAS,OACjB,SAAUA,EAAS,SACnB,OAAQA,EAAS,OACjB,SAAUA,EAAS,OACnB,cAAeA,EAAS,cACxB,gBAAiBE,EAAM,OACvB,SAAUA,EAAM,IAAI,CAACC,EAAMC,IACzBC,EAA+BF,EAAMC,CAAK,CAC5C,EAEA,YAAYH,GAAA,YAAAA,EAAgB,aAAc,EAC1C,gBAAgBA,GAAA,YAAAA,EAAgB,iBAAkB,EAClD,eAAeA,GAAA,YAAAA,EAAgB,gBAAiB,GAChD,YAAYA,GAAA,YAAAA,EAAgB,aAAc,KAC1C,eAAeA,GAAA,YAAAA,EAAgB,gBAAiB,IAClD,CAGF,EASMI,EAAiC,CACrCC,EACAF,EAAgB,IACb,OAqBI,MApBgC,CACrC,UAAW,OAAOA,CAAK,EACvB,IAAKE,EAAY,IACjB,KAAMA,EAAY,KAClB,IAAKA,EAAY,OACjB,WAAYA,EAAY,WACxB,UAAWA,EAAY,UAEvB,KAAM,OAAOF,CAAK,EAClB,KAAME,EAAY,SAElB,MAAO,EACP,WAAY,CAAC,EAEb,OAAQ,EAGR,OAAOvC,EAAAuC,EAAY,SAAZ,YAAAvC,EAAqB,EAC9B,CAGF,ECtEO,SAASwC,GAAoB,CAE3B,cAAA,eAAiB,OAAO,gBAAkB,CAAC,EAE3C,OAAO,cAChB,CAQgB,SAAAC,EAAcC,EAAc5C,EAAS,CACnD,MAAM6C,EAAiBH,EAAkB,EAGzCG,EAAe,KAAK,CAClB,CAACD,CAAI,EAAG,IAAA,CACT,EAGDC,EAAe,KAAK,CAClB,CAACD,CAAI,EAAG5C,CAAA,CACT,CACH,CASgB,SAAA8C,EACdC,EACAC,EACAC,EACA,CACuBP,EAAkB,EAE1B,KAAMQ,GAAc,CACjC,MAAMC,EAAQD,EAAK,SAAWA,EAAK,SAASF,CAAW,EAAI,CAAC,EAE5DE,EAAK,KAAK,CACR,MAAAH,EACA,UAAW,CACT,GAAGI,EACH,GAAGF,CAAA,CACL,CACD,CAAA,CACF,CACH,CCvDO,MAAMG,EAA0B,yBCE1BC,EAAmB,8BACnBC,GAA8B,8BAC9BC,EAAkB,kBAClBC,EAAiB,iBACjBC,EAAoB,wBACpBC,EAAyB,6BCyBzBC,GAAyBC,GAA0B,CAC9D,KAAM,CAAE,mBAAAC,EAAoB,GAAGzB,CAAA,EAAmBwB,EAE5CE,EAA4B5B,EAChC2B,EACAzB,CACF,EAEAO,EAA4BS,EAAyB,CACnD,MAAO,CAACU,CAAyB,CAAA,CAClC,EAEDhB,EAAUO,EAAkB,OAAW,CACrC,OAAQS,EAA0B,MAAA,CACnC,CACH,EAQaC,GAAwBH,GAA0B,CAC7D,KAAM,CAAE,mBAAAC,EAAoB,UAAAG,EAAW,GAAG5B,CAAmB,EAAAwB,EAEvDE,EAA4B5B,EAChC2B,EACAzB,CACF,EAEAO,EAA4BS,EAAyB,CACnD,MAAO,CAACU,CAAyB,CAAA,CAClC,EAEDhB,EAAUS,EAAiB,OAAW,CACpC,OAAQO,EAA0B,OAClC,UAAAE,CAAA,CACD,CACH,EAQaC,GAAuBL,GAA0B,CAC5D,KAAM,CAAE,mBAAAC,EAAoB,GAAGzB,CAAA,EAAmBwB,EAE5CE,EAA4B5B,EAChC2B,EACAzB,CACF,EAEAO,EAA4BS,EAAyB,CACnD,MAAO,CAACU,CAAyB,CAAA,CAClC,EAEDhB,EAAUU,EAAgB,OAAW,CACnC,OAAQM,EAA0B,MAAA,CACnC,CACH,EAOaI,EAA4B,IAAM,CAE7CpB,EAAUW,CAAiB,CAC7B,EAQaU,EAAkCP,GAA0B,CACvE,KAAM,CAAE,mBAAAC,EAAoB,GAAGzB,CAAA,EAAmBwB,EAE5CE,EAA4B5B,EAChC2B,EACAzB,CACF,EAEAO,EAA4BS,EAAyB,CACnD,MAAO,CAACU,CAAyB,CAAA,CAClC,EAEDhB,EAAUY,CAAsB,CAClC,EC3GaU,GAAqB,MAChCR,IAG0BM,EAAA,EAEnB5E,EAAaO,EAA2B,CAC7C,OAAQ,MACR,UAAW+D,CACZ,CAAA,EAAE,KAAK,CAAC,CAAE,OAAAlE,EAAQ,KAAAM,KAA4B,CAC7C,GAAIN,GAAUA,EAAO,OAAS,EAAG,OAAOD,EAAiBC,CAAM,EAG/D,MAAM2E,EAAUtE,EACdC,GAAA,YAAAA,EAAM,gBACN4D,EAAO,KACT,EAGI,OAAAS,GAAWA,EAAQ,OAAS,GACtBA,EAAA,QAASC,GAAS,CACOH,EAAA,CAC7B,mBAAoBG,EACpB,cAAe,eACf,WAAY,EACZ,cAAe,EACf,eAAgB,EAChB,WAAY,CAAA,CACb,CAAA,CACF,EAIIC,EAAA,KAAK,uBAAwBF,CAAO,EAEpCA,CAAA,CACR"}