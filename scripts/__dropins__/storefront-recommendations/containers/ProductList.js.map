{"version":3,"file":"ProductList.js","sources":["/@dropins/storefront-recommendations/src/components/ProductList/ProductList.tsx","/@dropins/storefront-recommendations/src/containers/ProductList/ProductList.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { FunctionComponent, VNode } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport {\n  Skeleton,\n  SkeletonRow,\n  ContentGrid,\n} from '@adobe-commerce/elsie/components';\nimport { classes, VComponent } from '@adobe-commerce/elsie/lib';\n\nimport '@/recommendations/components/ProductList/ProductList.css';\n\nexport interface ProductListProps\n  extends HTMLAttributes<HTMLDivElement>,\n    Omit<HTMLAttributes<HTMLDivElement>, 'loading'> {\n  heading?: VNode | null;\n  products?: VNode | null;\n  loading?: boolean;\n}\n\nexport const ProductList: FunctionComponent<ProductListProps> = ({\n  className,\n  children,\n  heading,\n  products = null,\n  loading = true,\n  ...props\n}) => {\n  return (\n    <section\n      {...props}\n      role=\"region\"\n      aria-label=\"Product recommendations\"\n      className={classes([\n        'recommendations-product-list',\n        className,\n        ['recommendations-product-list--empty', !products],\n      ])}\n    >\n      {loading ? (\n        <ProductListSkeleton />\n      ) : (\n        <>\n          {heading && (\n            <VComponent\n              node={heading}\n              className=\"recommendations-product-list__heading\"\n            />\n          )}\n          <ContentGrid\n            className=\"recommendations-product-list__content\"\n            data-testid=\"recommendations-product-list__content\"\n            maxColumns={0}\n            columnWidth=\"minmax(240px, 1fr)\"\n          >\n            {products}\n          </ContentGrid>\n        </>\n      )}\n    </section>\n  );\n};\n\nconst ProductListSkeleton: FunctionComponent = () => {\n  return (\n    <Skeleton\n      data-testid=\"recommendations-product-list-skeleton\"\n      className=\"recommendations-product-list-skeleton\"\n      rowGap=\"medium\"\n    >\n      {[...Array(2)].map((_, i) => (\n        <SkeletonRow\n          key={i}\n          variant=\"row\"\n          size=\"large\"\n          fullWidth\n          lines={2}\n          multilineGap=\"small\"\n        />\n      ))}\n    </Skeleton>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  HTMLAttributes,\n  useCallback,\n  useEffect,\n  useState,\n  useRef,\n} from 'preact/compat';\nimport { ProductList as ProductListComponent } from '@/recommendations/components';\nimport { Container, Slot, SlotProps } from '@adobe-commerce/elsie/lib';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport {\n  Button,\n  Image,\n  ImageProps,\n  Price,\n  ProductItemCard,\n} from '@adobe-commerce/elsie/components';\nimport { Item, RecommendationUnitModel } from '@/recommendations/data/models';\nimport { events } from '@adobe-commerce/event-bus';\nimport { getRecommendations } from '@/recommendations/api';\nimport {\n  publishRecsItemClick,\n  publishRecsUnitRender,\n  publishRecsUnitView,\n} from '@/recommendations/lib/acdl/publish';\n\nexport interface ProductListProps extends HTMLAttributes<HTMLDivElement> {\n  recId: string;\n  initialData?: {\n    recommendations?: {\n      results: RecommendationUnitModel[];\n      totalProducts: number;\n    };\n  };\n  hideHeading?: boolean;\n  routeProduct?: (item: Item) => string;\n  currentSku: string;\n  cartSkus?: string[];\n  userPurchaseHistory?: any[];\n  userViewHistory?: any[];\n  pagePlacement?: string | '';\n  slots?: {\n    Heading?: SlotProps;\n    Footer?: SlotProps;\n    Title?: SlotProps<{\n      item: Item;\n      productUrl: string;\n    }>;\n    Sku?: SlotProps<{\n      item: Item;\n    }>;\n    Price?: SlotProps<{\n      item: Item;\n    }>;\n    Thumbnail?: SlotProps<{\n      item: any;\n      defaultImageProps: ImageProps;\n    }>;\n  };\n}\n\nexport const ProductList: Container<ProductListProps> = ({\n  recId,\n  initialData = null,\n  hideHeading,\n  routeProduct,\n  currentSku,\n  cartSkus,\n  userPurchaseHistory,\n  userViewHistory,\n  pagePlacement,\n  slots,\n  ...props\n}) => {\n  const [loading, setLoading] = useState(!initialData);\n\n  const [recommendations, setRecommendations] = useState<\n    RecommendationUnitModel[] | null\n  >(\n    initialData?.recommendations?.results\n      ? initialData.recommendations.results.filter(\n          (unit) => unit.unitId === recId\n        )\n      : []\n  );\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const dictionary = useText({\n    addToCartText: 'Recommendations.ProductList.addToCart',\n    optionsText: 'Recommendations.ProductList.selectOptions',\n    viewProductText: 'Recommendations.ProductList.viewProduct',\n  });\n\n  // Helper function to validate if all required data is available\n  const hasRequiredData = useCallback((): boolean => {\n    return !!recId && !!currentSku;\n  }, [recId, currentSku]);\n\n  useEffect(() => {\n    const dataEvent = events.on(\n      'recommendations/data',\n      (payload: RecommendationUnitModel[] | null) => {\n        if (payload && payload.length > 0) {\n          setRecommendations((prev) => {\n            const existing = prev || [];\n            const newUnits = payload.filter(\n              (unit) =>\n                unit?.unitId === recId &&\n                unit?.items?.length &&\n                !existing.some((e) => e.unitId === unit.unitId)\n            );\n\n            // Trigger render event for each new valid unit\n            newUnits.forEach((unit) => {\n              publishRecsUnitRender({\n                recommendationUnit: unit,\n                pagePlacement: 'product-list',\n                yOffsetTop:\n                  containerRef.current?.getBoundingClientRect().top ?? 0,\n                yOffsetBottom:\n                  containerRef.current?.getBoundingClientRect().bottom ?? 0,\n                backupProducts: 0,\n                searchTime: 0,\n              });\n            });\n\n            return [...existing, ...newUnits];\n          });\n        }\n        setLoading(false);\n      }\n    );\n\n    return () => {\n      dataEvent?.off();\n    };\n  }, [recId]);\n\n  // Add intersection observer for view events\n  useEffect(() => {\n    if (!recommendations?.length || !containerRef.current) return;\n\n    const intersectionObserverOptions = {\n      root: null,\n      rootMargin: '0px',\n      threshold: 0.5,\n    };\n\n    const handleIntersection = (entries: IntersectionObserverEntry[]) => {\n      entries.forEach((entry) => {\n        if (entry.intersectionRatio > 0.5) {\n          recommendations.forEach((unit) => {\n            publishRecsUnitView({\n              recommendationUnit: unit,\n              pagePlacement: 'product-list',\n              yOffsetTop:\n                containerRef.current?.getBoundingClientRect().top ?? 0,\n              yOffsetBottom:\n                containerRef.current?.getBoundingClientRect().bottom ?? 0,\n            });\n          });\n        }\n      });\n    };\n\n    const observer = new IntersectionObserver(\n      handleIntersection,\n      intersectionObserverOptions\n    );\n    observer.observe(containerRef.current);\n\n    return () => observer.disconnect();\n  }, [recommendations]);\n\n  useEffect(() => {\n    // Only fetch recommendations if we have all required data\n    if (!hasRequiredData()) {\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    getRecommendations({\n      currentSku,\n      pageType: 'Product', // This should be always be hardcoded to 'Product', per Product requirements\n      cartSkus,\n      userPurchaseHistory,\n      userViewHistory,\n      recId,\n    }).catch((error) => {\n      console.error('Recommendations error:', error);\n      setRecommendations([]);\n      setLoading(false);\n    });\n  }, [\n    currentSku,\n    cartSkus,\n    userPurchaseHistory,\n    userViewHistory,\n    hasRequiredData,\n    recId,\n  ]);\n\n  // Only proceed with rendering if all required data is available\n  if (!hasRequiredData()) {\n    if (!recId) {\n      console.warn(\n        'ProductList: recId is missing. Please provide a valid recId to display product recommendations.'\n      );\n    }\n    if (!currentSku) {\n      console.warn(\n        'ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations.'\n      );\n    }\n    return null;\n  }\n\n  const getImage = (\n    item: RecommendationUnitModel['items'][0],\n    index: number\n  ) => {\n    const defaultImageProps: ImageProps = {\n      loading: index < 4 ? 'eager' : 'lazy',\n      src: item.images?.[0]?.url || '',\n      alt: item.images?.[0]?.label || '',\n      width: '300',\n      height: '300',\n      params: { width: 300 },\n    };\n\n    const imageComponent = (\n      <Image\n        data-testid=\"product-list-item-image\"\n        {...defaultImageProps}\n        aria-label={item.sku}\n      />\n    );\n\n    return (\n      <Slot\n        name=\"Thumbnail\"\n        slot={slots?.Thumbnail}\n        context={{\n          item,\n          defaultImageProps,\n        }}\n      >\n        {routeProduct ? (\n          <a href={routeProduct(item)}>{imageComponent}</a>\n        ) : (\n          imageComponent\n        )}\n      </Slot>\n    );\n  };\n\n  const heading = (\n    <Slot name=\"Heading\" slot={slots?.Heading} context={{}}>\n      <div data-testid=\"default-product-list-heading\">\n        {recommendations?.[0]?.title || dictionary.heading}\n      </div>\n    </Slot>\n  );\n\n  const getFooter = (\n    item: RecommendationUnitModel['items'][0],\n    index: number\n  ) => {\n    return (\n      <Slot\n        name=\"Footer\"\n        slot={slots?.Footer}\n        context={{\n          item,\n          index,\n        }}\n      >\n        <div data-testid=\"default-product-list-footer\">\n          {routeProduct && (\n            <a href={routeProduct(item)}>\n              <Button\n                data-testid=\"default-product-list-footer-button\"\n                children={dictionary.viewProductText}\n                aria-label={dictionary.viewProductText}\n                variant=\"primary\"\n              />\n            </a>\n          )}\n        </div>\n      </Slot>\n    );\n  };\n\n  const getTitle = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Title\"\n        slot={slots?.Title}\n        context={{\n          item,\n          productUrl: routeProduct ? routeProduct(item) : '',\n        }}\n      >\n        {routeProduct ? (\n          <a href={routeProduct(item)}>{item.name}</a>\n        ) : (\n          <span>{item.name}</span>\n        )}\n      </Slot>\n    );\n  };\n\n  const getSku = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Sku\"\n        slot={slots?.Sku}\n        context={{\n          item,\n        }}\n      >\n        <span>{item.sku}</span>\n      </Slot>\n    );\n  };\n\n  const getPrice = (item: RecommendationUnitModel['items'][0]) => {\n    return (\n      <Slot\n        name=\"Price\"\n        slot={slots?.Price}\n        context={{\n          item,\n        }}\n      >\n        <div data-testid=\"default-product-price\">\n          <Price\n            amount={item.price.final?.amount?.value ?? undefined}\n            currency={item.price.final?.amount?.currency ?? undefined}\n          />\n        </div>\n      </Slot>\n    );\n  };\n\n  const handleProductClick = (\n    item: RecommendationUnitModel['items'][0],\n    productId: number\n  ) => {\n    const recommendationUnit = recommendations?.find((unit) =>\n      unit.items?.some((unitItem) => unitItem.sku === item.sku)\n    );\n    if (recommendationUnit) {\n      publishRecsItemClick({\n        recommendationUnit,\n        pagePlacement: pagePlacement || '',\n        yOffsetTop: containerRef.current?.getBoundingClientRect().top ?? 0,\n        yOffsetBottom:\n          containerRef.current?.getBoundingClientRect().bottom ?? 0,\n        productId,\n      });\n    }\n  };\n\n  const productEntries = recommendations?.[0]?.totalProducts ? (\n    <>\n      {recommendations?.map(\n        ({ items, totalProducts }: RecommendationUnitModel, unitIndex) =>\n          totalProducts > 0\n            ? items.map(\n                (item: RecommendationUnitModel['items'][0], index: number) => {\n                  const { sku } = item;\n\n                  return (\n                    <span\n                      key={sku}\n                      role=\"group\"\n                      aria-label={`Product ${\n                        unitIndex * items.length + index + 1\n                      } of ${totalProducts}`}\n                      onClick={() =>\n                        handleProductClick(\n                          item,\n                          unitIndex * items.length + index\n                        )\n                      }\n                    >\n                      <ProductItemCard\n                        data-testid=\"recommendations-product-item-card\"\n                        initialized\n                        sku={getSku(item)}\n                        image={getImage(item, unitIndex * items.length + index)}\n                        titleNode={getTitle(item)}\n                        price={getPrice(item)}\n                        actionButton={getFooter(\n                          item,\n                          unitIndex * items.length + index\n                        )}\n                      />\n                    </span>\n                  );\n                }\n              )\n            : null\n      )}\n    </>\n  ) : null;\n\n  const isEmpty =\n    !recommendations ||\n    recommendations.length === 0 ||\n    recommendations.every((unit) => !unit.items || unit.items.length === 0);\n\n  return (\n    <div ref={containerRef}>\n      <ProductListComponent\n        {...props}\n        className={isEmpty ? 'recommendations-product-list--empty' : ''}\n        heading={hideHeading ? undefined : heading}\n        loading={loading}\n        products={isEmpty ? null : productEntries}\n      />\n    </div>\n  );\n};\n"],"names":["ProductList","className","children","heading","products","loading","props","jsx","classes","ProductListSkeleton","jsxs","Fragment","VComponent","ContentGrid","Skeleton","_","i","SkeletonRow","recId","initialData","hideHeading","routeProduct","currentSku","cartSkus","userPurchaseHistory","userViewHistory","pagePlacement","slots","setLoading","useState","recommendations","setRecommendations","_a","unit","containerRef","useRef","dictionary","useText","hasRequiredData","useCallback","useEffect","dataEvent","events","payload","prev","existing","newUnits","e","publishRecsUnitRender","_b","intersectionObserverOptions","handleIntersection","entries","entry","publishRecsUnitView","observer","getRecommendations","error","getImage","item","index","defaultImageProps","_d","_c","imageComponent","Image","Slot","getFooter","Button","getTitle","getSku","getPrice","Price","handleProductClick","productId","recommendationUnit","unitItem","publishRecsItemClick","productEntries","items","totalProducts","unitIndex","sku","ProductItemCard","isEmpty","ProductListComponent"],"mappings":"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"}