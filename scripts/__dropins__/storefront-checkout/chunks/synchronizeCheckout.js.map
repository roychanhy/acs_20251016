{"version":3,"file":"synchronizeCheckout.js","sources":["/@dropins/storefront-checkout/src/api/authenticateCustomer/authenticateCustomer.ts","/@dropins/storefront-checkout/src/data/transforms/transform-shipping-methods.ts","/@dropins/storefront-checkout/src/data/transforms/transform-address.ts","/@dropins/storefront-checkout/src/data/transforms/transform-payment-methods.ts","/@dropins/storefront-checkout/src/data/transforms/transform-cart.ts","/@dropins/storefront-checkout/src/api/getCart/graphql/getCart.graphql.ts","/@dropins/storefront-checkout/src/api/getCart/getCart.ts","/@dropins/storefront-checkout/src/api/initialize/listeners.ts","/@dropins/storefront-checkout/src/api/initialize/initialize.ts","/@dropins/storefront-checkout/src/api/initializeCheckout/initializeCheckout.ts","/@dropins/storefront-checkout/src/api/resetCheckout/resetCheckout.ts","/@dropins/storefront-checkout/src/api/synchronizeCheckout/synchronizeCheckout.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/checkout/lib/state';\n\nexport const authenticateCustomer = async (authenticated = false) => {\n  state.authenticated = authenticated;\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { ShippingMethod } from '@/checkout/data/models/shipping-method';\nimport { GetCartQuery } from '@/checkout/__generated__/types';\n\ntype Cart = NonNullable<GetCartQuery['cart']>;\ntype ShippingAddresses = Cart['shipping_addresses'];\ntype ShippingAddress = NonNullable<NonNullable<ShippingAddresses>[number]>;\ntype AvailableShippingMethods = ShippingAddress['available_shipping_methods'];\ntype AvailableShippingMethod = NonNullable<AvailableShippingMethods>[number];\ntype SelectedShippingMethod = ShippingAddress['selected_shipping_method'];\n\ntype FilteredShippingMethod = Omit<\n  NonNullable<AvailableShippingMethod>,\n  | 'method_code'\n  | 'method_title'\n  | 'amount'\n  | 'price_excl_tax'\n  | 'price_incl_tax'\n> & {\n  method_code: string;\n  method_title: string;\n  amount: {\n    value: number;\n    currency: string;\n  };\n  price_excl_tax: {\n    value: number;\n    currency: string;\n  };\n  price_incl_tax: {\n    value: number;\n    currency: string;\n  };\n};\n\nconst byPrice = (a: ShippingMethod, b: ShippingMethod) =>\n  a.amount.value - b.amount.value;\n\nexport const isNullish = (value: any): boolean =>\n  value === null || value === undefined;\n\nconst isValid = (method: AvailableShippingMethod | SelectedShippingMethod) => {\n  if (!method) return false;\n  if (!method.method_code || !method.method_title) return false;\n  if (isNullish(method.amount.value) || !method.amount.currency) return false;\n  return true;\n};\n\nconst buildShippingMethod = (data: FilteredShippingMethod): ShippingMethod => {\n  return {\n    amount: {\n      value: data.amount.value,\n      currency: data.amount.currency,\n    },\n    title: data.method_title,\n    code: data.method_code,\n    carrier: {\n      code: data.carrier_code,\n      title: data.carrier_title,\n    },\n    value: `${data.carrier_code} - ${data.method_code}`,\n    ...(data.price_excl_tax && {\n      amountExclTax: {\n        value: data.price_excl_tax.value,\n        currency: data.price_excl_tax.currency,\n      },\n    }),\n    ...(data.price_incl_tax && {\n      amountInclTax: {\n        value: data.price_incl_tax.value,\n        currency: data.price_incl_tax.currency,\n      },\n    }),\n  };\n};\n\nexport const transformSelectedShippingMethod = (\n  data: SelectedShippingMethod\n): ShippingMethod | undefined => {\n  if (!isValid(data)) return;\n  return buildShippingMethod(data as FilteredShippingMethod);\n};\n\nexport const transformAvailableShippingMethod = (\n  data: AvailableShippingMethod\n): ShippingMethod | undefined => {\n  if (!isValid(data)) return;\n  return buildShippingMethod(data as FilteredShippingMethod);\n};\n\nexport const transformShippingMethods = (\n  data: AvailableShippingMethods\n): ShippingMethod[] => {\n  if (!data) return [];\n\n  return data\n    .filter(isValid)\n    .map((method) => buildShippingMethod(method as FilteredShippingMethod))\n    .sort(byPrice);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CartAddressInput, GetCartQuery } from '@/checkout/__generated__/types';\nimport {\n  Address as AddressModel,\n  Country as CountryModel,\n  CustomAttribute as CustomAttributeModel,\n  Region as RegionModel,\n  ShippingAddress as ShippingAddressModel,\n  CartAddress as CartAddressModel,\n} from '@/checkout/data/models';\nimport {\n  transformSelectedShippingMethod,\n  transformShippingMethods,\n} from '@/checkout/data/transforms/transform-shipping-methods';\n\ntype ShippingAddresses = NonNullable<\n  GetCartQuery['cart']\n>['shipping_addresses'];\ntype ShippingAddress = ShippingAddresses[0];\ntype NonNullableShippingAddress = NonNullable<ShippingAddress>;\n\ntype AddressRegion = NonNullableShippingAddress['region'];\ntype NonNullableAddressRegion = NonNullable<AddressRegion>;\ntype ValidatedAddressRegion = {\n  code: NonNullable<NonNullableAddressRegion['code']>;\n  label: NonNullable<NonNullableAddressRegion['label']>;\n  region_id: NonNullableAddressRegion['region_id'];\n};\n\ntype AddressCountry = NonNullableShippingAddress['country'];\ntype NonNullableAddressCountry = NonNullable<AddressCountry>;\ntype ValidatedAddressCountry = {\n  code: NonNullable<NonNullableAddressCountry['code']>;\n  label: NonNullable<NonNullableAddressCountry['label']>;\n};\n\ntype BillingAddress = NonNullable<GetCartQuery['cart']>['billing_address'];\ntype NonNullableBillingAddress = NonNullable<BillingAddress>;\n\ntype CustomAttributes =\n  | NonNullableShippingAddress['custom_attributes']\n  | NonNullableBillingAddress['custom_attributes'];\n\nconst isValidAddressRegion = (region: AddressRegion): boolean => {\n  if (!region) return false;\n  return !!region.code && !!region.label;\n};\n\nconst transformAddressRegion = (\n  data: AddressRegion\n): RegionModel | undefined => {\n  if (!isValidAddressRegion(data)) return;\n  const { code, label, region_id } = data as ValidatedAddressRegion;\n  if (!region_id) return { code, name: label };\n  return { code, name: label, id: region_id };\n};\n\nconst transformAddressCountry = (data: AddressCountry): CountryModel => {\n  const { code, label } = data as ValidatedAddressCountry;\n  return { value: code, label };\n};\n\nconst isValidCustomAttribute = (attribute: any): boolean => {\n  if (!attribute) return false;\n  return 'code' in attribute && 'value' in attribute;\n};\n\nexport const transformCustomAttributes = (\n  data: CustomAttributes\n): CustomAttributeModel[] => {\n  return data.filter(isValidCustomAttribute).map((attribute) => {\n    const { code, value } = attribute as { code: string; value: string };\n    return { code, value };\n  });\n};\n\nconst buildBaseAddress = (\n  data: NonNullableShippingAddress | NonNullableBillingAddress\n): AddressModel => {\n  const street = data.street.filter(Boolean) as string[];\n\n  return {\n    id: data?.id || undefined,\n    city: data.city,\n    company: data.company || undefined,\n    country: transformAddressCountry(data.country),\n    customAttributes: transformCustomAttributes(data.custom_attributes),\n    firstName: data.firstname,\n    lastName: data.lastname,\n    postCode: data.postcode || undefined,\n    region: transformAddressRegion(data.region),\n    street,\n    telephone: data.telephone || undefined,\n    vatId: data.vat_id || undefined,\n    prefix: data.prefix || undefined,\n    suffix: data.suffix || undefined,\n    middleName: data.middlename || undefined,\n    fax: data.fax || undefined,\n  };\n};\n\nconst transformBillingAddress = (\n  data: BillingAddress\n): AddressModel | undefined => {\n  if (!data) return;\n  return buildBaseAddress(data);\n};\n\nconst transformShippingAddresses = (\n  data: ShippingAddresses\n): ShippingAddressModel[] | undefined => {\n  return data\n    .filter((address) => !!address)\n    .map((address) => {\n      const {\n        available_shipping_methods,\n        selected_shipping_method,\n        same_as_billing,\n        ...baseData\n      } = address as NonNullableShippingAddress;\n\n      return {\n        ...buildBaseAddress(baseData as NonNullableShippingAddress),\n        availableShippingMethods: transformShippingMethods(\n          available_shipping_methods\n        ),\n        selectedShippingMethod: transformSelectedShippingMethod(\n          selected_shipping_method\n        ),\n        sameAsBilling: same_as_billing,\n      };\n    });\n};\n\nconst transformCartAddressModelToInput = (\n  address: CartAddressModel\n): CartAddressInput => {\n  return {\n    city: address.city,\n    company: address.company,\n    country_code: address.countryCode,\n    custom_attributes: address.customAttributes.map((attribute) => ({\n      attribute_code: attribute.code,\n      value: attribute.value,\n    })),\n    firstname: address.firstName,\n    lastname: address.lastName,\n    postcode: address.postcode,\n    region: address.region,\n    region_id: address.regionId,\n    save_in_address_book: address.saveInAddressBook ?? true,\n    street: address.street,\n    telephone: address.telephone,\n    vat_id: address.vatId,\n    prefix: address.prefix,\n    suffix: address.suffix,\n    middlename: address.middleName,\n    fax: address.fax,\n  };\n};\n\nexport {\n  BillingAddress,\n  ShippingAddress,\n  transformCartAddressModelToInput,\n  transformBillingAddress,\n  transformShippingAddresses,\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { GetCartQuery } from '@/checkout/__generated__/types';\nimport { PaymentMethod } from '@/checkout/data/models/payment-method';\n\ntype SelectedPaymentMethod = NonNullable<\n  GetCartQuery['cart']\n>['selected_payment_method'];\n\ntype AvailablePaymentMethods = NonNullable<\n  GetCartQuery['cart']\n>['available_payment_methods'];\n\ntype AvailablePaymentMethod = NonNullable<AvailablePaymentMethods>[number];\n\ntype NonNullabePaymentMethod = NonNullable<AvailablePaymentMethod>;\n\nconst transformSelectedPaymentMethod = (\n  data: SelectedPaymentMethod\n): PaymentMethod | undefined => {\n  if (!data) return;\n  return { code: data.code, title: data.title };\n};\n\nconst transformAvailablePaymentMethods = (\n  data: AvailablePaymentMethods\n): PaymentMethod[] | undefined => {\n  if (!data) return;\n\n  return data\n    .filter((method) => !!method)\n    .map((method) => {\n      const { code, title } = method as NonNullabePaymentMethod;\n      return { code, title };\n    });\n};\n\nexport { transformAvailablePaymentMethods, transformSelectedPaymentMethod };\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { GetCartQuery } from '@/checkout/__generated__/types';\nimport { config } from '@/checkout/api';\nimport { Cart as CartModel } from '@/checkout/data/models';\nimport {\n  transformAvailablePaymentMethods,\n  transformSelectedPaymentMethod,\n} from '@/checkout/data/transforms/transform-payment-methods';\nimport { merge } from '@adobe-commerce/elsie/lib';\n\nimport {\n  transformBillingAddress,\n  transformShippingAddresses,\n} from '@/checkout/data/transforms/transform-address';\nimport { state } from '@/checkout/lib/state';\n\ntype Cart = GetCartQuery['cart'];\n\nconst transformCart = (data: Cart): CartModel | undefined => {\n  if (!data) return;\n\n  const model = {\n    availablePaymentMethods: transformAvailablePaymentMethods(\n      data.available_payment_methods\n    ),\n    billingAddress: transformBillingAddress(data.billing_address),\n    email: data.email ?? undefined,\n    id: data.id,\n    isEmpty: data.total_quantity === 0,\n    isVirtual: data.is_virtual,\n    selectedPaymentMethod: transformSelectedPaymentMethod(\n      data.selected_payment_method\n    ),\n    shippingAddresses: transformShippingAddresses(data.shipping_addresses),\n    isGuest: !state.authenticated,\n  };\n\n  // Extend the model merging custom transformer, if provided\n  return merge(\n    model, // default transformer\n    config.getConfig().models?.CartModel?.transformer?.(data) // custom transformer\n  );\n};\n\nexport { Cart, transformCart };\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECKOUT_DATA_FRAGMENT } from '@/checkout/api/graphql/CheckoutDataFragment.graphql';\n\nexport const getCartQuery = /* GraphQL */ `\n  query getCart($cartId: String!) {\n    cart(cart_id: $cartId) {\n      ...CHECKOUT_DATA_FRAGMENT\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n\nexport const getCustomerCartQuery = /* GraphQL */ `\n  query getCustomerCart {\n    cart: customerCart {\n      ...CHECKOUT_DATA_FRAGMENT\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  getCartQuery,\n  getCustomerCartQuery,\n} from '@/checkout/api/getCart/graphql';\nimport { transformCart } from '@/checkout/data/transforms';\nimport { MissingCart } from '@/checkout/errors';\nimport { dispatchApiCall } from '@/checkout/lib/dispatchApiCall';\nimport { state } from '@/checkout/lib/state';\n\nexport const getCart = async () => {\n  const cartId = state.cartId;\n  const isGuest = state.authenticated === false;\n  const query = isGuest ? getCartQuery : getCustomerCartQuery;\n  const variables = isGuest ? { cartId } : {};\n\n  if (isGuest && !cartId) throw new MissingCart();\n\n  return await dispatchApiCall({\n    type: 'query',\n    query,\n    options: { method: 'POST', cache: 'no-cache', variables },\n    path: 'cart',\n    transformer: transformCart,\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  authenticateCustomer,\n  initializeCheckout,\n  resetCheckout,\n  synchronizeCheckout,\n} from '@/checkout/api';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const addCheckoutEventListeners = () => [\n  events.on('authenticated', authenticateCustomer, { eager: true }),\n  events.on('cart/initialized', initializeCheckout, { eager: true }),\n  events.on('cart/reset', resetCheckout),\n  events.on('cart/updated', synchronizeCheckout),\n];\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { addCheckoutEventListeners } from '@/checkout/api/initialize/listeners';\nimport {\n  Cart as CartModel,\n  Customer as CustomerModel,\n} from '@/checkout/data/models';\n\nimport { Lang } from '@adobe-commerce/elsie/i18n';\nimport { Initializer, Model } from '@adobe-commerce/elsie/lib';\n\nexport type ConfigProps = {\n  langDefinitions?: Lang;\n  models?: {\n    CartModel?: Model<CartModel>;\n    CustomerModel?: Model<CustomerModel>;\n  };\n};\n\nexport const initialize = new Initializer<ConfigProps>({\n  init: async (_config) => {\n    const config = { ..._config };\n    initialize.config.setConfig(config);\n  },\n  listeners: addCheckoutEventListeners,\n});\n\nexport const config = initialize.config;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { getCart, getStoreConfig, synchronizeCheckout } from '@/checkout/api';\nimport { state } from '@/checkout/lib/state';\nimport { Cart, events } from '@adobe-commerce/event-bus';\n\nexport const initializeCheckout = async (cart: Cart | null): Promise<void> => {\n  if (state.initialized) return synchronizeCheckout(cart);\n\n  if (!state.config) {\n    state.config = await getStoreConfig();\n  }\n\n  const cartId = cart ? cart.id : null;\n  state.cartId = cartId;\n\n  const initialData = cartId ? await getCart() : null;\n  state.initialized = true;\n\n  events.emit('checkout/initialized', initialData || null);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { state } from '@/checkout/lib/state';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport const resetCheckout = () => {\n  state.cartId = null;\n  events.emit('checkout/updated', null);\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { getCart, initializeCheckout } from '@/checkout/api';\nimport { state } from '@/checkout/lib/state';\nimport { Cart, events } from '@adobe-commerce/event-bus';\n\nexport const synchronizeCheckout = async (cart: Cart | null) => {\n  if (!state.initialized) return initializeCheckout(cart);\n  const cartId = cart ? cart.id : null;\n  state.cartId = cartId;\n  const data = cartId ? await getCart() : null;\n  events.emit('checkout/updated', data || null);\n};\n"],"names":["authenticateCustomer","authenticated","state","byPrice","a","b","isNullish","value","isValid","method","buildShippingMethod","data","transformSelectedShippingMethod","transformShippingMethods","isValidAddressRegion","region","transformAddressRegion","code","label","region_id","transformAddressCountry","isValidCustomAttribute","attribute","transformCustomAttributes","buildBaseAddress","street","transformBillingAddress","transformShippingAddresses","address","available_shipping_methods","selected_shipping_method","same_as_billing","baseData","transformCartAddressModelToInput","transformSelectedPaymentMethod","transformAvailablePaymentMethods","title","transformCart","model","merge","_c","_b","_a","config","getCartQuery","CHECKOUT_DATA_FRAGMENT","getCustomerCartQuery","getCart","cartId","isGuest","query","variables","MissingCart","dispatchApiCall","addCheckoutEventListeners","events","initializeCheckout","resetCheckout","synchronizeCheckout","initialize","Initializer","_config","cart","getStoreConfig","initialData"],"mappings":"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"}