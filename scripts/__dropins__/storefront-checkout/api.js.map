{"version":3,"file":"api.js","sources":["/@dropins/storefront-checkout/src/api/estimateShippingMethods/graphql/estimateShippingMethods.graphql.ts","/@dropins/storefront-checkout/src/data/transforms/transform-checkout-agreements.ts","/@dropins/storefront-checkout/src/api/estimateShippingMethods/estimateShippingMethods.ts","/@dropins/storefront-checkout/src/api/getCheckoutAgreements/graphql/getCheckoutAgreements.graphql.ts","/@dropins/storefront-checkout/src/api/getCheckoutAgreements/getCheckoutAgreements.ts","/@dropins/storefront-checkout/src/api/setShippingAddress/graphql/setShippingAddress.graphql.ts","/@dropins/storefront-checkout/src/api/setShippingAddress/graphql/setShippingAddressAndUseAsBilling.graphql.ts","/@dropins/storefront-checkout/src/api/setShippingAddress/setShippingAddress.ts"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const estimateShippingMethodsMutation = /* GraphQL */ `\n  mutation estimateShippingMethods(\n    $cartId: String!\n    $address: EstimateAddressInput!\n  ) {\n    estimateShippingMethods(input: { cart_id: $cartId, address: $address }) {\n      carrier_title\n      carrier_code\n      method_title\n      method_code\n      available\n      amount {\n        currency\n        value\n      }\n      price_excl_tax {\n        currency\n        value\n      }\n      price_incl_tax {\n        currency\n        value\n      }\n      error_message\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport {\n  AgreementMode,\n  CheckoutAgreement as CheckoutAgreementModel,\n} from '@/checkout/data/models';\nimport { Get_Checkout_AgreementsQuery } from '@/checkout/__generated__/types';\n\ntype CheckoutAgreements = Get_Checkout_AgreementsQuery['checkoutAgreements'];\ntype FilteredAgreement = NonNullable<NonNullable<CheckoutAgreements>[0]>;\n\nexport const transformCheckoutAgreements = (\n  data: CheckoutAgreements\n): CheckoutAgreementModel[] => {\n  if (!data) return [];\n\n  return data\n    .filter((agreement): agreement is FilteredAgreement => !!agreement)\n    .map((agreement) => ({\n      id: agreement.agreement_id,\n      name: agreement.name,\n      mode: AgreementMode[agreement.mode],\n      text: agreement.checkbox_text,\n      content: {\n        value: agreement.content,\n        html: agreement.is_html,\n        height: agreement.content_height ?? null,\n      },\n    }));\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { MissingCart, MissingCountry } from '@/checkout/api';\nimport { estimateShippingMethodsMutation } from '@/checkout/api/estimateShippingMethods/graphql';\nimport { ShippingMethod } from '@/checkout/data/models';\nimport {\n  transformShippingEstimatePartialAddress,\n  transformShippingEstimateShippingMethod,\n  transformShippingMethods,\n} from '@/checkout/data/transforms';\nimport { dispatchApiCall, getValue, QueueName, state } from '@/checkout/lib';\nimport { events } from '@adobe-commerce/event-bus';\n\nexport interface ShippingEstimationCriteria {\n  country_code: string;\n  region_name?: string;\n  region_id?: string | number;\n  zip?: string;\n}\n\nexport type EstimateShippingInput = {\n  criteria: ShippingEstimationCriteria;\n};\n\nexport const estimateShippingMethods = async (\n  input?: EstimateShippingInput\n): Promise<ShippingMethod[] | undefined> => {\n  const cartId = state.cartId;\n  const countryCode =\n    input?.criteria?.country_code ?? state.config?.defaultCountry;\n\n  if (!cartId) throw new MissingCart();\n  if (!countryCode) throw new MissingCountry();\n\n  const { region_id, region_name, zip } = input?.criteria ?? {};\n\n  // Process region information\n  const region =\n    region_id || region_name\n      ? {\n          region_id:\n            typeof region_id === 'string' ? parseInt(region_id, 10) : region_id,\n          region_code: region_name,\n        }\n      : undefined;\n\n  // Build address for API call\n  const address = {\n    country_code: countryCode,\n    ...(zip && { postcode: zip }),\n    ...(region && {\n      region: {\n        ...(region.region_id && { region_id: region.region_id }),\n        ...(region.region_code && { region_code: region.region_code }),\n      },\n    }),\n  };\n\n  // Create address data for transformation\n  const estimateShippingAddressData = {\n    country_id: countryCode,\n    region: address.region?.region_code,\n    region_id: address.region?.region_id,\n    postcode: zip,\n  };\n\n  const partialAddress = transformShippingEstimatePartialAddress(\n    estimateShippingAddressData\n  );\n\n  return dispatchApiCall({\n    options: { variables: { cartId, address } },\n    path: 'estimateShippingMethods',\n    query: estimateShippingMethodsMutation,\n    queueName: QueueName.ShippingEstimate,\n    transformer: transformShippingMethods,\n    type: 'mutation',\n  })\n    .then((estimation) => {\n      const hasAvailableOptions = estimation.length > 0;\n      const partialAddress = transformShippingEstimatePartialAddress(\n        estimateShippingAddressData\n      );\n\n      let shippingMethod = null;\n\n      if (hasAvailableOptions) {\n        const userSelection = getValue('selectedShippingMethod');\n\n        const selection = estimation.find(\n          (method) =>\n            method.code === userSelection?.code &&\n            method.carrier.code === userSelection?.carrier.code\n        );\n\n        shippingMethod = transformShippingEstimateShippingMethod(\n          selection ?? estimation[0]\n        );\n      }\n\n      events.emit('shipping/estimate', {\n        address: partialAddress,\n        availableShippingMethods: estimation,\n        shippingMethod,\n        success: true,\n      });\n\n      return estimation;\n    })\n    .catch((error) => {\n      events.emit('shipping/estimate', {\n        address: partialAddress,\n        shippingMethod: null,\n        availableShippingMethods: [],\n        success: false,\n      });\n\n      throw error;\n    });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nexport const GET_CHECKOUT_AGREEMENTS = /* GraphQL */ `\n  query GET_CHECKOUT_AGREEMENTS {\n    checkoutAgreements {\n      agreement_id\n      checkbox_text\n      content\n      content_height\n      is_html\n      mode\n      name\n    }\n  }\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2025 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CheckoutAgreement } from '@/checkout/data/models';\nimport { transformCheckoutAgreements } from '@/checkout/data/transforms';\nimport { dispatchApiCall } from '@/checkout/lib';\nimport { GET_CHECKOUT_AGREEMENTS } from './graphql/getCheckoutAgreements.graphql';\n\nexport const getCheckoutAgreements = async (): Promise<CheckoutAgreement[]> => {\n  return await dispatchApiCall({\n    defaultValueOnFail: [],\n    options: { method: 'GET', cache: 'no-cache' },\n    path: 'checkoutAgreements',\n    query: GET_CHECKOUT_AGREEMENTS,\n    transformer: transformCheckoutAgreements,\n    type: 'query',\n  });\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECKOUT_DATA_FRAGMENT } from '@/checkout/api/graphql/CheckoutDataFragment.graphql';\n\nexport const setShippingAddressMutation = /* GraphQL */ `\n  mutation setShippingAddress(\n    $cartId: String!\n    $shippingAddressInput: ShippingAddressInput!\n  ) {\n    setShippingAddressesOnCart(\n      input: { cart_id: $cartId, shipping_addresses: [$shippingAddressInput] }\n    ) {\n      cart {\n        ...CHECKOUT_DATA_FRAGMENT\n      }\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { CHECKOUT_DATA_FRAGMENT } from '@/checkout/api/graphql/CheckoutDataFragment.graphql';\n\nexport const setShippingAddressAndUseAsBillingMutation = /* GraphQL */ `\n  mutation SET_SHIPPING_ADDRESS_ON_CART_AND_USE_AS_BILLING_MUTATION(\n    $cartId: String!\n    $shippingAddressInput: ShippingAddressInput!\n  ) {\n    setShippingAddressesOnCart(\n      input: { cart_id: $cartId, shipping_addresses: [$shippingAddressInput] }\n    ) {\n      cart {\n        id\n      }\n    }\n\n    setBillingAddressOnCart(\n      input: { cart_id: $cartId, billing_address: { same_as_shipping: true } }\n    ) {\n      cart {\n        ...CHECKOUT_DATA_FRAGMENT\n      }\n    }\n  }\n\n  ${CHECKOUT_DATA_FRAGMENT}\n`;\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { setShippingAddressMutation } from '@/checkout/api/setShippingAddress/graphql/setShippingAddress.graphql';\nimport { ShippingAddressInput as ShippingAddressInputModel } from '@/checkout/data/models';\nimport { transformCart } from '@/checkout/data/transforms';\nimport { transformCartAddressModelToInput } from '@/checkout/data/transforms/transform-address';\nimport { MissingCart, MissingShippinghAddress } from '@/checkout/errors';\nimport { dispatchApiCall, getValue, QueueName, state } from '@/checkout/lib';\nimport { ShippingAddressInput } from '@/checkout/__generated__/types';\nimport { setShippingAddressAndUseAsBillingMutation } from './graphql/setShippingAddressAndUseAsBilling.graphql';\n\nexport const setShippingAddress = async ({\n  address,\n  customerAddressId,\n  pickupLocationCode,\n}: ShippingAddressInputModel) => {\n  const cartId = state.cartId;\n\n  if (!cartId) throw new MissingCart();\n\n  const shippingAddressInput = (): ShippingAddressInput => {\n    if (customerAddressId) {\n      return { customer_address_id: customerAddressId };\n    }\n    if (pickupLocationCode) {\n      return { pickup_location_code: pickupLocationCode };\n    }\n    if (!address) {\n      throw new MissingShippinghAddress();\n    }\n    return { address: transformCartAddressModelToInput(address) };\n  };\n\n  const isBillToShipping = getValue('isBillToShipping');\n\n  const query = isBillToShipping\n    ? setShippingAddressAndUseAsBillingMutation\n    : setShippingAddressMutation;\n\n  const path = isBillToShipping\n    ? 'setBillingAddressOnCart.cart'\n    : 'setShippingAddressesOnCart.cart';\n\n  const variables = {\n    cartId,\n    shippingAddressInput: shippingAddressInput(),\n  };\n\n  return await dispatchApiCall({\n    type: 'mutation',\n    query,\n    options: { variables },\n    path,\n    queueName: QueueName.CartUpdate,\n    transformer: transformCart,\n  });\n};\n"],"names":["estimateShippingMethodsMutation","transformCheckoutAgreements","data","agreement","AgreementMode","estimateShippingMethods","input","cartId","state","countryCode","_a","_b","MissingCart","MissingCountry","region_id","region_name","zip","region","address","estimateShippingAddressData","_c","_d","partialAddress","transformShippingEstimatePartialAddress","dispatchApiCall","QueueName","transformShippingMethods","estimation","hasAvailableOptions","shippingMethod","userSelection","getValue","selection","method","transformShippingEstimateShippingMethod","events","error","GET_CHECKOUT_AGREEMENTS","getCheckoutAgreements","setShippingAddressMutation","CHECKOUT_DATA_FRAGMENT","setShippingAddressAndUseAsBillingMutation","setShippingAddress","customerAddressId","pickupLocationCode","shippingAddressInput","MissingShippinghAddress","transformCartAddressModelToInput","isBillToShipping","query","path","variables","transformCart"],"mappings":"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"}