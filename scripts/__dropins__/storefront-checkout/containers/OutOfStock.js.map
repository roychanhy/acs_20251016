{"version":3,"file":"OutOfStock.js","sources":["/@dropins/storefront-checkout/src/components/OutOfStock/OutOfStock.tsx","/@dropins/storefront-checkout/src/containers/OutOfStock/OutOfStock.tsx"],"sourcesContent":["/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport '@/checkout/components/OutOfStock/OutOfStock.css';\nimport { Item as CartItem } from '@/checkout/types/cart';\nimport { Card, Icon, Image } from '@adobe-commerce/elsie/components';\nimport { useText } from '@adobe-commerce/elsie/i18n';\nimport { OrderError } from '@adobe-commerce/elsie/icons';\nimport { classes } from '@adobe-commerce/elsie/lib';\nimport { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\n\nexport interface OutOfStockProps extends HTMLAttributes<HTMLDivElement> {\n  items: CartItem[];\n  onRemoveOutOfStock?: (event: Event) => void;\n  routeCart?: string;\n}\n\nexport const OutOfStock: FunctionComponent<OutOfStockProps> = ({\n  className,\n  items,\n  onRemoveOutOfStock,\n  routeCart,\n  ...props\n}) => {\n  const translations = useText({\n    title: 'Checkout.OutOfStock.title',\n    message: 'Checkout.OutOfStock.message',\n    reviewCart: 'Checkout.OutOfStock.actions.reviewCart',\n    removeOutOfStock: 'Checkout.OutOfStock.actions.removeOutOfStock',\n  });\n\n  return (\n    <Card\n      className={classes(['checkout-out-of-stock', className])}\n      data-testid=\"checkout-out-of-stock\"\n      variant=\"secondary\"\n      {...props}\n    >\n      <h4 className=\"checkout-out-of-stock__title\">\n        <Icon size=\"16\" source={OrderError} stroke=\"1\" />\n        {translations.title}\n      </h4>\n\n      <p className=\"checkout-out-of-stock__message\">{translations.message}</p>\n\n      <ol className=\"checkout-out-of-stock__items\">\n        {items.map((item) => (\n          <li\n            key={item.sku}\n            className=\"checkout-out-of-stock__item\"\n            data-testid=\"out-of-stock-item\"\n          >\n            <Image\n              alt={item.image.alt}\n              height=\"100\"\n              loading=\"eager\"\n              params={{ width: 100 }}\n              src={item.image.src}\n              width=\"100\"\n            />\n          </li>\n        ))}\n      </ol>\n\n      <div className=\"checkout-out-of-stock__actions\">\n        {routeCart && (\n          <a\n            className=\"checkout-out-of-stock__action\"\n            data-testid=\"review-cart\"\n            href={routeCart}\n          >\n            {translations.reviewCart}\n          </a>\n        )}\n\n        {onRemoveOutOfStock && (\n          <button\n            className=\"checkout-out-of-stock__action\"\n            data-testid=\"remove-out-of-stock\"\n            type=\"button\"\n            onClick={onRemoveOutOfStock}\n          >\n            {translations.removeOutOfStock}\n          </button>\n        )}\n      </div>\n    </Card>\n  );\n};\n","/********************************************************************\n * ADOBE CONFIDENTIAL\n * __________________\n *\n *  Copyright 2024 Adobe\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe and its suppliers, if any. The intellectual\n * and technical concepts contained herein are proprietary to Adobe\n * and its suppliers and are protected by all applicable intellectual\n * property laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe.\n *******************************************************************/\n\nimport { OutOfStock as OutOfStockComponent } from '@/checkout/components';\nimport { Item as ItemModel } from '@/checkout/types/cart';\nimport { Container } from '@adobe-commerce/elsie/lib';\nimport { events } from '@adobe-commerce/event-bus';\nimport { HTMLAttributes } from 'preact/compat';\nimport { useCallback, useEffect, useState } from 'preact/hooks';\n\nexport type UpdateProductsFromCart = Array<{\n  uid: string;\n  quantity: number;\n}>;\n\nexport interface OutOfStockProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'icon'> {\n  onCartProductsUpdate?: (items: UpdateProductsFromCart) => void;\n  routeCart?: () => string;\n  active?: boolean;\n}\n\nexport const OutOfStock: Container<OutOfStockProps> = ({\n  onCartProductsUpdate,\n  routeCart,\n  active = true,\n}) => {\n  const [items, setItems] = useState<ItemModel[]>([]);\n\n  const removeOutOfStockItems = useCallback(() => {\n    if (!onCartProductsUpdate) return;\n\n    const update = items\n      .filter((item) => item.outOfStock)\n      .map((item) => ({ uid: item.uid, quantity: 0 }));\n\n    onCartProductsUpdate(update);\n  }, [items, onCartProductsUpdate]);\n\n  useEffect(() => {\n    if (!active) return;\n\n    const onCartData = events.on(\n      'cart/data',\n      (data) => {\n        const items = (data?.items || []) as ItemModel[];\n        setItems(\n          items.filter((item: ItemModel) => {\n            return item.outOfStock || item.insufficientQuantity;\n          })\n        );\n      },\n      { eager: true }\n    );\n\n    return () => {\n      onCartData?.off();\n    };\n  }, [active]);\n\n  if (!active || items.length === 0) return null;\n\n  const canRemoveOutOfStock = !items.some((item) => item.insufficientQuantity);\n\n  return (\n    <OutOfStockComponent\n      items={items}\n      routeCart={routeCart?.()}\n      onRemoveOutOfStock={\n        canRemoveOutOfStock ? removeOutOfStockItems : undefined\n      }\n    />\n  );\n};\n"],"names":["OutOfStock","className","items","onRemoveOutOfStock","routeCart","props","translations","useText","jsxs","Card","classes","jsx","Icon","OrderError","item","Image","onCartProductsUpdate","active","setItems","useState","removeOutOfStockItems","useCallback","update","useEffect","onCartData","events","data","canRemoveOutOfStock","OutOfStockComponent"],"mappings":"ovBAgCO,MAAMA,EAAiD,CAAC,CAC7D,UAAAC,EACA,MAAAC,EACA,mBAAAC,EACA,UAAAC,EACA,GAAGC,CACL,IAAM,CACJ,MAAMC,EAAeC,EAAQ,CAC3B,MAAO,4BACP,QAAS,8BACT,WAAY,yCACZ,iBAAkB,8CAAA,CACnB,EAGC,OAAAC,EAACC,EAAA,CACC,UAAWC,EAAQ,CAAC,wBAAyBT,CAAS,CAAC,EACvD,cAAY,wBACZ,QAAQ,YACP,GAAGI,EAEJ,SAAA,CAACG,EAAA,KAAA,CAAG,UAAU,+BACZ,SAAA,CAAAG,EAACC,GAAK,KAAK,KAAK,OAAQC,EAAY,OAAO,IAAI,EAC9CP,EAAa,KAAA,EAChB,EAECK,EAAA,IAAA,CAAE,UAAU,iCAAkC,WAAa,QAAQ,IAEnE,KAAG,CAAA,UAAU,+BACX,SAAMT,EAAA,IAAKY,GACVH,EAAC,KAAA,CAEC,UAAU,8BACV,cAAY,oBAEZ,SAAAA,EAACI,EAAA,CACC,IAAKD,EAAK,MAAM,IAChB,OAAO,MACP,QAAQ,QACR,OAAQ,CAAE,MAAO,GAAI,EACrB,IAAKA,EAAK,MAAM,IAChB,MAAM,KAAA,CAAA,CACR,EAXKA,EAAK,GAab,CAAA,EACH,EAEAN,EAAC,MAAI,CAAA,UAAU,iCACZ,SAAA,CACCJ,GAAAO,EAAC,IAAA,CACC,UAAU,gCACV,cAAY,cACZ,KAAMP,EAEL,SAAaE,EAAA,UAAA,CAChB,EAGDH,GACCQ,EAAC,SAAA,CACC,UAAU,gCACV,cAAY,sBACZ,KAAK,SACL,QAASR,EAER,SAAaG,EAAA,gBAAA,CAAA,CAChB,CAEJ,CAAA,CAAA,CAAA,CACF,CAEJ,ECnEaN,EAAyC,CAAC,CACrD,qBAAAgB,EACA,UAAAZ,EACA,OAAAa,EAAS,EACX,IAAM,CACJ,KAAM,CAACf,EAAOgB,CAAQ,EAAIC,EAAsB,CAAA,CAAE,EAE5CC,EAAwBC,EAAY,IAAM,CAC9C,GAAI,CAACL,EAAsB,OAE3B,MAAMM,EAASpB,EACZ,OAAQY,GAASA,EAAK,UAAU,EAChC,IAAKA,IAAU,CAAE,IAAKA,EAAK,IAAK,SAAU,GAAI,EAEjDE,EAAqBM,CAAM,CAAA,EAC1B,CAACpB,EAAOc,CAAoB,CAAC,EAuBhC,GArBAO,EAAU,IAAM,CACd,GAAI,CAACN,EAAQ,OAEb,MAAMO,EAAaC,EAAO,GACxB,YACCC,GAAS,CACFxB,MAAAA,GAASwB,GAAA,YAAAA,EAAM,QAAS,CAAC,EAC/BR,EACEhB,EAAM,OAAQY,GACLA,EAAK,YAAcA,EAAK,oBAChC,CACH,CACF,EACA,CAAE,MAAO,EAAK,CAChB,EAEA,MAAO,IAAM,CACXU,GAAA,MAAAA,EAAY,KACd,CAAA,EACC,CAACP,CAAM,CAAC,EAEP,CAACA,GAAUf,EAAM,SAAW,EAAU,OAAA,KAE1C,MAAMyB,EAAsB,CAACzB,EAAM,KAAMY,GAASA,EAAK,oBAAoB,EAGzE,OAAAH,EAACiB,EAAA,CACC,MAAA1B,EACA,UAAWE,GAAA,YAAAA,IACX,mBACEuB,EAAsBP,EAAwB,MAAA,CAElD,CAEJ"}